!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("THREE"),require("TweenLite")):"function"==typeof define&&define.amd?define(["THREE","TweenLite"],t):"object"==typeof exports?exports.VIZI=t(require("THREE"),require("TweenLite")):e.VIZI=t(e.THREE,e.TweenLite)}(this,function(__WEBPACK_EXTERNAL_MODULE_4__,__WEBPACK_EXTERNAL_MODULE_7__){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(!function(){var e=new Error('Cannot find module "./World"');throw e.code="MODULE_NOT_FOUND",e}()),i=r(o),a=n(1),s=r(a),u=n(8),l=r(u),c=n(11),f=r(c),p=n(16),h=(r(p),n(17)),d=r(h),y=n(21),v=r(y),g=n(39),m=r(g),_=n(61),b=r(_),w=n(40),x=r(w),O=n(41),k=r(O),P=n(62),M=r(P),T=n(56),j=r(T),A=n(63),E=r(A),S=n(53),C=r(S),L=n(54),D=r(L),R=n(55),F=r(R),I=n(10),N=r(I),B=n(9),z=r(B),W=n(51),U=r(W),q=n(64),H=r(q),G={version:"0.3",World:i["default"],world:o.world,Controls:s["default"],Geo:l["default"],Layer:f["default"],layer:c.layer,EnvironmentLayer:d["default"],environmentLayer:h.environmentLayer,ImageTileLayer:v["default"],imageTileLayer:y.imageTileLayer,GeoJSONTileLayer:m["default"],geoJSONTileLayer:g.geoJSONTileLayer,GeoJSONTile:x["default"],geoJSONTile:w.geoJSONTile,TopoJSONTileLayer:b["default"],topoJSONTileLayer:_.topoJSONTileLayer,GeoJSONLayer:k["default"],geoJSONLayer:O.geoJSONLayer,TopoJSONLayer:M["default"],topoJSONLayer:P.topoJSONLayer,GeoJSONWorkerLayer:j["default"],geoJSONWorkerLayer:T.geoJSONWorkerLayer,TopoJSONWorkerLayer:E["default"],topoJSONWorkerLayer:A.topoJSONWorkerLayer,PolygonLayer:C["default"],polygonLayer:S.polygonLayer,PolylineLayer:D["default"],polylineLayer:L.polylineLayer,PointLayer:F["default"],pointLayer:R.pointLayer,Point:N["default"],point:I.point,LatLon:z["default"],latLon:B.latLon,PickingMaterial:U["default"],Util:H["default"]};t["default"]=G,e.exports=t["default"]},function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),i=r(o),a={Orbit:i["default"],orbit:o.orbit,orbit:o.orbit};t["default"]=a,e.exports=t["default"]},function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(e,t,n){for(var r=!0;r;){var o=e,i=t,a=n;r=!1,null===o&&(o=Function.prototype);var s=Object.getOwnPropertyDescriptor(o,i);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(a)}var l=Object.getPrototypeOf(o);if(null===l)return;e=l,t=i,n=a,r=!0,s=l=void 0}},u=n(3),l=r(u),c=n(4),f=r(c),p=n(5),h=r(p),d=n(7),y=r(d),v=function(e){function t(){o(this,t),s(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),y["default"].lagSmoothing(0)}return i(t,e),a(t,[{key:"_initEvents",value:function(){var e=this;this._controls.addEventListener("start",function(t){e.startPosition=e._controls.target.clone(),e.startPolar=e._controls.getPolarAngle(),e.startAzimuth=e._controls.getAzimuthalAngle(),e._world.emit("controlsMoveStart",t.target.target)}),this._controls.addEventListener("change",function(t){e._world.emit("controlsMove",t.target.target)}),this._controls.addEventListener("end",function(t){var n=e._controls.target.clone(),r=e._controls.getPolarAngle(),o=e._controls.getAzimuthalAngle(),i=!1;Math.abs(n.distanceTo(e.startPosition))>0&&(i=!0),Math.abs(r-e.startPolar)>0&&(i=!0),Math.abs(o-e.startAzimuth)>0&&(i=!0),e._world.emit("controlsMoveEnd",t.target.target,i)})}},{key:"panTo",value:function(e,t){var n=this._controls,r=n.target,o=e.x-r.x,i=e.y-r.z;n.panLeft(-o,n.object.matrix),n.panUp(-i,n.object.matrix),this.update(),this._world.emit("controlsMoveEnd",this._controls.target)}},{key:"panBy",value:function(e,t){this._controls.pan(-e.x,e.y),this.update(),this._world.emit("controlsMoveEnd",this._controls.target)}},{key:"zoomTo",value:function(e,t){}},{key:"zoomBy",value:function(e,t){var n=this._controls;e<0?n.dollyIn(Math.abs(e)):n.dollyOut(e),this.update(),this._world.emit("controlsMoveEnd",this._controls.target)}},{key:"lookAt",value:function(e,t){}},{key:"lookAtTarget",value:function(){}},{key:"tiltTo",value:function(e,t){var n=this._controls,r=n.getPolarAngle(),o=e-r;n.rotateUp(-o),this.update(),this._world.emit("controlsMoveEnd",this._controls.target)}},{key:"tiltBy",value:function(e,t){var n=this._controls;n.rotateUp(-e),this.update(),this._world.emit("controlsMoveEnd",this._controls.target)}},{key:"rotateTo",value:function(e,t){var n=this._controls,r=n.getAzimuthalAngle(),o=e-r;n.rotateLeft(-o),this.update(),this._world.emit("controlsMoveEnd",this._controls.target)}},{key:"rotateBy",value:function(e,t){var n=this._controls;n.rotateLeft(-e),this.update(),this._world.emit("controlsMoveEnd",this._controls.target)}},{key:"flyToPoint",value:function(e,t,n){var r=t||2;this._flyTarget=new f["default"].Vector3(e.x,0,e.y);var o=(new f["default"].Vector3).subVectors(this._controls.target,this._flyTarget);if(this._flyTween=new y["default"]({x:0,z:0,prev:{x:0,z:0}},r,{x:o.x,z:o.z,onUpdate:function(e){var t=this._controls,n=e.target.x-e.target.prev.x,r=e.target.z-e.target.prev.z;t.panLeft(n,t.object.matrix),t.panUp(r,t.object.matrix),e.target.prev.x=e.target.x,e.target.prev.z=e.target.z},onComplete:function(e){this._flyTarget=null},onUpdateParams:["{self}"],onCompleteParams:["{self}"],callbackScope:this,ease:Power1.easeInOut}),n){var i=r/2;this._zoomTweenIn=new y["default"]({zoom:0},i,{zoom:1,onUpdate:function(e){var t=this._controls;t.dollyIn(1-.01*e.target.zoom)},onComplete:function(e){},onUpdateParams:["{self}"],onCompleteParams:["{self}"],callbackScope:this,ease:Power1.easeInOut}),this._zoomTweenOut=new y["default"]({zoom:0},i,{zoom:1,delay:i,onUpdate:function(e){var t=this._controls;t.dollyOut(.99+.01*e.target.zoom)},onComplete:function(e){},onUpdateParams:["{self}"],onCompleteParams:["{self}"],callbackScope:this,ease:Power1.easeInOut})}}},{key:"flyToLatLon",value:function(e,t,n){var r=this._world.latLonToPoint(e);this.flyToPoint(r,t,n)}},{key:"update",value:function(e){this._controls.update(e)}},{key:"addTo",value:function(e){return e.addControls(this)}},{key:"_addToWorld",value:function(e){return this._world=e,this._controls=new h["default"](e._engine._camera,e._container),this._controls.maxPolarAngle=1.5533,this._initEvents(),this.emit("added"),Promise.resolve(this)}},{key:"destroy",value:function(){this._controls.dispose(),this._world=null,this._controls=null}}]),t}(l["default"]);t["default"]=v;var g=function(){return new v};t.orbit=g},function(e,t,n){"use strict";function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(){}var i=Object.prototype.hasOwnProperty,a="function"!=typeof Object.create&&"~";o.prototype._events=void 0,o.prototype.eventNames=function(){var e,t=this._events,n=[];if(!t)return n;for(e in t)i.call(t,e)&&n.push(a?e.slice(1):e);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},o.prototype.listeners=function(e,t){var n=a?a+e:e,r=this._events&&this._events[n];if(t)return!!r;if(!r)return[];if(r.fn)return[r.fn];for(var o=0,i=r.length,s=new Array(i);o<i;o++)s[o]=r[o].fn;return s},o.prototype.emit=function(e,t,n,r,o,i){var s=a?a+e:e;if(!this._events||!this._events[s])return!1;var u,l,c=this._events[s],f=arguments.length;if("function"==typeof c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),f){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,r),!0;case 5:return c.fn.call(c.context,t,n,r,o),!0;case 6:return c.fn.call(c.context,t,n,r,o,i),!0}for(l=1,u=new Array(f-1);l<f;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var p,h=c.length;for(l=0;l<h;l++)switch(c[l].once&&this.removeListener(e,c[l].fn,void 0,!0),f){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,t);break;case 3:c[l].fn.call(c[l].context,t,n);break;default:if(!u)for(p=1,u=new Array(f-1);p<f;p++)u[p-1]=arguments[p];c[l].fn.apply(c[l].context,u)}}return!0},o.prototype.on=function(e,t,n){var o=new r(t,n||this),i=a?a+e:e;return this._events||(this._events=a?{}:Object.create(null)),this._events[i]?this._events[i].fn?this._events[i]=[this._events[i],o]:this._events[i].push(o):this._events[i]=o,this},o.prototype.once=function(e,t,n){var o=new r(t,n||this,(!0)),i=a?a+e:e;return this._events||(this._events=a?{}:Object.create(null)),this._events[i]?this._events[i].fn?this._events[i]=[this._events[i],o]:this._events[i].push(o):this._events[i]=o,this},o.prototype.removeListener=function(e,t,n,r){var o=a?a+e:e;if(!this._events||!this._events[o])return this;var i=this._events[o],s=[];if(t)if(i.fn)(i.fn!==t||r&&!i.once||n&&i.context!==n)&&s.push(i);else for(var u=0,l=i.length;u<l;u++)(i[u].fn!==t||r&&!i[u].once||n&&i[u].context!==n)&&s.push(i[u]);return s.length?this._events[o]=1===s.length?s[0]:s:delete this._events[o],this},o.prototype.removeAllListeners=function(e){return this._events?(e?delete this._events[a?a+e:e]:this._events=a?{}:Object.create(null),this):this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prototype.setMaxListeners=function(){return this},o.prefixed=a,e.exports=o},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE_4__},function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),i=r(o),a=n(6),s=r(a),u=function(e,t){function n(){return 2*Math.PI/60/60*B.autoRotateSpeed}function r(){return Math.pow(.95,B.zoomSpeed)}function o(e){X-=e}function a(e){Z-=e}function u(e){B.object instanceof i["default"].PerspectiveCamera?J/=e:B.object instanceof i["default"].OrthographicCamera?(B.object.zoom=Math.max(B.minZoom,Math.min(B.maxZoom,B.object.zoom*e)),B.object.updateProjectionMatrix(),K=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),B.enableZoom=!1)}function l(e){B.object instanceof i["default"].PerspectiveCamera?J*=e:B.object instanceof i["default"].OrthographicCamera?(B.object.zoom=Math.max(B.minZoom,Math.min(B.maxZoom,B.object.zoom/e)),B.object.updateProjectionMatrix(),K=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),B.enableZoom=!1)}function c(e){$.set(e.clientX,e.clientY)}function f(e){oe.set(e.clientX,e.clientY)}function p(e){te.set(e.clientX,e.clientY)}function h(e){Q.set(e.clientX,e.clientY),ee.subVectors(Q,$);var t=B.domElement===document?B.domElement.body:B.domElement;o(2*Math.PI*ee.x/t.clientWidth*B.rotateSpeed),a(2*Math.PI*ee.y/t.clientHeight*B.rotateSpeed),$.copy(Q),B.update()}function d(e){ie.set(e.clientX,e.clientY),ae.subVectors(ie,oe),ae.y>0?u(r()):ae.y<0&&l(r()),oe.copy(ie),B.update()}function y(e){ne.set(e.clientX,e.clientY),re.subVectors(ne,te),le(re.x,re.y),te.copy(ne),B.update()}function v(e){}function g(e){var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t>0?l(r()):t<0&&u(r()),B.update()}function m(e){switch(e.keyCode){case B.keys.UP:le(0,B.keyPanSpeed),B.update(),B.dispatchEvent(U);break;case B.keys.BOTTOM:le(0,-B.keyPanSpeed),B.update(),B.dispatchEvent(U);break;case B.keys.LEFT:le(B.keyPanSpeed,0),B.update(),B.dispatchEvent(U);break;case B.keys.RIGHT:le(-B.keyPanSpeed,0),B.update(),B.dispatchEvent(U);break;case B.keys.CTRL:H.CTRL=!0}}function _(e){switch(e.keyCode){case B.keys.CTRL:H.CTRL=!1}}function b(e){$.set(e.pointers[0].pageX,e.pointers[0].pageY)}function w(e){var t=e.pointers[0].pageX-e.pointers[1].pageX,n=e.pointers[0].pageY-e.pointers[1].pageY,r=Math.sqrt(t*t+n*n);oe.set(0,r)}function x(e){te.set(e.deltaX,e.deltaY)}function O(e){Q.set(e.pointers[0].pageX,e.pointers[0].pageY),ee.subVectors(Q,$);var t=B.domElement===document?B.domElement.body:B.domElement;o(2*Math.PI*ee.x/t.clientWidth*B.rotateSpeed),a(2*Math.PI*ee.y/t.clientHeight*B.rotateSpeed),$.copy(Q),B.update()}function k(e){var t=e.pointers[0].pageX-e.pointers[1].pageX,n=e.pointers[0].pageY-e.pointers[1].pageY,o=Math.sqrt(t*t+n*n);ie.set(0,o),ae.subVectors(ie,oe),ae.y>0?l(r()):ae.y<0&&u(r()),oe.copy(ie),B.update()}function P(e){ne.set(e.deltaX,e.deltaY),re.subVectors(ne,te),le(re.x,re.y),te.copy(ne),B.update()}function M(e){}function T(e){if(B.enabled!==!1){if(e.preventDefault(),e.button===B.mouseButtons.ORBIT)if(H.CTRL){if(B.enablePan===!1)return;p(e),G=q.PAN}else{if(B.enableRotate===!1)return;c(e),G=q.ROTATE}else if(e.button===B.mouseButtons.ZOOM){if(B.enableZoom===!1)return;f(e),G=q.DOLLY}else if(e.button===B.mouseButtons.PAN){if(B.enablePan===!1)return;p(e),G=q.PAN}G!==q.NONE&&(document.addEventListener("mousemove",j,!1),document.addEventListener("mouseup",A,!1),document.addEventListener("mouseout",A,!1),B.dispatchEvent(W))}}function j(e){if(B.enabled!==!1)if(e.preventDefault(),G===q.ROTATE){if(B.enableRotate===!1)return;h(e)}else if(G===q.DOLLY){if(B.enableZoom===!1)return;d(e)}else if(G===q.PAN){if(B.enablePan===!1)return;y(e)}}function A(e){B.enabled!==!1&&(v(e),document.removeEventListener("mousemove",j,!1),document.removeEventListener("mouseup",A,!1),document.removeEventListener("mouseout",A,!1),B.dispatchEvent(U),G=q.NONE)}function E(e){B.enabled!==!1&&B.enableZoom!==!1&&G===q.NONE&&(e.preventDefault(),e.stopPropagation(),g(e),B.dispatchEvent(W),B.dispatchEvent(U))}function S(e){B.enabled!==!1&&B.enableKeys!==!1&&B.enablePan!==!1&&m(e)}function C(e){B.enabled!==!1&&B.enableKeys!==!1&&B.enablePan!==!1&&_(e)}function L(e){if(B.enabled!==!1){switch(e.touches.length){case 1:if(B.enableRotate===!1)return;b(e),G=q.TOUCH_ROTATE;break;case 2:if(B.enableZoom===!1)return;w(e),G=q.TOUCH_DOLLY;break;case 3:if(B.enablePan===!1)return;x(e),G=q.TOUCH_PAN;break;default:G=q.NONE}G!==q.NONE&&B.dispatchEvent(W)}}function D(e){if(B.enabled!==!1)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(B.enableRotate===!1)return;if(G!==q.TOUCH_ROTATE)return;O(e);break;case 2:if(B.enableZoom===!1)return;if(G!==q.TOUCH_DOLLY)return;k(e);break;case 3:if(B.enablePan===!1)return;if(G!==q.TOUCH_PAN)return;P(e);break;default:G=q.NONE}}function R(e){B.enabled!==!1&&(M(e),B.dispatchEvent(U),G=q.NONE)}function F(e){e.preventDefault()}this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new i["default"].Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-(1/0),this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40,CTRL:17},this.mouseButtons={ORBIT:i["default"].MOUSE.LEFT,ZOOM:i["default"].MOUSE.MIDDLE,PAN:i["default"].MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return N},this.getAzimuthalAngle=function(){return I},this.reset=function(){B.target.copy(B.target0),B.object.position.copy(B.position0),B.object.zoom=B.zoom0,B.object.updateProjectionMatrix(),B.dispatchEvent(z),B.update(),G=q.NONE},this.update=function(){var t=new i["default"].Vector3,r=(new i["default"].Quaternion).setFromUnitVectors(e.up,new i["default"].Vector3(0,1,0)),a=r.clone().inverse(),s=new i["default"].Vector3,u=new i["default"].Quaternion;return function(){var e=B.object.position;t.copy(e).sub(B.target),t.applyQuaternion(r),I=Math.atan2(t.x,t.z),N=Math.atan2(Math.sqrt(t.x*t.x+t.z*t.z),t.y),B.autoRotate&&G===q.NONE&&o(n()),I+=X,N+=Z,I=Math.max(B.minAzimuthAngle,Math.min(B.maxAzimuthAngle,I)),N=Math.max(B.minPolarAngle,Math.min(B.maxPolarAngle,N)),N=Math.max(V,Math.min(Math.PI-V,N));var i=t.length()*J;return i=Math.max(B.minDistance,Math.min(B.maxDistance,i)),B.target.add(Y),t.x=i*Math.sin(N)*Math.sin(I),t.y=i*Math.cos(N),t.z=i*Math.sin(N)*Math.cos(I),t.applyQuaternion(a),e.copy(B.target).add(t),B.object.lookAt(B.target),B.enableDamping===!0?(X*=1-B.dampingFactor,Z*=1-B.dampingFactor):(X=0,Z=0),J=1,Y.set(0,0,0),!!(K||s.distanceToSquared(B.object.position)>V||8*(1-u.dot(B.object.quaternion))>V)&&(B.dispatchEvent(z),s.copy(B.object.position),u.copy(B.object.quaternion),K=!1,!0)}}(),this.dispose=function(){B.domElement.removeEventListener("contextmenu",F,!1),B.domElement.removeEventListener("mousedown",T,!1),B.domElement.removeEventListener("mousewheel",E,!1),B.domElement.removeEventListener("MozMousePixelScroll",E,!1),B.domElement.removeEventListener("touchstart",L,!1),B.domElement.removeEventListener("touchend",R,!1),B.domElement.removeEventListener("touchmove",D,!1),document.removeEventListener("mousemove",j,!1),document.removeEventListener("mouseup",A,!1),document.removeEventListener("mouseout",A,!1),window.removeEventListener("keydown",S,!1),window.removeEventListener("keyup",C,!1)};var I,N,B=this,z={type:"change"},W={type:"start"},U={type:"end"},q={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},H={CTRL:!1},G=q.NONE,V=1e-6,Z=0,X=0,J=1,Y=new i["default"].Vector3,K=!1,$=new i["default"].Vector2,Q=new i["default"].Vector2,ee=new i["default"].Vector2,te=new i["default"].Vector2,ne=new i["default"].Vector2,re=new i["default"].Vector2,oe=new i["default"].Vector2,ie=new i["default"].Vector2,ae=new i["default"].Vector2,se=function(){var e=new i["default"].Vector3;return function(t,n){var r=n.elements;e.set(r[0],0,r[2]),e.multiplyScalar(-t),Y.add(e)}}(),ue=function(){var e=new i["default"].Vector3;return function(t,n){var r=n.elements,o=t/Math.cos(N);e.set(r[4],0,r[6]),e.multiplyScalar(o),Y.add(e)}}(),le=function(){var e=new i["default"].Vector3;return function(t,n){var r=B.domElement===document?B.domElement.body:B.domElement;if(B.object instanceof i["default"].PerspectiveCamera){var o=B.object.position;e.copy(o).sub(B.target);var a=e.length();a*=Math.tan(B.object.fov/2*Math.PI/180),se(2*t*a/r.clientHeight,B.object.matrix),ue(2*n*a/r.clientHeight,B.object.matrix)}else B.object instanceof i["default"].OrthographicCamera?(se(t*(B.object.right-B.object.left)/r.clientWidth,B.object.matrix),ue(n*(B.object.top-B.object.bottom)/r.clientHeight,B.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),B.enablePan=!1)}}();B.domElement.addEventListener("contextmenu",F,!1),B.domElement.addEventListener("mousedown",T,!1),B.domElement.addEventListener("mousewheel",E,!1),B.domElement.addEventListener("MozMousePixelScroll",E,!1),B.hammer=new s["default"](B.domElement),B.hammer.get("pan").set({pointers:0,direction:s["default"].DIRECTION_ALL}),B.hammer.get("pinch").set({enable:!0,threshold:.1}),B.hammer.on("panstart",function(e){if(B.enabled!==!1&&"mouse"!==e.pointerType){if(1===e.pointers.length){if(B.enablePan===!1)return;x(e),G=q.TOUCH_PAN}else if(2===e.pointers.length){if(B.enableRotate===!1)return;b(e),G=q.TOUCH_ROTATE}G!==q.NONE&&B.dispatchEvent(W)}}),B.hammer.on("panend",function(e){"mouse"!==e.pointerType&&R(e)}),B.hammer.on("panmove",function(e){if(B.enabled!==!1&&"mouse"!==e.pointerType)if(1===e.pointers.length){if(B.enablePan===!1)return;if(G!==q.TOUCH_PAN)return;P(e)}else if(2===e.pointers.length){if(B.enableRotate===!1)return;if(G!==q.TOUCH_ROTATE)return;O(e)}}),B.hammer.on("pinchstart",function(e){B.enabled!==!1&&"mouse"!==e.pointerType&&B.enableZoom!==!1&&(w(e),G=q.TOUCH_DOLLY,G!==q.NONE&&B.dispatchEvent(W))}),B.hammer.on("pinchend",function(e){"mouse"!==e.pointerType&&R(e)}),B.hammer.on("pinchmove",function(e){B.enabled!==!1&&"mouse"!==e.pointerType&&B.enableZoom!==!1&&G===q.TOUCH_DOLLY&&k(e)}),window.addEventListener("keydown",S,!1),window.addEventListener("keyup",C,!1),this.panLeft=se,this.panUp=ue,this.pan=le,this.dollyIn=u,this.dollyOut=l,this.getZoomScale=r,this.rotateLeft=o,this.rotateUp=a,this.update()};u.prototype=Object.create(i["default"].EventDispatcher.prototype),u.prototype.constructor=i["default"].OrbitControls,Object.defineProperties(u.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.constraint.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.constraint.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.constraint.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.constraint.dampingFactor=e}}}),t["default"]=u,e.exports=t["default"]},function(e,t,n){var r;!function(o,i,a,s){"use strict";function u(e,t,n){return setTimeout(h(e,n),t)}function l(e,t,n){return!!Array.isArray(e)&&(c(e,n[t],n),!0)}function c(e,t,n){var r;if(e)if(e.forEach)e.forEach(t,n);else if(e.length!==s)for(r=0;r<e.length;)t.call(n,e[r],r,e),r++;else for(r in e)e.hasOwnProperty(r)&&t.call(n,e[r],r,e)}function f(e,t,n){var r="DEPRECATED METHOD: "+t+"\n"+n+" AT \n";return function(){var t=new Error("get-stack-trace"),n=t&&t.stack?t.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",i=o.console&&(o.console.warn||o.console.log);return i&&i.call(o.console,r,n),e.apply(this,arguments)}}function p(e,t,n){var r,o=t.prototype;r=e.prototype=Object.create(o),r.constructor=e,r._super=o,n&&ye(r,n)}function h(e,t){return function(){return e.apply(t,arguments)}}function d(e,t){return typeof e==me?e.apply(t?t[0]||s:s,t):e}function y(e,t){return e===s?t:e}function v(e,t,n){c(b(t),function(t){e.addEventListener(t,n,!1)})}function g(e,t,n){c(b(t),function(t){e.removeEventListener(t,n,!1)})}function m(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function _(e,t){return e.indexOf(t)>-1}function b(e){return e.trim().split(/\s+/g)}function w(e,t,n){if(e.indexOf&&!n)return e.indexOf(t);for(var r=0;r<e.length;){if(n&&e[r][n]==t||!n&&e[r]===t)return r;r++}return-1}function x(e){return Array.prototype.slice.call(e,0)}function O(e,t,n){for(var r=[],o=[],i=0;i<e.length;){var a=t?e[i][t]:e[i];w(o,a)<0&&r.push(e[i]),o[i]=a,i++}return n&&(r=t?r.sort(function(e,n){return e[t]>n[t]}):r.sort()),r}function k(e,t){for(var n,r,o=t[0].toUpperCase()+t.slice(1),i=0;i<ve.length;){if(n=ve[i],r=n?n+o:t,r in e)return r;i++}return s}function P(){return ke++}function M(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow||o}function T(e,t){var n=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){d(e.options.enable,[e])&&n.handler(t)},this.init()}function j(e){var t,n=e.options.inputClass;return new(t=n?n:Te?U:je?G:Me?Z:W)(e,A)}function A(e,t,n){var r=n.pointers.length,o=n.changedPointers.length,i=t&De&&r-o===0,a=t&(Fe|Ie)&&r-o===0;n.isFirst=!!i,n.isFinal=!!a,i&&(e.session={}),n.eventType=t,E(e,n),e.emit("hammer.input",n),e.recognize(n),e.session.prevInput=n}function E(e,t){var n=e.session,r=t.pointers,o=r.length;n.firstInput||(n.firstInput=L(t)),o>1&&!n.firstMultiple?n.firstMultiple=L(t):1===o&&(n.firstMultiple=!1);var i=n.firstInput,a=n.firstMultiple,s=a?a.center:i.center,u=t.center=D(r);t.timeStamp=we(),t.deltaTime=t.timeStamp-i.timeStamp,t.angle=N(s,u),t.distance=I(s,u),S(n,t),t.offsetDirection=F(t.deltaX,t.deltaY);var l=R(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=l.x,t.overallVelocityY=l.y,t.overallVelocity=be(l.x)>be(l.y)?l.x:l.y,t.scale=a?z(a.pointers,r):1,t.rotation=a?B(a.pointers,r):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length,C(n,t);var c=e.element;m(t.srcEvent.target,c)&&(c=t.srcEvent.target),t.target=c}function S(e,t){var n=t.center,r=e.offsetDelta||{},o=e.prevDelta||{},i=e.prevInput||{};t.eventType!==De&&i.eventType!==Fe||(o=e.prevDelta={x:i.deltaX||0,y:i.deltaY||0},r=e.offsetDelta={x:n.x,y:n.y}),t.deltaX=o.x+(n.x-r.x),t.deltaY=o.y+(n.y-r.y)}function C(e,t){var n,r,o,i,a=e.lastInterval||t,u=t.timeStamp-a.timeStamp;if(t.eventType!=Ie&&(u>Le||a.velocity===s)){var l=t.deltaX-a.deltaX,c=t.deltaY-a.deltaY,f=R(u,l,c);r=f.x,o=f.y,n=be(f.x)>be(f.y)?f.x:f.y,i=F(l,c),e.lastInterval=t}else n=a.velocity,r=a.velocityX,o=a.velocityY,i=a.direction;t.velocity=n,t.velocityX=r,t.velocityY=o,t.direction=i}function L(e){for(var t=[],n=0;n<e.pointers.length;)t[n]={clientX:_e(e.pointers[n].clientX),clientY:_e(e.pointers[n].clientY)},n++;return{timeStamp:we(),pointers:t,center:D(t),deltaX:e.deltaX,deltaY:e.deltaY}}function D(e){var t=e.length;if(1===t)return{x:_e(e[0].clientX),y:_e(e[0].clientY)};for(var n=0,r=0,o=0;o<t;)n+=e[o].clientX,r+=e[o].clientY,o++;return{x:_e(n/t),y:_e(r/t)}}function R(e,t,n){return{x:t/e||0,y:n/e||0}}function F(e,t){return e===t?Ne:be(e)>=be(t)?e<0?Be:ze:t<0?We:Ue}function I(e,t,n){n||(n=Ve);var r=t[n[0]]-e[n[0]],o=t[n[1]]-e[n[1]];return Math.sqrt(r*r+o*o)}function N(e,t,n){n||(n=Ve);var r=t[n[0]]-e[n[0]],o=t[n[1]]-e[n[1]];return 180*Math.atan2(o,r)/Math.PI}function B(e,t){return N(t[1],t[0],Ze)+N(e[1],e[0],Ze)}function z(e,t){return I(t[0],t[1],Ze)/I(e[0],e[1],Ze)}function W(){this.evEl=Je,this.evWin=Ye,this.pressed=!1,T.apply(this,arguments)}function U(){this.evEl=Qe,this.evWin=et,T.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function q(){this.evTarget=nt,this.evWin=rt,this.started=!1,T.apply(this,arguments)}function H(e,t){var n=x(e.touches),r=x(e.changedTouches);return t&(Fe|Ie)&&(n=O(n.concat(r),"identifier",!0)),[n,r]}function G(){this.evTarget=it,this.targetIds={},T.apply(this,arguments)}function V(e,t){var n=x(e.touches),r=this.targetIds;if(t&(De|Re)&&1===n.length)return r[n[0].identifier]=!0,[n,n];var o,i,a=x(e.changedTouches),s=[],u=this.target;if(i=n.filter(function(e){return m(e.target,u)}),t===De)for(o=0;o<i.length;)r[i[o].identifier]=!0,o++;for(o=0;o<a.length;)r[a[o].identifier]&&s.push(a[o]),t&(Fe|Ie)&&delete r[a[o].identifier],o++;return s.length?[O(i.concat(s),"identifier",!0),s]:void 0}function Z(){T.apply(this,arguments);var e=h(this.handler,this);this.touch=new G(this.manager,e),this.mouse=new W(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function X(e,t){e&De?(this.primaryTouch=t.changedPointers[0].identifier,J.call(this,t)):e&(Fe|Ie)&&J.call(this,t)}function J(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var n={x:t.clientX,y:t.clientY};this.lastTouches.push(n);var r=this.lastTouches,o=function(){var e=r.indexOf(n);e>-1&&r.splice(e,1)};setTimeout(o,at)}}function Y(e){for(var t=e.srcEvent.clientX,n=e.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var o=this.lastTouches[r],i=Math.abs(t-o.x),a=Math.abs(n-o.y);if(i<=st&&a<=st)return!0}return!1}function K(e,t){this.manager=e,this.set(t)}function $(e){if(_(e,ht))return ht;var t=_(e,dt),n=_(e,yt);return t&&n?ht:t||n?t?dt:yt:_(e,pt)?pt:ft}function Q(){if(!lt)return!1;var e={},t=o.CSS&&o.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(n){e[n]=!t||o.CSS.supports("touch-action",n)}),e}function ee(e){this.options=ye({},this.defaults,e||{}),this.id=P(),this.manager=null,this.options.enable=y(this.options.enable,!0),this.state=gt,this.simultaneous={},this.requireFail=[]}function te(e){return e&xt?"cancel":e&bt?"end":e&_t?"move":e&mt?"start":""}function ne(e){return e==Ue?"down":e==We?"up":e==Be?"left":e==ze?"right":""}function re(e,t){var n=t.manager;return n?n.get(e):e}function oe(){ee.apply(this,arguments)}function ie(){oe.apply(this,arguments),this.pX=null,this.pY=null}function ae(){oe.apply(this,arguments)}function se(){ee.apply(this,arguments),this._timer=null,this._input=null}function ue(){oe.apply(this,arguments)}function le(){oe.apply(this,arguments)}function ce(){ee.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function fe(e,t){return t=t||{},t.recognizers=y(t.recognizers,fe.defaults.preset),new pe(e,t)}function pe(e,t){this.options=ye({},fe.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=j(this),this.touchAction=new K(this,this.options.touchAction),he(this,!0),c(this.options.recognizers,function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])},this)}function he(e,t){var n=e.element;if(n.style){var r;c(e.options.cssProps,function(o,i){r=k(n.style,i),t?(e.oldCssProps[r]=n.style[r],n.style[r]=o):n.style[r]=e.oldCssProps[r]||""}),t||(e.oldCssProps={})}}function de(e,t){var n=i.createEvent("Event");n.initEvent(e,!0,!0),n.gesture=t,t.target.dispatchEvent(n)}var ye,ve=["","webkit","Moz","MS","ms","o"],ge=i.createElement("div"),me="function",_e=Math.round,be=Math.abs,we=Date.now;ye="function"!=typeof Object.assign?function(e){if(e===s||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(r!==s&&null!==r)for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])}return t}:Object.assign;var xe=f(function(e,t,n){for(var r=Object.keys(t),o=0;o<r.length;)(!n||n&&e[r[o]]===s)&&(e[r[o]]=t[r[o]]),o++;return e},"extend","Use `assign`."),Oe=f(function(e,t){return xe(e,t,!0)},"merge","Use `assign`."),ke=1,Pe=/mobile|tablet|ip(ad|hone|od)|android/i,Me="ontouchstart"in o,Te=k(o,"PointerEvent")!==s,je=Me&&Pe.test(navigator.userAgent),Ae="touch",Ee="pen",Se="mouse",Ce="kinect",Le=25,De=1,Re=2,Fe=4,Ie=8,Ne=1,Be=2,ze=4,We=8,Ue=16,qe=Be|ze,He=We|Ue,Ge=qe|He,Ve=["x","y"],Ze=["clientX","clientY"];T.prototype={handler:function(){},init:function(){this.evEl&&v(this.element,this.evEl,this.domHandler),this.evTarget&&v(this.target,this.evTarget,this.domHandler),this.evWin&&v(M(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&g(this.element,this.evEl,this.domHandler),
this.evTarget&&g(this.target,this.evTarget,this.domHandler),this.evWin&&g(M(this.element),this.evWin,this.domHandler)}};var Xe={mousedown:De,mousemove:Re,mouseup:Fe},Je="mousedown",Ye="mousemove mouseup";p(W,T,{handler:function(e){var t=Xe[e.type];t&De&&0===e.button&&(this.pressed=!0),t&Re&&1!==e.which&&(t=Fe),this.pressed&&(t&Fe&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:Se,srcEvent:e}))}});var Ke={pointerdown:De,pointermove:Re,pointerup:Fe,pointercancel:Ie,pointerout:Ie},$e={2:Ae,3:Ee,4:Se,5:Ce},Qe="pointerdown",et="pointermove pointerup pointercancel";o.MSPointerEvent&&!o.PointerEvent&&(Qe="MSPointerDown",et="MSPointerMove MSPointerUp MSPointerCancel"),p(U,T,{handler:function(e){var t=this.store,n=!1,r=e.type.toLowerCase().replace("ms",""),o=Ke[r],i=$e[e.pointerType]||e.pointerType,a=i==Ae,s=w(t,e.pointerId,"pointerId");o&De&&(0===e.button||a)?s<0&&(t.push(e),s=t.length-1):o&(Fe|Ie)&&(n=!0),s<0||(t[s]=e,this.callback(this.manager,o,{pointers:t,changedPointers:[e],pointerType:i,srcEvent:e}),n&&t.splice(s,1))}});var tt={touchstart:De,touchmove:Re,touchend:Fe,touchcancel:Ie},nt="touchstart",rt="touchstart touchmove touchend touchcancel";p(q,T,{handler:function(e){var t=tt[e.type];if(t===De&&(this.started=!0),this.started){var n=H.call(this,e,t);t&(Fe|Ie)&&n[0].length-n[1].length===0&&(this.started=!1),this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:Ae,srcEvent:e})}}});var ot={touchstart:De,touchmove:Re,touchend:Fe,touchcancel:Ie},it="touchstart touchmove touchend touchcancel";p(G,T,{handler:function(e){var t=ot[e.type],n=V.call(this,e,t);n&&this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:Ae,srcEvent:e})}});var at=2500,st=25;p(Z,T,{handler:function(e,t,n){var r=n.pointerType==Ae,o=n.pointerType==Se;if(!(o&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(r)X.call(this,t,n);else if(o&&Y.call(this,n))return;this.callback(e,t,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var ut=k(ge.style,"touchAction"),lt=ut!==s,ct="compute",ft="auto",pt="manipulation",ht="none",dt="pan-x",yt="pan-y",vt=Q();K.prototype={set:function(e){e==ct&&(e=this.compute()),lt&&this.manager.element.style&&vt[e]&&(this.manager.element.style[ut]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return c(this.manager.recognizers,function(t){d(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))}),$(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,n=e.offsetDirection;if(this.manager.session.prevented)return void t.preventDefault();var r=this.actions,o=_(r,ht)&&!vt[ht],i=_(r,yt)&&!vt[yt],a=_(r,dt)&&!vt[dt];if(o){var s=1===e.pointers.length,u=e.distance<2,l=e.deltaTime<250;if(s&&u&&l)return}return a&&i?void 0:o||i&&n&qe||a&&n&He?this.preventSrc(t):void 0},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var gt=1,mt=2,_t=4,bt=8,wt=bt,xt=16,Ot=32;ee.prototype={defaults:{},set:function(e){return ye(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(l(e,"recognizeWith",this))return this;var t=this.simultaneous;return e=re(e,this),t[e.id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return l(e,"dropRecognizeWith",this)?this:(e=re(e,this),delete this.simultaneous[e.id],this)},requireFailure:function(e){if(l(e,"requireFailure",this))return this;var t=this.requireFail;return e=re(e,this),w(t,e)===-1&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(l(e,"dropRequireFailure",this))return this;e=re(e,this);var t=w(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){function t(t){n.manager.emit(t,e)}var n=this,r=this.state;r<bt&&t(n.options.event+te(r)),t(n.options.event),e.additionalEvent&&t(e.additionalEvent),r>=bt&&t(n.options.event+te(r))},tryEmit:function(e){return this.canEmit()?this.emit(e):void(this.state=Ot)},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(this.requireFail[e].state&(Ot|gt)))return!1;e++}return!0},recognize:function(e){var t=ye({},e);return d(this.options.enable,[this,t])?(this.state&(wt|xt|Ot)&&(this.state=gt),this.state=this.process(t),void(this.state&(mt|_t|bt|xt)&&this.tryEmit(t))):(this.reset(),void(this.state=Ot))},process:function(e){},getTouchAction:function(){},reset:function(){}},p(oe,ee,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,n=e.eventType,r=t&(mt|_t),o=this.attrTest(e);return r&&(n&Ie||!o)?t|xt:r||o?n&Fe?t|bt:t&mt?t|_t:mt:Ot}}),p(ie,oe,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ge},getTouchAction:function(){var e=this.options.direction,t=[];return e&qe&&t.push(yt),e&He&&t.push(dt),t},directionTest:function(e){var t=this.options,n=!0,r=e.distance,o=e.direction,i=e.deltaX,a=e.deltaY;return o&t.direction||(t.direction&qe?(o=0===i?Ne:i<0?Be:ze,n=i!=this.pX,r=Math.abs(e.deltaX)):(o=0===a?Ne:a<0?We:Ue,n=a!=this.pY,r=Math.abs(e.deltaY))),e.direction=o,n&&r>t.threshold&&o&t.direction},attrTest:function(e){return oe.prototype.attrTest.call(this,e)&&(this.state&mt||!(this.state&mt)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=ne(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),p(ae,oe,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[ht]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||this.state&mt)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),p(se,ee,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[ft]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,o=e.deltaTime>t.time;if(this._input=e,!r||!n||e.eventType&(Fe|Ie)&&!o)this.reset();else if(e.eventType&De)this.reset(),this._timer=u(function(){this.state=wt,this.tryEmit()},t.time,this);else if(e.eventType&Fe)return wt;return Ot},reset:function(){clearTimeout(this._timer)},emit:function(e){this.state===wt&&(e&&e.eventType&Fe?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=we(),this.manager.emit(this.options.event,this._input)))}}),p(ue,oe,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[ht]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||this.state&mt)}}),p(le,oe,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:qe|He,pointers:1},getTouchAction:function(){return ie.prototype.getTouchAction.call(this)},attrTest:function(e){var t,n=this.options.direction;return n&(qe|He)?t=e.overallVelocity:n&qe?t=e.overallVelocityX:n&He&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&n&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&be(t)>this.options.velocity&&e.eventType&Fe},emit:function(e){var t=ne(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),p(ce,ee,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[pt]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,o=e.deltaTime<t.time;if(this.reset(),e.eventType&De&&0===this.count)return this.failTimeout();if(r&&o&&n){if(e.eventType!=Fe)return this.failTimeout();var i=!this.pTime||e.timeStamp-this.pTime<t.interval,a=!this.pCenter||I(this.pCenter,e.center)<t.posThreshold;this.pTime=e.timeStamp,this.pCenter=e.center,a&&i?this.count+=1:this.count=1,this._input=e;var s=this.count%t.taps;if(0===s)return this.hasRequireFailures()?(this._timer=u(function(){this.state=wt,this.tryEmit()},t.interval,this),mt):wt}return Ot},failTimeout:function(){return this._timer=u(function(){this.state=Ot},this.options.interval,this),Ot},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==wt&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),fe.VERSION="2.0.7",fe.defaults={domEvents:!1,touchAction:ct,enable:!0,inputTarget:null,inputClass:null,preset:[[ue,{enable:!1}],[ae,{enable:!1},["rotate"]],[le,{direction:qe}],[ie,{direction:qe},["swipe"]],[ce],[ce,{event:"doubletap",taps:2},["tap"]],[se]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var kt=1,Pt=2;pe.prototype={set:function(e){return ye(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?Pt:kt},recognize:function(e){var t=this.session;if(!t.stopped){this.touchAction.preventDefaults(e);var n,r=this.recognizers,o=t.curRecognizer;(!o||o&&o.state&wt)&&(o=t.curRecognizer=null);for(var i=0;i<r.length;)n=r[i],t.stopped===Pt||o&&n!=o&&!n.canRecognizeWith(o)?n.reset():n.recognize(e),!o&&n.state&(mt|_t|bt)&&(o=t.curRecognizer=n),i++}},get:function(e){if(e instanceof ee)return e;for(var t=this.recognizers,n=0;n<t.length;n++)if(t[n].options.event==e)return t[n];return null},add:function(e){if(l(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(l(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,n=w(t,e);n!==-1&&(t.splice(n,1),this.touchAction.update())}return this},on:function(e,t){if(e!==s&&t!==s){var n=this.handlers;return c(b(e),function(e){n[e]=n[e]||[],n[e].push(t)}),this}},off:function(e,t){if(e!==s){var n=this.handlers;return c(b(e),function(e){t?n[e]&&n[e].splice(w(n[e],t),1):delete n[e]}),this}},emit:function(e,t){this.options.domEvents&&de(e,t);var n=this.handlers[e]&&this.handlers[e].slice();if(n&&n.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var r=0;r<n.length;)n[r](t),r++}},destroy:function(){this.element&&he(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},ye(fe,{INPUT_START:De,INPUT_MOVE:Re,INPUT_END:Fe,INPUT_CANCEL:Ie,STATE_POSSIBLE:gt,STATE_BEGAN:mt,STATE_CHANGED:_t,STATE_ENDED:bt,STATE_RECOGNIZED:wt,STATE_CANCELLED:xt,STATE_FAILED:Ot,DIRECTION_NONE:Ne,DIRECTION_LEFT:Be,DIRECTION_RIGHT:ze,DIRECTION_UP:We,DIRECTION_DOWN:Ue,DIRECTION_HORIZONTAL:qe,DIRECTION_VERTICAL:He,DIRECTION_ALL:Ge,Manager:pe,Input:T,TouchAction:K,TouchInput:G,MouseInput:W,PointerEventInput:U,TouchMouseInput:Z,SingleTouchInput:q,Recognizer:ee,AttrRecognizer:oe,Tap:ce,Pan:ie,Swipe:le,Pinch:ae,Rotate:ue,Press:se,on:v,off:g,each:c,merge:Oe,extend:xe,assign:ye,inherit:p,bindFn:h,prefixed:k});var Mt="undefined"!=typeof o?o:"undefined"!=typeof self?self:{};Mt.Hammer=fe,r=function(){return fe}.call(t,n,t,e),!(r!==s&&(e.exports=r))}(window,document,"Hammer")},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE_7__},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),o=n(10),i={};i.R=6378137,i.MAX_LATITUDE=85.0511287798,i.ECC=.081819191,i.ECC2=.006694380015894481,i.multiplier=.1,i.project=function(e){var t=Math.PI/180,n=i.MAX_LATITUDE,r=Math.max(Math.min(n,e.lat),-n),a=Math.sin(r*t);return(0,o.point)(i.R*e.lon*t,i.R*Math.log((1+a)/(1-a))/2)},i.unproject=function(e){var t=180/Math.PI;return(0,r.latLon)((2*Math.atan(Math.exp(e.y/i.R))-Math.PI/2)*t,e.x*t/i.R)},i.latLonToPoint=function(e){var t=i.project(e);return t.y*=-1,t.x*=i.multiplier,t.y*=i.multiplier,t},i.pointToLatLon=function(e){var t=(0,o.point)(e.x,e.y*-1);return t.x/=i.multiplier,t.y/=i.multiplier,i.unproject(t)},i.pointScale=function(e,t){var n,r=Math.PI/180;if(t){var o=e.lat*r,a=(e.lon*r,i.R),s=Math.sin(o),u=s*s,l=Math.cos(o),c=a*(1-i.ECC2)/Math.pow(1-i.ECC2*u,1.5),f=a/Math.sqrt(1-i.ECC2*u),p=a/c/l;return n=a/f/l,[n,p]}return n=1/Math.cos(e.lat*r),[n,n]},i.metresToProjected=function(e,t){return e*t[1]},i.projectedToMetres=function(e,t){return e/t[1]},i.metresToWorld=function(e,t){var n=i.metresToProjected(e,t);return n*i.multiplier},i.worldToMetres=function(e,t){var n=e,r=i.projectedToMetres(n,t);return r/i.multiplier},i.scale=function(e){return 256*Math.pow(2,e)},i.zoom=function(e){return Math.log(e/256)/Math.LN2},i.distance=function(e,t,n){var r,o,a,s=Math.PI/180;if(n){r=e.lat*s,o=t.lat*s;var u=e.lon*s,l=t.lon*s,c=o-r,f=l-u,p=c/2,h=f/2;a=Math.sin(p)*Math.sin(p)+Math.cos(r)*Math.cos(o)*Math.sin(h)*Math.sin(h);var d=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return i.R*d}return r=e.lat*s,o=t.lat*s,a=Math.sin(r)*Math.sin(o)+Math.cos(r)*Math.cos(o)*Math.cos((t.lon-e.lon)*s),i.R*Math.acos(Math.min(a,1))},i.bounds=function(){var e=i.R*Math.PI*i.multiplier;return[[-e,-e],[e,e]]}(),t["default"]=i,e.exports=t["default"]},function(e,t){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t,r,o){if(n(this,e),isNaN(t)||isNaN(r))throw new Error("Invalid LatLon object: ("+t+", "+r+")");this.lat=+t,this.lon=+r,void 0!==o&&(this.alt=+o)}return r(e,[{key:"clone",value:function(){return new e(this.lat,this.lon,this.alt)}}]),e}();t["default"]=o;var i=function(e,t,n){return e instanceof o?e:Array.isArray(e)&&"object"!=typeof e[0]?3===e.length?new o(e[0],e[1],e[2]):2===e.length?new o(e[0],e[1]):null:void 0===e||null===e?e:"object"==typeof e&&"lat"in e?new o(e.lat,"lng"in e?e.lng:e.lon,e.alt):void 0===t?null:new o(e,t,n)};t.latLon=i},function(e,t){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t,r,o){n(this,e),this.x=o?Math.round(t):t,this.y=o?Math.round(r):r}return r(e,[{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"add",value:function(e){return this.clone()._add(i(e))}},{key:"_add",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:"subtract",value:function(e){return this.clone()._subtract(i(e))}},{key:"_subtract",value:function(e){return this.x-=e.x,this.y-=e.y,this}}]),e}();t["default"]=o;var i=function(e,t,n){return e instanceof o?e:Array.isArray(e)?new o(e[0],e[1]):void 0===e||null===e?e:new o(e,t,n)};t.point=i},function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(e,t,n){for(var r=!0;r;){var o=e,i=t,a=n;r=!1,null===o&&(o=Function.prototype);var s=Object.getOwnPropertyDescriptor(o,i);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(a)}var l=Object.getPrototypeOf(o);if(null===l)return;e=l,t=i,n=a,r=!0,s=l=void 0}},u=n(3),l=r(u),c=n(12),f=r(c),p=n(!function(){var e=new Error('Cannot find module "shortid"');throw e.code="MODULE_NOT_FOUND",e}()),h=r(p),d=n(4),y=r(d),v=n(13),g=(r(v),n(14)),m=n(15),_=function(e){function t(e){o(this,t),s(Object.getPrototypeOf(t.prototype),"constructor",this).call(this);var n={id:h["default"].generate(),output:!0,outputToScene:!0};this._options=(0,f["default"])({},n,e),this.isOutput()&&(this._object3D=new y["default"].Object3D,this._dom3D=document.createElement("div"),this._domObject3D=new g.CSS3DObject(this._dom3D),this._dom2D=document.createElement("div"),this._domObject2D=new m.CSS2DObject(this._dom2D))}return i(t,e),a(t,[{key:"add",value:function(e){this._object3D.add(e)}},{key:"remove",value:function(e){this._object3D.remove(e)}},{key:"addDOM3D",value:function(e){this._domObject3D.add(e)}},{key:"removeDOM3D",value:function(e){this._domObject3D.remove(e)}},{key:"addDOM2D",value:function(e){this._domObject2D.add(e)}},{key:"removeDOM2D",value:function(e){this._domObject2D.remove(e)}},{key:"addTo",value:function(e){return e.addLayer(this)}},{key:"_addToWorld",value:function(e){var t=this;return this._world=e,new Promise(function(n,r){t._onAdd(e).then(function(){t.emit("added"),n(t)})["catch"](r)})}},{key:"_onAdd",value:function(e){return Promise.resolve(this)}},{key:"getPickingId",value:function(){return!!this._world._engine._picking&&this._world._engine._picking.getNextId()}},{key:"addToPicking",value:function(e){this._world._engine._picking&&this._world._engine._picking.add(e)}},{key:"removeFromPicking",value:function(e){this._world._engine._picking&&this._world._engine._picking.remove(e)}},{key:"isOutput",value:function(){return this._options.output}},{key:"isOutputToScene",value:function(){return this._options.outputToScene}},{key:"hide",value:function(){this._object3D.visible=!1,this._pickingMesh&&(this._pickingMesh.visible=!1)}},{key:"show",value:function(){this._object3D.visible=!0,this._pickingMesh&&(this._pickingMesh.visible=!0)}},{key:"destroy",value:function(){if(this._object3D&&this._object3D.children)for(var e,t=this._object3D.children.length-1;t>=0;t--)e=this._object3D.children[t],e&&(this.remove(e),e.geometry&&(e.geometry.dispose(),e.geometry=null),e.material&&(e.material.map&&(e.material.map.dispose(),e.material.map=null),e.material.dispose(),e.material=null));if(this._domObject3D&&this._domObject3D.children)for(var e,t=this._domObject3D.children.length-1;t>=0;t--)e=this._domObject3D.children[t],e&&this.removeDOM3D(e);if(this._domObject2D&&this._domObject2D.children)for(var e,t=this._domObject2D.children.length-1;t>=0;t--)e=this._domObject2D.children[t],e&&this.removeDOM2D(e);this._domObject3D=null,this._domObject2D=null,this._world=null,this._object3D=null}}]),t}(l["default"]);t["default"]=_;var b=function(e){return new _(e)};t.layer=b},function(e,t){function n(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function r(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}function o(e,t){return function(n){return e(t(n))}}function i(e,t){var n=R(e)||y(e)?r(e.length,String):[],o=n.length,i=!!o;for(var a in e)!t&&!A.call(e,a)||i&&("length"==a||f(a,o))||n.push(a);return n}function a(e,t,n){var r=e[t];A.call(e,t)&&d(r,n)&&(void 0!==n||t in e)||(e[t]=n)}function s(e){if(!h(e))return C(e);var t=[];for(var n in Object(e))A.call(e,n)&&"constructor"!=n&&t.push(n);return t}function u(e,t){return t=L(void 0===t?e.length-1:t,0),function(){for(var r=arguments,o=-1,i=L(r.length-t,0),a=Array(i);++o<i;)a[o]=r[t+o];o=-1;for(var s=Array(t+1);++o<t;)s[o]=r[o];return s[t]=a,n(e,this,s)}}function l(e,t,n,r){n||(n={});for(var o=-1,i=t.length;++o<i;){var s=t[o],u=r?r(n[s],e[s],s,n,e):void 0;a(n,s,void 0===u?e[s]:u)}return n}function c(e){return u(function(t,n){var r=-1,o=n.length,i=o>1?n[o-1]:void 0,a=o>2?n[2]:void 0;for(i=e.length>3&&"function"==typeof i?(o--,i):void 0,a&&p(n[0],n[1],a)&&(i=o<3?void 0:i,o=1),t=Object(t);++r<o;){var s=n[r];s&&e(t,s,r,i)}return t})}function f(e,t){return t=null==t?O:t,!!t&&("number"==typeof e||T.test(e))&&e>-1&&e%1==0&&e<t}function p(e,t,n){if(!b(n))return!1;var r=typeof t;return!!("number"==r?v(n)&&f(t,n.length):"string"==r&&t in n)&&d(n[t],e)}function h(e){var t=e&&e.constructor,n="function"==typeof t&&t.prototype||j;return e===n}function d(e,t){return e===t||e!==e&&t!==t}function y(e){return g(e)&&A.call(e,"callee")&&(!S.call(e,"callee")||E.call(e)==k)}function v(e){return null!=e&&_(e.length)&&!m(e)}function g(e){return w(e)&&v(e)}function m(e){var t=b(e)?E.call(e):"";return t==P||t==M}function _(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=O}function b(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function w(e){return!!e&&"object"==typeof e}function x(e){return v(e)?i(e):s(e)}var O=9007199254740991,k="[object Arguments]",P="[object Function]",M="[object GeneratorFunction]",T=/^(?:0|[1-9]\d*)$/,j=Object.prototype,A=j.hasOwnProperty,E=j.toString,S=j.propertyIsEnumerable,C=o(Object.keys,Object),L=Math.max,D=!S.call({valueOf:1},"valueOf"),R=Array.isArray,F=c(function(e,t){if(D||h(t)||v(t))return void l(t,x(t),e);for(var n in t)A.call(t,n)&&a(e,n,t[n])});e.exports=F},function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),i=r(o);t["default"]=function(){var e=new i["default"].Scene;return e}(),e.exports=t["default"]},function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),i=r(o),a=function(e){i["default"].Object3D.call(this),this.element=e,this.element.style.position="absolute",this.addEventListener("removed",function(e){null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)})};a.prototype=Object.create(i["default"].Object3D.prototype),a.prototype.constructor=a;var s=function(e){a.call(this,e)};s.prototype=Object.create(a.prototype),s.prototype.constructor=s;var u=function(){console.log("THREE.CSS3DRenderer",i["default"].REVISION);var e,t,n,r,o=new i["default"].Matrix4,u={camera:{fov:0,style:""},objects:{}},l=document.createElement("div");l.style.overflow="hidden",l.style.WebkitTransformStyle="preserve-3d",l.style.MozTransformStyle="preserve-3d",l.style.oTransformStyle="preserve-3d",l.style.transformStyle="preserve-3d",this.domElement=l;var c=document.createElement("div");c.style.WebkitTransformStyle="preserve-3d",c.style.MozTransformStyle="preserve-3d",c.style.oTransformStyle="preserve-3d",c.style.transformStyle="preserve-3d",l.appendChild(c),this.setClearColor=function(){},this.getSize=function(){return{width:e,height:t}},this.setSize=function(o,i){e=o,t=i,n=e/2,r=t/2,l.style.width=o+"px",l.style.height=i+"px",c.style.width=o+"px",c.style.height=i+"px"};var f=function(e){return Math.abs(e)<Number.EPSILON?0:e},p=function(e){var t=e.elements;return"matrix3d("+f(t[0])+","+f(-t[1])+","+f(t[2])+","+f(t[3])+","+f(t[4])+","+f(-t[5])+","+f(t[6])+","+f(t[7])+","+f(t[8])+","+f(-t[9])+","+f(t[10])+","+f(t[11])+","+f(t[12])+","+f(-t[13])+","+f(t[14])+","+f(t[15])+")"},h=function(e){var t=e.elements;return"translate3d(-50%,-50%,0) matrix3d("+f(t[0])+","+f(t[1])+","+f(t[2])+","+f(t[3])+","+f(-t[4])+","+f(-t[5])+","+f(-t[6])+","+f(-t[7])+","+f(t[8])+","+f(t[9])+","+f(t[10])+","+f(t[11])+","+f(t[12])+","+f(t[13])+","+f(t[14])+","+f(t[15])+")"},d=function y(e,t){if(e instanceof a){var n;e instanceof s?(o.copy(t.matrixWorldInverse),o.transpose(),o.copyPosition(e.matrixWorld),o.scale(e.scale),o.elements[3]=0,o.elements[7]=0,o.elements[11]=0,o.elements[15]=1,n=h(o)):n=h(e.matrixWorld);var r=e.element,i=u.objects[e.id];void 0!==i&&i===n||(r.style.WebkitTransform=n,r.style.MozTransform=n,r.style.oTransform=n,r.style.transform=n,u.objects[e.id]=n),r.parentNode!==c&&c.appendChild(r)}for(var l=0,f=e.children.length;l<f;l++)y(e.children[l],t)};this.render=function(e,o){var a=.5/Math.tan(i["default"].Math.degToRad(.5*o.fov))*t;u.camera.fov!==a&&(l.style.WebkitPerspective=a+"px",l.style.MozPerspective=a+"px",l.style.oPerspective=a+"px",l.style.perspective=a+"px",u.camera.fov=a),e.updateMatrixWorld(),null===o.parent&&o.updateMatrixWorld(),o.matrixWorldInverse.getInverse(o.matrixWorld);var s="translate3d(0,0,"+a+"px)"+p(o.matrixWorldInverse)+" translate3d("+n+"px,"+r+"px, 0)";u.camera.style!==s&&(c.style.WebkitTransform=s,c.style.MozTransform=s,c.style.oTransform=s,c.style.transform=s,u.camera.style=s),d(e,o)}};t.CSS3DObject=a,t.CSS3DSprite=s,t.CSS3DRenderer=u,i["default"].CSS3DObject=a,i["default"].CSS3DSprite=s,i["default"].CSS3DRenderer=u},function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),i=r(o),a=function(e){i["default"].Object3D.call(this),this.element=e,this.element.style.position="absolute",this.addEventListener("removed",function(e){null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)})};a.prototype=Object.create(i["default"].Object3D.prototype),a.prototype.constructor=a;var s=function(){console.log("THREE.CSS2DRenderer",i["default"].REVISION);var e,t,n,r,o=new i["default"].Vector3,s=new i["default"].Matrix4,u=new i["default"].Matrix4,l=new i["default"].Frustum,c=document.createElement("div");c.style.overflow="hidden",this.domElement=c,this.setSize=function(o,i){e=o,t=i,n=e/2,r=t/2,c.style.width=o+"px",c.style.height=i+"px"};var f=function p(e,t){if(e instanceof a){o.setFromMatrixPosition(e.matrixWorld),o.applyProjection(u);var i=e.element,s="translate(-50%,-50%) translate("+(o.x*n+n)+"px,"+(-o.y*r+r)+"px)";i.style.WebkitTransform=s,i.style.MozTransform=s,i.style.oTransform=s,i.style.transform=s,i.parentNode!==c&&c.appendChild(i),l.containsPoint(e.position)?i.style.display="block":i.style.display="none"}for(var f=0,h=e.children.length;f<h;f++)p(e.children[f],t)};this.render=function(e,t){e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),s.copy(t.matrixWorldInverse.getInverse(t.matrixWorld)),u.multiplyMatrices(t.projectionMatrix,s),l.setFromMatrix((new i["default"].Matrix4).multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse)),f(e,t)}};t.CSS2DObject=a,t.CSS2DRenderer=s,i["default"].CSS2DObject=a,i["default"].CSS2DRenderer=s},function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(e,t,n){for(var r=!0;r;){var o=e,i=t,a=n;r=!1,null===o&&(o=Function.prototype);var s=Object.getOwnPropertyDescriptor(o,i);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(a)}var l=Object.getPrototypeOf(o);if(null===l)return;e=l,t=i,n=a,r=!0,s=l=void 0}},u=n(11),l=r(u),c=n(12),f=r(c),p=function(e){function t(e){o(this,t);var n={output:!1},r=(0,f["default"])({},n,e);s(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,r),this._layers=[]}return i(t,e),a(t,[{key:"addLayer",value:function(e){return this._layers.push(e),this._world.addLayer(e)}},{key:"removeLayer",value:function(e){var t=this._layers.indexOf(e);t>-1&&this._layers.splice(t,1),this._world.removeLayer(e)}},{key:"_onAdd",value:function(e){return Promise.resolve(this)}},{key:"destroy",value:function(){if(this._layers){for(var e=0;e<this._layers.length;e++)this._layers[e].destroy();this._layers=null}s(Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}}]),t}(l["default"]);t["default"]=p;var h=function(e){return new p(e)};t.layerGroup=h},function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(e,t,n){for(var r=!0;r;){var o=e,i=t,a=n;r=!1,null===o&&(o=Function.prototype);var s=Object.getOwnPropertyDescriptor(o,i);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(a)}var l=Object.getPrototypeOf(o);if(null===l)return;e=l,t=i,n=a,r=!0,s=l=void 0}},u=n(11),l=r(u),c=n(12),f=r(c),p=n(4),h=r(p),d=n(18),y=r(d),v=function(e){function t(e){o(this,t);var n={skybox:!1},r=(0,f["default"])({},n,e);s(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,r)}return i(t,e),a(t,[{key:"_onAdd",value:function(){return this._initLights(),this._options.skybox&&this._initSkybox(),Promise.resolve(this)}},{key:"_initLights",value:function(){if(this._options.skybox){this._skyboxLight=new h["default"].DirectionalLight(16777215,1),this._skyboxLight.castShadow=!0;var e=1e4;this._skyboxLight.shadow.camera.left=-e,this._skyboxLight.shadow.camera.right=e,this._skyboxLight.shadow.camera.top=e,this._skyboxLight.shadow.camera.bottom=-e,this._skyboxLight.shadow.camera.near=1e4,this._skyboxLight.shadow.camera.far=7e4,this._skyboxLight.shadow.mapSize.width=2048,this._skyboxLight.shadow.mapSize.height=2048,this.add(this._skyboxLight)}else{var t=new h["default"].DirectionalLight(16777215,1);t.position.x=1e4,t.position.y=1e4,t.position.z=1e4;var n=new h["default"].DirectionalLight(16777215,.5);n.position.x=-1e4,n.position.y=1e4,n.position.z=0;var r=new h["default"].DirectionalLight(16777215,.5);r.position.x=1e4,r.position.y=1e4,r.position.z=-1e4,this.add(t),this.add(n),this.add(r)}}},{key:"_initSkybox",value:function(){this._skybox=new y["default"](this._world,this._skyboxLight),this.add(this._skybox._mesh)}},{key:"_initGrid",value:function(){var e=4e3,t=100,n=new h["default"].GridHelper(e,t);this.add(n)}},{key:"destroy",value:function(){this._skyboxLight=null,this._skybox&&(this.remove(this._skybox._mesh),this._skybox.destroy(),this._skybox=null),s(Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}}]),t}(l["default"]);t["default"]=v;var g=function(e){return new v(e)};t.environmentLayer=g},function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(4),s=r(a),u=n(19),l=r(u),c=n(20),f=r(c),p={vertexShader:["varying vec3 vPosition;","void main() {","vPosition = position;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform samplerCube cubemap;","varying vec3 vPosition;","void main() {","gl_FragColor = textureCube(cubemap, normalize(vPosition));","}"].join("\n")
},h=function(){function e(t,n){o(this,e),this._world=t,this._light=n,this._settings={distance:38e3,turbidity:10,reileigh:2,mieCoefficient:.005,mieDirectionalG:.8,luminance:1,inclination:.48,azimuth:.25},this._initSkybox(),this._updateUniforms(),this._initEvents()}return i(e,[{key:"_initEvents",value:function(){this._throttledWorldUpdate=(0,f["default"])(this._update,100),this._world.on("preUpdate",this._throttledWorldUpdate,this)}},{key:"_initSkybox",value:function(){this._cubeCamera=new s["default"].CubeCamera(1,2e7,128);var e=this._cubeCamera.renderTarget;this._sky=new l["default"],this._skyScene=new s["default"].Scene,this._skyScene.add(this._sky.mesh),this._sunSphere=new s["default"].Mesh(new s["default"].SphereBufferGeometry(2e3,16,8),new s["default"].MeshBasicMaterial({color:16777215}));var t={cubemap:{type:"t",value:e}},n=new s["default"].ShaderMaterial({uniforms:t,vertexShader:p.vertexShader,fragmentShader:p.fragmentShader,side:s["default"].BackSide});this._mesh=new s["default"].Mesh(new s["default"].BoxGeometry(19e5,19e5,19e5),n),this._updateSkybox=!0}},{key:"_updateUniforms",value:function(){var e=this._settings,t=this._sky.uniforms;t.turbidity.value=e.turbidity,t.reileigh.value=e.reileigh,t.luminance.value=e.luminance,t.mieCoefficient.value=e.mieCoefficient,t.mieDirectionalG.value=e.mieDirectionalG;var n=Math.PI*(e.inclination-.5),r=2*Math.PI*(e.azimuth-.5);this._sunSphere.position.x=e.distance*Math.cos(r),this._sunSphere.position.y=e.distance*Math.sin(r)*Math.sin(n),this._sunSphere.position.z=e.distance*Math.sin(r)*Math.cos(n),this._light.position.copy(this._sunSphere.position),this._sky.uniforms.sunPosition.value.copy(this._sunSphere.position)}},{key:"_update",value:function(e){this._updateSkybox&&(this._updateSkybox=!1,this._light.intensity=1-.95*(this._settings.inclination/.5),this._updateUniforms(),this._cubeCamera.updateCubeMap(this._world._engine._renderer,this._skyScene))}},{key:"getRenderTarget",value:function(){return this._cubeCamera.renderTarget}},{key:"setInclination",value:function(e){this._settings.inclination=e,this._updateSkybox=!0}},{key:"destroy",value:function(){this._world.off("preUpdate",this._throttledWorldUpdate),this._throttledWorldUpdate=null,this._world=null,this._light=null,this._cubeCamera=null,this._sky.mesh.geometry.dispose(),this._sky.mesh.geometry=null,this._sky.mesh.material.map&&(this._sky.mesh.material.map.dispose(),this._sky.mesh.material.map=null),this._sky.mesh.material.dispose(),this._sky.mesh.material=null,this._sky.mesh=null,this._sky=null,this._skyScene=null,this._sunSphere.geometry.dispose(),this._sunSphere.geometry=null,this._sunSphere.material.map&&(this._sunSphere.material.map.dispose(),this._sunSphere.material.map=null),this._sunSphere.material.dispose(),this._sunSphere.material=null,this._sunSphere=null,this._mesh.geometry.dispose(),this._mesh.geometry=null,this._mesh.material.map&&(this._mesh.material.map.dispose(),this._mesh.material.map=null),this._mesh.material.dispose(),this._mesh.material=null}}]),e}();t["default"]=h;var d=function(e,t){return new h(e,t)};t.skybox=d},function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),i=r(o);i["default"].ShaderLib.sky={uniforms:{luminance:{type:"f",value:1},turbidity:{type:"f",value:2},reileigh:{type:"f",value:1},mieCoefficient:{type:"f",value:.005},mieDirectionalG:{type:"f",value:.8},sunPosition:{type:"v3",value:new i["default"].Vector3}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D skySampler;","uniform vec3 sunPosition;","varying vec3 vWorldPosition;","vec3 cameraPos = vec3(0., 0., 0.);","// uniform sampler2D sDiffuse;","// const float turbidity = 10.0; //","// const float reileigh = 2.; //","// const float luminance = 1.0; //","// const float mieCoefficient = 0.005;","// const float mieDirectionalG = 0.8;","uniform float luminance;","uniform float turbidity;","uniform float reileigh;","uniform float mieCoefficient;","uniform float mieDirectionalG;","// constants for atmospheric scattering","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003; // refractive index of air","const float N = 2.545E25; // number of molecules per unit volume for air at","// 288.15K and 1013mb (sea level -45 celsius)","const float pn = 0.035;\t// depolatization factor for standard air","// wavelength of used primaries, according to preetham","const vec3 lambda = vec3(680E-9, 550E-9, 450E-9);","// mie stuff","// K coefficient for the primaries","const vec3 K = vec3(0.686, 0.678, 0.666);","const float v = 4.0;","// optical length at zenith for molecules","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const vec3 up = vec3(0.0, 1.0, 0.0);","const float EE = 1000.0;","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","// 66 arc seconds -> degrees, and the cosine of that","// earth shadow hack","const float cutoffAngle = pi/1.95;","const float steepness = 1.5;","vec3 totalRayleigh(vec3 lambda)","{","return (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn));","}","// A simplied version of the total Reayleigh scattering to works on browsers that use ANGLE","vec3 simplifiedRayleigh()","{","return 0.0005 / vec3(94, 40, 18);","}","float rayleighPhase(float cosTheta)","{\t ","return (3.0 / (16.0*pi)) * (1.0 + pow(cosTheta, 2.0));","//\treturn (1.0 / (3.0*pi)) * (1.0 + pow(cosTheta, 2.0));","//\treturn (3.0 / 4.0) * (1.0 + pow(cosTheta, 2.0));","}","vec3 totalMie(vec3 lambda, vec3 K, float T)","{","float c = (0.2 * T ) * 10E-18;","return 0.434 * c * pi * pow((2.0 * pi) / lambda, vec3(v - 2.0)) * K;","}","float hgPhase(float cosTheta, float g)","{","return (1.0 / (4.0*pi)) * ((1.0 - pow(g, 2.0)) / pow(1.0 - 2.0*g*cosTheta + pow(g, 2.0), 1.5));","}","float sunIntensity(float zenithAngleCos)","{","return EE * max(0.0, 1.0 - exp(-((cutoffAngle - acos(zenithAngleCos))/steepness)));","}","// float logLuminance(vec3 c)","// {","// \treturn log(c.r * 0.2126 + c.g * 0.7152 + c.b * 0.0722);","// }","// Filmic ToneMapping http://filmicgames.com/archives/75","float A = 0.15;","float B = 0.50;","float C = 0.10;","float D = 0.20;","float E = 0.02;","float F = 0.30;","float W = 1000.0;","vec3 Uncharted2Tonemap(vec3 x)","{","return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;","}","void main() ","{","float sunfade = 1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);","// luminance =  1.0 ;// vWorldPosition.y / 450000. + 0.5; //sunPosition.y / 450000. * 1. + 0.5;","// gl_FragColor = vec4(sunfade, sunfade, sunfade, 1.0);","float reileighCoefficient = reileigh - (1.0* (1.0-sunfade));","vec3 sunDirection = normalize(sunPosition);","float sunE = sunIntensity(dot(sunDirection, up));","// extinction (absorbtion + out scattering) ","// rayleigh coefficients","vec3 betaR = simplifiedRayleigh() * reileighCoefficient;","// mie coefficients","vec3 betaM = totalMie(lambda, K, turbidity) * mieCoefficient;","// optical length","// cutoff angle at 90 to avoid singularity in next formula.","float zenithAngle = acos(max(0.0, dot(up, normalize(vWorldPosition - cameraPos))));","float sR = rayleighZenithLength / (cos(zenithAngle) + 0.15 * pow(93.885 - ((zenithAngle * 180.0) / pi), -1.253));","float sM = mieZenithLength / (cos(zenithAngle) + 0.15 * pow(93.885 - ((zenithAngle * 180.0) / pi), -1.253));","// combined extinction factor\t","vec3 Fex = exp(-(betaR * sR + betaM * sM));","// in scattering","float cosTheta = dot(normalize(vWorldPosition - cameraPos), sunDirection);","float rPhase = rayleighPhase(cosTheta*0.5+0.5);","vec3 betaRTheta = betaR * rPhase;","float mPhase = hgPhase(cosTheta, mieDirectionalG);","vec3 betaMTheta = betaM * mPhase;","vec3 Lin = pow(sunE * ((betaRTheta + betaMTheta) / (betaR + betaM)) * (1.0 - Fex),vec3(1.5));","Lin *= mix(vec3(1.0),pow(sunE * ((betaRTheta + betaMTheta) / (betaR + betaM)) * Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up, sunDirection),5.0),0.0,1.0));","//nightsky","vec3 direction = normalize(vWorldPosition - cameraPos);","float theta = acos(direction.y); // elevation --> y-axis, [-pi/2, pi/2]","float phi = atan(direction.z, direction.x); // azimuth --> x-axis [-pi/2, pi/2]","vec2 uv = vec2(phi, theta) / vec2(2.0*pi, pi) + vec2(0.5, 0.0);","// vec3 L0 = texture2D(skySampler, uv).rgb+0.1 * Fex;","vec3 L0 = vec3(0.1) * Fex;","// composition + solar disc","//if (cosTheta > sunAngularDiameterCos)","float sundisk = smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);","// if (normalize(vWorldPosition - cameraPos).y>0.0)","L0 += (sunE * 19000.0 * Fex)*sundisk;","vec3 whiteScale = 1.0/Uncharted2Tonemap(vec3(W));","vec3 texColor = (Lin+L0);   ","texColor *= 0.04 ;","texColor += vec3(0.0,0.001,0.0025)*0.3;","float g_fMaxLuminance = 1.0;","float fLumScaled = 0.1 / luminance;     ","float fLumCompressed = (fLumScaled * (1.0 + (fLumScaled / (g_fMaxLuminance * g_fMaxLuminance)))) / (1.0 + fLumScaled); ","float ExposureBias = fLumCompressed;","vec3 curr = Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);","vec3 color = curr*whiteScale;","vec3 retColor = pow(color,vec3(1.0/(1.2+(1.2*sunfade))));","gl_FragColor.rgb = retColor;","gl_FragColor.a = 1.0;","}"].join("\n")};var a=function(){var e=i["default"].ShaderLib.sky,t=i["default"].UniformsUtils.clone(e.uniforms),n=new i["default"].ShaderMaterial({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:t,side:i["default"].BackSide}),r=new i["default"].SphereBufferGeometry(45e4,32,15),o=new i["default"].Mesh(r,n);this.mesh=o,this.uniforms=t};t["default"]=a,e.exports=t["default"]},function(e,t){(function(t){function n(e,t,n){function r(t){var n=y,r=v;return y=v=void 0,k=t,m=e.apply(r,n)}function i(e){return k=e,_=setTimeout(c,t),P?r(e):m}function a(e){var n=e-b,r=e-k,o=t-n;return M?x(o,g-r):o}function l(e){var n=e-b,r=e-k;return void 0===b||n>=t||n<0||M&&r>=g}function c(){var e=O();return l(e)?f(e):void(_=setTimeout(c,a(e)))}function f(e){return _=void 0,T&&y?r(e):(y=v=void 0,m)}function p(){void 0!==_&&clearTimeout(_),k=0,y=b=v=_=void 0}function h(){return void 0===_?m:f(O())}function d(){var e=O(),n=l(e);if(y=arguments,v=this,b=e,n){if(void 0===_)return i(b);if(M)return _=setTimeout(c,t),r(b)}return void 0===_&&(_=setTimeout(c,t)),m}var y,v,g,m,_,b,k=0,P=!1,M=!1,T=!0;if("function"!=typeof e)throw new TypeError(u);return t=s(t)||0,o(n)&&(P=!!n.leading,M="maxWait"in n,g=M?w(s(n.maxWait)||0,t):g,T="trailing"in n?!!n.trailing:T),d.cancel=p,d.flush=h,d}function r(e,t,r){var i=!0,a=!0;if("function"!=typeof e)throw new TypeError(u);return o(r)&&(i="leading"in r?!!r.leading:i,a="trailing"in r?!!r.trailing:a),n(e,t,{leading:i,maxWait:t,trailing:a})}function o(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function i(e){return!!e&&"object"==typeof e}function a(e){return"symbol"==typeof e||i(e)&&b.call(e)==c}function s(e){if("number"==typeof e)return e;if(a(e))return l;if(o(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=o(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(f,"");var n=h.test(e);return n||d.test(e)?y(e.slice(2),n?2:8):p.test(e)?l:+e}var u="Expected a function",l=NaN,c="[object Symbol]",f=/^\s+|\s+$/g,p=/^[-+]0x[0-9a-f]+$/i,h=/^0b[01]+$/i,d=/^0o[0-7]+$/i,y=parseInt,v="object"==typeof t&&t&&t.Object===Object&&t,g="object"==typeof self&&self&&self.Object===Object&&self,m=v||g||Function("return this")(),_=Object.prototype,b=_.toString,w=Math.max,x=Math.min,O=function(){return m.Date.now()};e.exports=r}).call(t,function(){return this}())},function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(e,t,n){for(var r=!0;r;){var o=e,i=t,a=n;r=!1,null===o&&(o=Function.prototype);var s=Object.getOwnPropertyDescriptor(o,i);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(a)}var l=Object.getPrototypeOf(o);if(null===l)return;e=l,t=i,n=a,r=!0,s=l=void 0}},u=n(22),l=r(u),c=n(35),f=r(c),p=n(38),h=(r(p),n(20)),d=r(h),y=n(4),v=(r(y),n(12)),g=r(v),m=function(e){function t(e,n){o(this,t);var r={distance:3e5};n=(0,g["default"])({},r,n),s(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,n),this._path=e}return i(t,e),a(t,[{key:"_onAdd",value:function(e){var n=this;return new Promise(function(r,o){s(Object.getPrototypeOf(t.prototype),"_onAdd",n).call(n,e).then(function(){setTimeout(function(){n._calculateLOD(),n._initEvents(),r(n)},0)})["catch"](o)})}},{key:"_initEvents",value:function(){this._throttledWorldUpdate=(0,d["default"])(this._onWorldUpdate,100),this._world.on("preUpdate",this._throttledWorldUpdate,this)}},{key:"_onWorldUpdate",value:function(){this._calculateLOD(),this._outputTiles()}},{key:"_onWorldMove",value:function(e,t){}},{key:"_moveBaseLayer",value:function(e){this._baseLayer.position.x=e.x,this._baseLayer.position.z=e.y}},{key:"_createTile",value:function(e,t){return new f["default"](e,this._path,t)}},{key:"destroy",value:function(){this._world.off("preUpdate",this._throttledWorldUpdate),this._world.off("move",this._onWorldMove),this._throttledWorldUpdate=null,s(Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}}]),t}(l["default"]);t["default"]=m;var _=function(e,t){return new m(e,t)};t.imageTileLayer=_},function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(e,t,n){for(var r=!0;r;){var o=e,i=t,a=n;r=!1,null===o&&(o=Function.prototype);var s=Object.getOwnPropertyDescriptor(o,i);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(a)}var l=Object.getPrototypeOf(o);if(null===l)return;e=l,t=i,n=a,r=!0,s=l=void 0}},u=n(11),l=r(u),c=n(12),f=r(c),p=n(23),h=r(p),d=n(4),y=r(d),v=function(e){function t(e){var n=this;o(this,t);var r={picking:!1,maxCache:1e3,maxLOD:18},i=(0,f["default"])({},r,e);s(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,i),this._destroy=!1,this._tileCache=new h["default"](this._options.maxCache,function(e){n._destroyTile(e)}),this._tileList=[],this._minLOD=3,this._maxLOD=this._options.maxLOD,this._frustum=new y["default"].Frustum,this._tiles=new y["default"].Object3D,this._tilesPicking=new y["default"].Object3D}return i(t,e),a(t,[{key:"_onAdd",value:function(e){return this.addToPicking(this._tilesPicking),this.add(this._tiles),Promise.resolve()}},{key:"_updateFrustum",value:function(){var e=this._world.getCamera(),t=new y["default"].Matrix4;t.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromMatrix(e.projectionMatrix),this._frustum.setFromMatrix((new y["default"].Matrix4).multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse))}},{key:"_tileInFrustum",value:function(e){var t=e.getBounds();return this._frustum.intersectsBox(new y["default"].Box3(new y["default"].Vector3(t[0],0,t[3]),new y["default"].Vector3(t[2],0,t[1])))}},{key:"_outputTiles",value:function(){var e=this;this._tiles&&!this._destroy&&(this._removeTiles(),this._tileList.forEach(function(t){t.isReady()&&(e._tiles.add(t.getMesh()),t.getPickingMesh()&&e._tilesPicking.add(t.getPickingMesh()))}),this.emit("tilesList",this._tileList.map(function(e){return e})))}},{key:"_calculateLOD",value:function(){var e=this;if(!this._stop&&this._world&&!this._destroy){var t=this._world.getCamera();this._updateFrustum(this._frustum,t);var n=this._checklist;n=[],n.push(this._requestTile("0",this)),n.push(this._requestTile("1",this)),n.push(this._requestTile("2",this)),n.push(this._requestTile("3",this)),this._divide(n),n.sort(function(e,t){return e._quadcode.length<t._quadcode.length});var r=n.filter(function(n,r){if(!e._tileInFrustum(n))return!1;if(e._options.distance&&e._options.distance>0){var o=n.getCenter(),i=new y["default"].Vector3(o[0],0,o[1]).sub(t.position).length();if(i>e._options.distance)return!1}return n.getMesh()&&!n.isAborted()||n.requestTileAsync(),!0}),o=this._tileList.filter(function(e){return r.indexOf(e)<0});o.forEach(function(e){return e._abortRequest()}),this._tileList=r}}},{key:"_divide",value:function(e){for(var t,n,r=0;r!=e.length;)t=e[r],n=t.getQuadcode(),t.length!==this._maxLOD&&this._screenSpaceError(t)?(e.splice(r,1),e.push(this._requestTile(n+"0",this)),e.push(this._requestTile(n+"1",this)),e.push(this._requestTile(n+"2",this)),e.push(this._requestTile(n+"3",this))):r++}},{key:"_screenSpaceError",value:function(e){var t=this._minLOD,n=this._maxLOD,r=e.getQuadcode(),o=this._world.getCamera(),i=3;if(r.length===n)return!1;if(r.length<t)return!0;if(!this._tileInFrustum(e))return!1;var a=e.getCenter(),s=new y["default"].Vector3(a[0],0,a[1]).sub(o.position).length(),u=i*e.getSide()/s;return u>1}},{key:"_removeTiles",value:function(){if(this._tiles&&this._tiles.children){for(var e=this._tiles.children.length-1;e>=0;e--)this._tiles.remove(this._tiles.children[e]);if(this._tilesPicking&&this._tilesPicking.children)for(var e=this._tilesPicking.children.length-1;e>=0;e--)this._tilesPicking.remove(this._tilesPicking.children[e])}}},{key:"_createTile",value:function(e,t){}},{key:"_requestTile",value:function(e,t){var n=this._tileCache.getTile(e);return n||(n=this._createTile(e,t),this._tileCache.setTile(e,n)),n}},{key:"_destroyTile",value:function(e){this._tiles.remove(e.getMesh()),e.destroy()}},{key:"show",value:function(){this._stop=!1,this._tilesPicking&&(this._tilesPicking.visible=!0),this._calculateLOD(),s(Object.getPrototypeOf(t.prototype),"show",this).call(this)}},{key:"hide",value:function(){this._stop=!0,this._tilesPicking&&(this._tilesPicking.visible=!1),s(Object.getPrototypeOf(t.prototype),"hide",this).call(this)}},{key:"destroy",value:function(){if(this._destroy=!0,this._tiles.children)for(var e=this._tiles.children.length-1;e>=0;e--)this._tiles.remove(this._tiles.children[e]);if(this.removeFromPicking(this._tilesPicking),this._tilesPicking.children)for(var e=this._tilesPicking.children.length-1;e>=0;e--)this._tilesPicking.remove(this._tilesPicking.children[e]);this._tileCache.destroy(),this._tileCache=null,this._tiles=null,this._tilesPicking=null,this._frustum=null,s(Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}}]),t}(l["default"]);t["default"]=v,e.exports=t["default"]},function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(24),s=r(a),u=function(){function e(t,n){o(this,e),this._cache=(0,s["default"])({max:t,dispose:function(e,t){n(t)}})}return i(e,[{key:"isReady",value:function(){return!1}},{key:"getTile",value:function(e){return this._cache.get(e)}},{key:"setTile",value:function(e,t){this._cache.set(e,t)}},{key:"destroy",value:function(){this._cache.reset(),this._cache=null}}]),e}();t["default"]=u;var l=function(e,t){return new u(e,t)};t.tileCache=l},function(e,t,n){(function(t){"use strict";function r(){return 1}function o(e){if(!(this instanceof o))return new o(e);"number"==typeof e&&(e={max:e}),e||(e={});var t=this[v]=e.max;(!t||"number"!=typeof t||t<=0)&&(this[v]=1/0);var n=e.length||r;"function"!=typeof n&&(n=r),this[m]=n,this[_]=e.stale||!1,this[b]=e.maxAge||0,this[w]=e.dispose,this[x]=e.noDisposeOnSet||!1,this.reset()}function i(e,t,n,r){var o=n.value;s(e,o)&&(l(e,n),e[_]||(o=void 0)),o&&t.call(r,o.value,o.key,e)}function a(e,t,n){var r=e[k].get(t);if(r){var o=r.value;s(e,o)?(l(e,r),e[_]||(o=void 0)):n&&e[O].unshiftNode(r),o&&(o=o.value)}return o}function s(e,t){if(!t||!t.maxAge&&!e[b])return!1;var n=!1,r=Date.now()-t.now;return n=t.maxAge?r>t.maxAge:e[b]&&r>e[b]}function u(e){if(e[g]>e[v])for(var t=e[O].tail;e[g]>e[v]&&null!==t;){var n=t.prev;l(e,t),t=n}}function l(e,t){if(t){var n=t.value;e[w]&&e[w](n.key,n.value),e[g]-=n.length,e[k]["delete"](n.key),e[O].removeNode(t)}}function c(e,t,n,r,o){this.key=e,this.value=t,this.length=n,this.now=r,this.maxAge=o||0}e.exports=o;var f,p=n(26),h=n(28),d=n(34),y="function"==typeof Symbol&&"1"!==t.env._nodeLRUCacheForceNoSymbol;f=y?function(e){return Symbol(e)}:function(e){return"_"+e};var v=f("max"),g=f("length"),m=f("lengthCalculator"),_=f("allowStale"),b=f("maxAge"),w=f("dispose"),x=f("noDisposeOnSet"),O=f("lruList"),k=f("cache");Object.defineProperty(o.prototype,"max",{set:function(e){(!e||"number"!=typeof e||e<=0)&&(e=1/0),this[v]=e,u(this)},get:function(){return this[v]},enumerable:!0}),Object.defineProperty(o.prototype,"allowStale",{set:function(e){this[_]=!!e},get:function(){return this[_]},enumerable:!0}),Object.defineProperty(o.prototype,"maxAge",{set:function(e){(!e||"number"!=typeof e||e<0)&&(e=0),this[b]=e,u(this)},get:function(){return this[b]},enumerable:!0}),Object.defineProperty(o.prototype,"lengthCalculator",{set:function(e){"function"!=typeof e&&(e=r),e!==this[m]&&(this[m]=e,this[g]=0,this[O].forEach(function(e){e.length=this[m](e.value,e.key),this[g]+=e.length},this)),u(this)},get:function(){return this[m]},enumerable:!0}),Object.defineProperty(o.prototype,"length",{get:function(){return this[g]},enumerable:!0}),Object.defineProperty(o.prototype,"itemCount",{get:function(){return this[O].length},enumerable:!0}),o.prototype.rforEach=function(e,t){t=t||this;for(var n=this[O].tail;null!==n;){var r=n.prev;i(this,e,n,t),n=r}},o.prototype.forEach=function(e,t){t=t||this;for(var n=this[O].head;null!==n;){var r=n.next;i(this,e,n,t),n=r}},o.prototype.keys=function(){return this[O].toArray().map(function(e){return e.key},this)},o.prototype.values=function(){return this[O].toArray().map(function(e){return e.value},this)},o.prototype.reset=function(){this[w]&&this[O]&&this[O].length&&this[O].forEach(function(e){this[w](e.key,e.value)},this),this[k]=new p,this[O]=new d,this[g]=0},o.prototype.dump=function(){return this[O].map(function(e){if(!s(this,e))return{k:e.key,v:e.value,e:e.now+(e.maxAge||0)}},this).toArray().filter(function(e){return e})},o.prototype.dumpLru=function(){return this[O]},o.prototype.inspect=function(e,t){var n="LRUCache {",o=!1,i=this[_];i&&(n+="\n  allowStale: true",o=!0);var a=this[v];a&&a!==1/0&&(o&&(n+=","),n+="\n  max: "+h.inspect(a,t),o=!0);var u=this[b];u&&(o&&(n+=","),n+="\n  maxAge: "+h.inspect(u,t),o=!0);var l=this[m];l&&l!==r&&(o&&(n+=","),n+="\n  length: "+h.inspect(this[g],t),o=!0);var c=!1;return this[O].forEach(function(e){c?n+=",\n  ":(o&&(n+=",\n"),c=!0,n+="\n  ");var i=h.inspect(e.key).split("\n").join("\n  "),a={value:e.value};e.maxAge!==u&&(a.maxAge=e.maxAge),l!==r&&(a.length=e.length),s(this,e)&&(a.stale=!0),a=h.inspect(a,t).split("\n").join("\n  "),n+=i+" => "+a}),(c||o)&&(n+="\n"),n+="}"},o.prototype.set=function(e,t,n){n=n||this[b];var r=n?Date.now():0,o=this[m](t,e);if(this[k].has(e)){if(o>this[v])return l(this,this[k].get(e)),!1;var i=this[k].get(e),a=i.value;return this[w]&&(this[x]||this[w](e,a.value)),a.now=r,a.maxAge=n,a.value=t,this[g]+=o-a.length,a.length=o,this.get(e),u(this),!0}var s=new c(e,t,o,r,n);return s.length>this[v]?(this[w]&&this[w](e,t),!1):(this[g]+=s.length,this[O].unshift(s),this[k].set(e,this[O].head),u(this),!0)},o.prototype.has=function(e){if(!this[k].has(e))return!1;var t=this[k].get(e).value;return!s(this,t)},o.prototype.get=function(e){return a(this,e,!0)},o.prototype.peek=function(e){return a(this,e,!1)},o.prototype.pop=function(){var e=this[O].tail;return e?(l(this,e),e.value):null},o.prototype.del=function(e){l(this,this[k].get(e))},o.prototype.load=function(e){this.reset();for(var t=Date.now(),n=e.length-1;n>=0;n--){var r=e[n],o=r.e||0;if(0===o)this.set(r.k,r.v);else{var i=o-t;i>0&&this.set(r.k,r.v,i)}}},o.prototype.prune=function(){var e=this;this[k].forEach(function(t,n){a(e,n,!1)})}}).call(t,n(25))},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(e){if(c===setTimeout)return setTimeout(e,0);if((c===n||!c)&&setTimeout)return c=setTimeout,setTimeout(e,0);try{return c(e,0)}catch(t){try{return c.call(null,e,0)}catch(t){return c.call(this,e,0)}}}function i(e){if(f===clearTimeout)return clearTimeout(e);if((f===r||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(e);try{return f(e)}catch(t){try{return f.call(null,e)}catch(t){return f.call(this,e)}}}function a(){y&&h&&(y=!1,h.length?d=h.concat(d):v=-1,d.length&&s())}function s(){if(!y){var e=o(a);y=!0;for(var t=d.length;t;){for(h=d,d=[];++v<t;)h&&h[v].run();v=-1,t=d.length}h=null,y=!1,i(e)}}function u(e,t){this.fun=e,this.array=t}function l(){}var c,f,p=e.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:n}catch(e){c=n}try{f="function"==typeof clearTimeout?clearTimeout:r}catch(e){f=r}}();var h,d=[],y=!1,v=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];d.push(new u(e,t)),1!==d.length||y||o(s)},u.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=l,p.addListener=l,p.once=l,p.off=l,p.removeListener=l,p.removeAllListeners=l,p.emit=l,p.prependListener=l,p.prependOnceListener=l,p.listeners=function(e){return[]},p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},function(e,t,n){(function(t){"pseudomap"===t.env.npm_package_name&&"test"===t.env.npm_lifecycle_script&&(t.env.TEST_PSEUDOMAP="true"),"function"!=typeof Map||t.env.TEST_PSEUDOMAP?e.exports=n(27):e.exports=Map}).call(t,n(25))},function(e,t){function n(e){if(!(this instanceof n))throw new TypeError("Constructor PseudoMap requires 'new'");if(this.clear(),e)if(e instanceof n||"function"==typeof Map&&e instanceof Map)e.forEach(function(e,t){this.set(t,e)},this);else{if(!Array.isArray(e))throw new TypeError("invalid argument");e.forEach(function(e){this.set(e[0],e[1])},this)}}function r(e,t){return e===t||e!==e&&t!==t}function o(e,t,n){this.key=e,this.value=t,this._index=n}function i(e,t){for(var n=0,o="_"+t,i=o;s.call(e,i);i=o+n++)if(r(e[i].key,t))return e[i]}function a(e,t,n){for(var i=0,a="_"+t,u=a;s.call(e,u);u=a+i++)if(r(e[u].key,t))return void(e[u].value=n);e.size++,e[u]=new o(t,n,u)}var s=Object.prototype.hasOwnProperty;e.exports=n,n.prototype.forEach=function(e,t){t=t||this,Object.keys(this._data).forEach(function(n){"size"!==n&&e.call(t,this._data[n].value,this._data[n].key)},this)},n.prototype.has=function(e){return!!i(this._data,e)},n.prototype.get=function(e){var t=i(this._data,e);return t&&t.value},n.prototype.set=function(e,t){a(this._data,e,t)},n.prototype["delete"]=function(e){var t=i(this._data,e);t&&(delete this._data[t._index],this._data.size--)},n.prototype.clear=function(){var e=Object.create(null);e.size=0,Object.defineProperty(this,"_data",{value:e,enumerable:!1,configurable:!0,writable:!1})},Object.defineProperty(n.prototype,"size",{get:function(){return this._data.size},set:function(e){},enumerable:!0,configurable:!0}),n.prototype.values=n.prototype.keys=n.prototype.entries=function(){throw new Error("iterators are not implemented in this version")}},function(e,t,n){(function(e){function r(e,n){var r={seen:[],stylize:i};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),d(n)?r.showHidden=n:n&&t._extend(r,n),b(r.showHidden)&&(r.showHidden=!1),b(r.depth)&&(r.depth=2),b(r.colors)&&(r.colors=!1),b(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=o),s(r,e,r.depth)}function o(e,t){var n=r.styles[t];return n?"["+r.colors[n][0]+"m"+e+"["+r.colors[n][1]+"m":e}function i(e,t){return e}function a(e){var t={};return e.forEach(function(e,n){t[e]=!0}),t}function s(e,n,r){if(e.customInspect&&n&&P(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var o=n.inspect(r,e);return m(o)||(o=s(e,o,r)),o}var i=u(e,n);if(i)return i;var d=Object.keys(n),y=a(d);if(e.showHidden&&(d=Object.getOwnPropertyNames(n)),k(n)&&(d.indexOf("message")>=0||d.indexOf("description")>=0))return l(n);if(0===d.length){if(P(n)){var v=n.name?": "+n.name:"";return e.stylize("[Function"+v+"]","special")}if(w(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(O(n))return e.stylize(Date.prototype.toString.call(n),"date");if(k(n))return l(n)}var g="",_=!1,b=["{","}"];if(h(n)&&(_=!0,b=["[","]"]),P(n)){var x=n.name?": "+n.name:"";g=" [Function"+x+"]"}if(w(n)&&(g=" "+RegExp.prototype.toString.call(n)),O(n)&&(g=" "+Date.prototype.toUTCString.call(n)),k(n)&&(g=" "+l(n)),0===d.length&&(!_||0==n.length))return b[0]+g+b[1];if(r<0)return w(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special");e.seen.push(n);var M;return M=_?c(e,n,r,y,d):d.map(function(t){return f(e,n,r,y,t,_)}),e.seen.pop(),p(M,g,b)}function u(e,t){if(b(t))return e.stylize("undefined","undefined");if(m(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return g(t)?e.stylize(""+t,"number"):d(t)?e.stylize(""+t,"boolean"):y(t)?e.stylize("null","null"):void 0}function l(e){return"["+Error.prototype.toString.call(e)+"]"}function c(e,t,n,r,o){for(var i=[],a=0,s=t.length;a<s;++a)E(t,String(a))?i.push(f(e,t,n,r,String(a),!0)):i.push("");return o.forEach(function(o){o.match(/^\d+$/)||i.push(f(e,t,n,r,o,!0))}),i}function f(e,t,n,r,o,i){var a,u,l;if(l=Object.getOwnPropertyDescriptor(t,o)||{value:t[o]},l.get?u=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(u=e.stylize("[Setter]","special")),E(r,o)||(a="["+o+"]"),u||(e.seen.indexOf(l.value)<0?(u=y(n)?s(e,l.value,null):s(e,l.value,n-1),u.indexOf("\n")>-1&&(u=i?u.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+u.split("\n").map(function(e){return"   "+e}).join("\n"))):u=e.stylize("[Circular]","special")),b(a)){if(i&&o.match(/^\d+$/))return u;a=JSON.stringify(""+o),a.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"));
}return a+": "+u}function p(e,t,n){var r=0,o=e.reduce(function(e,t){return r++,t.indexOf("\n")>=0&&r++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0);return o>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}function h(e){return Array.isArray(e)}function d(e){return"boolean"==typeof e}function y(e){return null===e}function v(e){return null==e}function g(e){return"number"==typeof e}function m(e){return"string"==typeof e}function _(e){return"symbol"==typeof e}function b(e){return void 0===e}function w(e){return x(e)&&"[object RegExp]"===T(e)}function x(e){return"object"==typeof e&&null!==e}function O(e){return x(e)&&"[object Date]"===T(e)}function k(e){return x(e)&&("[object Error]"===T(e)||e instanceof Error)}function P(e){return"function"==typeof e}function M(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function T(e){return Object.prototype.toString.call(e)}function j(e){return e<10?"0"+e.toString(10):e.toString(10)}function A(){var e=new Date,t=[j(e.getHours()),j(e.getMinutes()),j(e.getSeconds())].join(":");return[e.getDate(),I[e.getMonth()],t].join(" ")}function E(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function S(e,t){if(!e){var n=new Error("Promise was rejected with a falsy value");n.reason=e,e=n}return t(e)}function C(t){function n(){for(var n=[],r=0;r<arguments.length;r++)n.push(arguments[r]);var o=n.pop();if("function"!=typeof o)throw new TypeError("The last argument must be of type Function");var i=this,a=function(){return o.apply(i,arguments)};t.apply(this,n).then(function(t){e.nextTick(a.bind(null,null,t))},function(t){e.nextTick(S.bind(null,t,a))})}if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');return Object.setPrototypeOf(n,Object.getPrototypeOf(t)),Object.defineProperties(n,L(t)),n}var L=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++)n[t[r]]=Object.getOwnPropertyDescriptor(e,t[r]);return n},D=/%[sdj%]/g;t.format=function(e){if(!m(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(r(arguments[n]));return t.join(" ")}for(var n=1,o=arguments,i=o.length,a=String(e).replace(D,function(e){if("%%"===e)return"%";if(n>=i)return e;switch(e){case"%s":return String(o[n++]);case"%d":return Number(o[n++]);case"%j":try{return JSON.stringify(o[n++])}catch(t){return"[Circular]"}default:return e}}),s=o[n];n<i;s=o[++n])a+=y(s)||!x(s)?" "+s:" "+r(s);return a},t.deprecate=function(n,r){function o(){if(!i){if(e.throwDeprecation)throw new Error(r);e.traceDeprecation?console.trace(r):console.error(r),i=!0}return n.apply(this,arguments)}if("undefined"!=typeof e&&e.noDeprecation===!0)return n;if("undefined"==typeof e)return function(){return t.deprecate(n,r).apply(this,arguments)};var i=!1;return o};var R,F={};t.debuglog=function(n){if(b(R)&&(R=e.env.NODE_DEBUG||""),n=n.toUpperCase(),!F[n])if(new RegExp("\\b"+n+"\\b","i").test(R)){var r=e.pid;F[n]=function(){var e=t.format.apply(t,arguments);console.error("%s %d: %s",n,r,e)}}else F[n]=function(){};return F[n]},t.inspect=r,r.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},r.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},t.types=n(29),t.isArray=h,t.isBoolean=d,t.isNull=y,t.isNullOrUndefined=v,t.isNumber=g,t.isString=m,t.isSymbol=_,t.isUndefined=b,t.isRegExp=w,t.types.isRegExp=w,t.isObject=x,t.isDate=O,t.types.isDate=O,t.isError=k,t.types.isNativeError=k,t.isFunction=P,t.isPrimitive=M,t.isBuffer=n(30);var I=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];t.log=function(){console.log("%s - %s",A(),t.format.apply(t,arguments))},t.inherits=n(33),t._extend=function(e,t){if(!t||!x(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e};var N="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;t.promisify=function(e){function t(){for(var t,n,r=new Promise(function(e,r){t=e,n=r}),o=[],i=0;i<arguments.length;i++)o.push(arguments[i]);o.push(function(e,r){e?n(e):t(r)});try{e.apply(this,o)}catch(a){n(a)}return r}if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(N&&e[N]){var t=e[N];if("function"!=typeof t)throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,N,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),N&&Object.defineProperty(t,N,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,L(e))},t.promisify.custom=N,t.callbackify=C}).call(t,n(25))},function(e,t,n){"use strict";function r(e){return e.call.bind(e)}function o(e,t){if("object"!=typeof e)return!1;try{return t(e),!0}catch(n){return!1}}function i(e){return"undefined"!=typeof Promise&&e instanceof Promise||null!==e&&"object"==typeof e&&"function"==typeof e.then&&"function"==typeof e["catch"]}function a(e){return $&&ArrayBuffer.isView?ArrayBuffer.isView(e):s(e)||E(e)}function s(e){return K&&Y?void 0!==ee(e):u(e)||l(e)||c(e)||f(e)||p(e)||h(e)||d(e)||y(e)||v(e)||g(e)||m(e)}function u(e){return K&&Y?"Uint8Array"===ee(e):"[object Uint8Array]"===te(e)||G(e)&&void 0!==e.buffer}function l(e){return K&&Y?"Uint8ClampedArray"===ee(e):"[object Uint8ClampedArray]"===te(e)}function c(e){return K&&Y?"Uint16Array"===ee(e):"[object Uint16Array]"===te(e)}function f(e){return K&&Y?"Uint32Array"===ee(e):"[object Uint32Array]"===te(e)}function p(e){return K&&Y?"Int8Array"===ee(e):"[object Int8Array]"===te(e)}function h(e){return K&&Y?"Int16Array"===ee(e):"[object Int16Array]"===te(e)}function d(e){return K&&Y?"Int32Array"===ee(e):"[object Int32Array]"===te(e)}function y(e){return K&&Y?"Float32Array"===ee(e):"[object Float32Array]"===te(e)}function v(e){return K&&Y?"Float64Array"===ee(e):"[object Float64Array]"===te(e)}function g(e){return K&&Y?"BigInt64Array"===ee(e):"[object BigInt64Array]"===te(e)}function m(e){return K&&Y?"BigUint64Array"===ee(e):"[object BigUint64Array]"===te(e)}function _(e){return"[object Map]"===te(e)}function b(e){return"undefined"!=typeof Map&&(_.working?_(e):e instanceof Map)}function w(e){return"[object Set]"===te(e)}function x(e){return"undefined"!=typeof Set&&(w.working?w(e):e instanceof Set)}function O(e){return"[object WeakMap]"===te(e)}function k(e){return"undefined"!=typeof WeakMap&&(O.working?O(e):e instanceof WeakMap)}function P(e){return"[object WeakSet]"===te(e)}function M(e){return P(e)}function T(e){return"[object ArrayBuffer]"===te(e)}function j(e){return"undefined"!=typeof ArrayBuffer&&(T.working?T(e):e instanceof ArrayBuffer)}function A(e){return"[object DataView]"===te(e)}function E(e){return"undefined"!=typeof DataView&&(A.working?A(e):e instanceof DataView)}function S(e){return"[object SharedArrayBuffer]"===te(e)}function C(e){return"undefined"!=typeof SharedArrayBuffer&&(S.working?S(e):e instanceof SharedArrayBuffer)}function L(e){return"[object AsyncFunction]"===te(e)}function D(e){return"[object Map Iterator]"===te(e)}function R(e){return"[object Set Iterator]"===te(e)}function F(e){return"[object Generator]"===te(e)}function I(e){return"[object WebAssembly.Module]"===te(e)}function N(e){return o(e,ne)}function B(e){return o(e,re)}function z(e){return o(e,oe)}function W(e){return X&&o(e,ie)}function U(e){return J&&o(e,ae)}function q(e){return N(e)||B(e)||z(e)||W(e)||U(e)}function H(e){return K&&(j(e)||C(e))}var G=n(30),V=n(31),Z=n(32),X="undefined"!=typeof BigInt,J="undefined"!=typeof Symbol,Y=J&&"undefined"!=typeof Symbol.toStringTag,K="undefined"!=typeof Uint8Array,$="undefined"!=typeof ArrayBuffer;if(K&&Y)var Q=Object.getPrototypeOf(Uint8Array.prototype),ee=r(Object.getOwnPropertyDescriptor(Q,Symbol.toStringTag).get);var te=r(Object.prototype.toString),ne=r(Number.prototype.valueOf),re=r(String.prototype.valueOf),oe=r(Boolean.prototype.valueOf);if(X)var ie=r(BigInt.prototype.valueOf);if(J)var ae=r(Symbol.prototype.valueOf);t.isArgumentsObject=V,t.isGeneratorFunction=Z,t.isPromise=i,t.isArrayBufferView=a,t.isTypedArray=s,t.isUint8Array=u,t.isUint8ClampedArray=l,t.isUint16Array=c,t.isUint32Array=f,t.isInt8Array=p,t.isInt16Array=h,t.isInt32Array=d,t.isFloat32Array=y,t.isFloat64Array=v,t.isBigInt64Array=g,t.isBigUint64Array=m,_.working="undefined"!=typeof Map&&_(new Map),t.isMap=b,w.working="undefined"!=typeof Set&&w(new Set),t.isSet=x,O.working="undefined"!=typeof WeakMap&&O(new WeakMap),t.isWeakMap=k,P.working="undefined"!=typeof WeakSet&&P(new WeakSet),t.isWeakSet=M,T.working="undefined"!=typeof ArrayBuffer&&T(new ArrayBuffer),t.isArrayBuffer=j,A.working="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView&&A(new DataView(new ArrayBuffer(1),0,1)),t.isDataView=E,S.working="undefined"!=typeof SharedArrayBuffer&&S(new SharedArrayBuffer),t.isSharedArrayBuffer=C,t.isAsyncFunction=L,t.isMapIterator=D,t.isSetIterator=R,t.isGeneratorObject=F,t.isWebAssemblyCompiledModule=I,t.isNumberObject=N,t.isStringObject=B,t.isBooleanObject=z,t.isBigIntObject=W,t.isSymbolObject=U,t.isBoxedPrimitive=q,t.isAnyArrayBuffer=H,["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(e){Object.defineProperty(t,e,{enumerable:!1,value:function(){throw new Error(e+" is not supported in userland")}})})},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag,r=Object.prototype.toString,o=function(e){return!(n&&e&&"object"==typeof e&&Symbol.toStringTag in e)&&"[object Arguments]"===r.call(e)},i=function(e){return!!o(e)||null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Array]"!==r.call(e)&&"[object Function]"===r.call(e.callee)},a=function(){return o(arguments)}();o.isLegacyArguments=i,e.exports=a?o:i},function(e,t){"use strict";var n=Object.prototype.toString,r=Function.prototype.toString,o=/^\s*(?:function)?\*/,i="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag,a=Object.getPrototypeOf,s=function(){if(!i)return!1;try{return Function("return function*() {}")()}catch(e){}},u=s(),l=u?a(u):{};e.exports=function(e){if("function"!=typeof e)return!1;if(o.test(r.call(e)))return!0;if(!i){var t=n.call(e);return"[object GeneratorFunction]"===t}return a(e)===l}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t){function n(e){var t=this;if(t instanceof n||(t=new n),t.tail=null,t.head=null,t.length=0,e&&"function"==typeof e.forEach)e.forEach(function(e){t.push(e)});else if(arguments.length>0)for(var r=0,o=arguments.length;r<o;r++)t.push(arguments[r]);return t}function r(e,t){e.tail=new i(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function o(e,t){e.head=new i(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function i(e,t,n,r){return this instanceof i?(this.list=r,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,void(n?(n.prev=this,this.next=n):this.next=null)):new i(e,t,n,r)}e.exports=n,n.Node=i,n.create=n,n.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,n=e.prev;t&&(t.prev=n),n&&(n.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=n),e.list.length--,e.next=null,e.prev=null,e.list=null},n.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},n.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},n.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)r(this,arguments[e]);return this.length},n.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)o(this,arguments[e]);return this.length},n.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},n.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},n.prototype.forEach=function(e,t){t=t||this;for(var n=this.head,r=0;null!==n;r++)e.call(t,n.value,r,this),n=n.next},n.prototype.forEachReverse=function(e,t){t=t||this;for(var n=this.tail,r=this.length-1;null!==n;r--)e.call(t,n.value,r,this),n=n.prev},n.prototype.get=function(e){for(var t=0,n=this.head;null!==n&&t<e;t++)n=n.next;if(t===e&&null!==n)return n.value},n.prototype.getReverse=function(e){for(var t=0,n=this.tail;null!==n&&t<e;t++)n=n.prev;if(t===e&&null!==n)return n.value},n.prototype.map=function(e,t){t=t||this;for(var r=new n,o=this.head;null!==o;)r.push(e.call(t,o.value,this)),o=o.next;return r},n.prototype.mapReverse=function(e,t){t=t||this;for(var r=new n,o=this.tail;null!==o;)r.push(e.call(t,o.value,this)),o=o.prev;return r},n.prototype.reduce=function(e,t){var n,r=this.head;if(arguments.length>1)n=t;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");r=this.head.next,n=this.head.value}for(var o=0;null!==r;o++)n=e(n,r.value,o),r=r.next;return n},n.prototype.reduceReverse=function(e,t){var n,r=this.tail;if(arguments.length>1)n=t;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");r=this.tail.prev,n=this.tail.value}for(var o=this.length-1;null!==r;o--)n=e(n,r.value,o),r=r.prev;return n},n.prototype.toArray=function(){for(var e=new Array(this.length),t=0,n=this.head;null!==n;t++)e[t]=n.value,n=n.next;return e},n.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,n=this.tail;null!==n;t++)e[t]=n.value,n=n.prev;return e},n.prototype.slice=function(e,t){t=t||this.length,t<0&&(t+=this.length),e=e||0,e<0&&(e+=this.length);var r=new n;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var o=0,i=this.head;null!==i&&o<e;o++)i=i.next;for(;null!==i&&o<t;o++,i=i.next)r.push(i.value);return r},n.prototype.sliceReverse=function(e,t){t=t||this.length,t<0&&(t+=this.length),e=e||0,e<0&&(e+=this.length);var r=new n;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var o=this.length,i=this.tail;null!==i&&o>t;o--)i=i.prev;for(;null!==i&&o>e;o--,i=i.prev)r.push(i.value);return r},n.prototype.reverse=function(){for(var e=this.head,t=this.tail,n=e;null!==n;n=n.prev){var r=n.prev;n.prev=n.next,n.next=r}return this.head=t,this.tail=e,this}},function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(e,t,n){for(var r=!0;r;){var o=e,i=t,a=n;r=!1,null===o&&(o=Function.prototype);var s=Object.getOwnPropertyDescriptor(o,i);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(a)}var l=Object.getPrototypeOf(o);if(null===l)return;e=l,t=i,n=a,r=!0,s=l=void 0}},u=n(36),l=r(u),c=n(37),f=(r(c),n(4)),p=r(f),h=function(e){function t(e,n,r){o(this,t),s(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,n,r)}return i(t,e),a(t,[{key:"requestTileAsync",value:function(){var e=this;setTimeout(function(){e._mesh||(e._mesh=e._createMesh()),e._requestTile()},0)}},{key:"destroy",value:function(){this._abortRequest(),this._image=null,s(Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"_createMesh",value:function(){if(this._center){var e,t=new p["default"].Object3D,n=new p["default"].PlaneBufferGeometry(this._side,this._side,1);this._world._environment._skybox?(e=new p["default"].MeshStandardMaterial({depthWrite:!1}),e.roughness=1,e.metalness=.1,e.envMap=this._world._environment._skybox.getRenderTarget()):e=new p["default"].MeshBasicMaterial({depthWrite:!1});var r=new p["default"].Mesh(n,e);return r.rotation.x=-90*Math.PI/180,r.receiveShadow=!0,t.add(r),t.position.x=this._center[0],t.position.z=this._center[1],t}}},{key:"_createDebugMesh",value:function(){var e=document.createElement("canvas");e.width=256,e.height=256;var t=e.getContext("2d");t.font="Bold 20px Helvetica Neue, Verdana, Arial",t.fillStyle="#ff0000",t.fillText(this._quadcode,20,e.width/2-5),t.fillText(this._tile.toString(),20,e.width/2+25);var n=new p["default"].Texture(e);n.magFilter=p["default"].LinearFilter,n.minFilter=p["default"].LinearMipMapLinearFilter,n.anisotropy=4,n.needsUpdate=!0;var r=new p["default"].MeshBasicMaterial({map:n,transparent:!0,depthWrite:!1}),o=new p["default"].PlaneBufferGeometry(this._side,this._side,1),i=new p["default"].Mesh(o,r);return i.rotation.x=-90*Math.PI/180,i.position.y=.1,i}},{key:"_requestTile",value:function(){var e=this,t={x:this._tile[0],y:this._tile[1],z:this._tile[2]},n=this._getTileURL(t),r=document.createElement("img");this._aborted=!1,r.addEventListener("load",function(t){if(!e.isAborted()){var n=new p["default"].Texture;n.image=r,n.needsUpdate=!0,n.magFilter=p["default"].LinearFilter,n.minFilter=p["default"].LinearMipMapLinearFilter,n.anisotropy=4,n.needsUpdate=!0,e._mesh&&e._mesh.children[0]&&e._mesh.children[0].material&&(e._mesh.children[0].material.map=n,e._mesh.children[0].material.needsUpdate=!0,e._texture=n,e._ready=!0)}},!1),r.crossOrigin="",r.src=n,this._image=r}},{key:"_abortRequest",value:function(){this._image&&!this._ready&&(this._aborted=!0,this._image.src="")}}]),t}(l["default"]);t["default"]=h;var d=function(e,t,n){return new h(e,t,n)};t.imageTile=d},function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(10),s=n(9),u=n(4),l=r(u),c=180/Math.PI,f=/\{([szxy])\}/g,p=function(){function e(t,n,r){o(this,e),this._layer=r,this._world=r._world,this._quadcode=t,this._path=n,this._ready=!1,this._aborted=!1,this._tile=this._quadcodeToTile(t),this._boundsLatLon=this._tileBoundsWGS84(this._tile),this._boundsWorld=this._tileBoundsFromWGS84(this._boundsLatLon),this._center=this._boundsToCenter(this._boundsWorld),this._centerLatlon=this._world.pointToLatLon((0,a.point)(this._center[0],this._center[1])),this._side=this._getSide(this._boundsWorld),this._pointScale=this._world.pointScale(this._centerLatlon)}return i(e,[{key:"isReady",value:function(){return this._ready}},{key:"isAborted",value:function(){return this._aborted}},{key:"requestTileAsync",value:function(){}},{key:"getQuadcode",value:function(){return this._quadcode}},{key:"getBounds",value:function(){return this._boundsWorld}},{key:"getCenter",value:function(){return this._center}},{key:"getSide",value:function(){return this._side}},{key:"getMesh",value:function(){return this._mesh}},{key:"getPickingMesh",value:function(){return this._pickingMesh}},{key:"destroy",value:function(){this._layer=null,this._world=null,this._boundsLatLon=null,this._boundsWorld=null,this._center=null,(this._mesh||this._pickingMesh)&&(this.destroyMesh(this._mesh),this.destroyMesh(this._pickingMesh),this._mesh=null,this._pickingMesh=null)}},{key:"destroyMesh",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]||arguments[1];e&&(e.children&&e.children.forEach(function(n){e.remove(n),t.destroyMesh(n)}),n&&(e.geometry&&(e.geometry.dispose(),e.geometry=null),e.material&&(e.material.map&&(e.material.map.dispose(),e.material.map=null),e.material.dispose(),e.material=null)))}},{key:"_createMesh",value:function(){}},{key:"_createDebugMesh",value:function(){}},{key:"_getTileURL",value:function(e){return e.s||(e.s=String.fromCharCode(97+Math.floor(3*Math.random()))),f.lastIndex=0,this._path.replace(f,function(t,n){return e[n]})}},{key:"_quadcodeToTile",value:function(e){for(var t=0,n=0,r=e.length,o=r;o>0;o--){var i=1<<o-1,a=+e[r-o];1===a&&(t|=i),2===a&&(n|=i),3===a&&(t|=i,n|=i)}return[t,n,r]}},{key:"_tileBoundsFromWGS84",value:function(e){var t=this._layer._world.latLonToPoint((0,s.latLon)(e[1],e[0])),n=this._layer._world.latLonToPoint((0,s.latLon)(e[3],e[2]));return[t.x,t.y,n.x,n.y]}},{key:"_tileBoundsWGS84",value:function(e){var t=this._tile2lon(e[0]+1,e[2]),n=this._tile2lon(e[0],e[2]),r=this._tile2lat(e[1]+1,e[2]),o=this._tile2lat(e[1],e[2]);return[n,r,t,o]}},{key:"_tile2lon",value:function(e,t){return e/Math.pow(2,t)*360-180}},{key:"_tile2lat",value:function(e,t){var n=Math.PI-2*Math.PI*e/Math.pow(2,t);return c*Math.atan(.5*(Math.exp(n)-Math.exp(-n)))}},{key:"_boundsToCenter",value:function(e){var t=e[0]+(e[2]-e[0])/2,n=e[1]+(e[3]-e[1])/2;return[t,n]}},{key:"_getSide",value:function(e){return new l["default"].Vector3(e[0],0,e[3]).sub(new l["default"].Vector3(e[0],0,e[1])).length()}}]),e}();t["default"]=p,e.exports=t["default"]},function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),i=r(o);BoxHelper=function(e){var t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),r=new i["default"].BufferGeometry;r.setIndex(new i["default"].BufferAttribute(t,1)),r.addAttribute("position",new i["default"].BufferAttribute(n,3)),i["default"].LineSegments.call(this,r,new i["default"].LineBasicMaterial({linewidth:2,color:16711680})),void 0!==e&&this.update(e)},BoxHelper.prototype=Object.create(i["default"].LineSegments.prototype),BoxHelper.prototype.constructor=BoxHelper,BoxHelper.prototype.update=function(){var e=new i["default"].Box3;return function(t){if(e.setFromObject(t),!e.isEmpty()){var n=e.min,r=e.max,o=this.geometry.attributes.position,i=o.array;i[0]=r.x,i[1]=r.y,i[2]=r.z,i[3]=n.x,i[4]=r.y,i[5]=r.z,i[6]=n.x,i[7]=n.y,i[8]=r.z,i[9]=r.x,i[10]=n.y,i[11]=r.z,i[12]=r.x,i[13]=r.y,i[14]=n.z,i[15]=n.x,i[16]=r.y,i[17]=n.z,i[18]=n.x,i[19]=n.y,i[20]=n.z,i[21]=r.x,i[22]=n.y,i[23]=n.z,o.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),t["default"]=BoxHelper,e.exports=t["default"]},function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),i=r(o);t["default"]=function(e,t){var n=document.createElement("canvas");n.width=1,n.height=1;var r=n.getContext("2d");r.fillStyle=e,r.fillRect(0,0,n.width,n.height);var o=new i["default"].Texture(n);o.needsUpdate=!0;var a;return t?(a=new i["default"].MeshStandardMaterial({map:o,depthWrite:!1}),a.roughness=1,a.metalness=.1,a.envMap=t):a=new i["default"].MeshBasicMaterial({map:o,depthWrite:!1}),a},e.exports=t["default"]},function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(e,t,n){for(var r=!0;r;){var o=e,i=t,a=n;r=!1,null===o&&(o=Function.prototype);var s=Object.getOwnPropertyDescriptor(o,i);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(a)}var l=Object.getPrototypeOf(o);if(null===l)return;e=l,t=i,n=a,r=!0,s=l=void 0}},u=n(22),l=r(u),c=n(12),f=r(c),p=n(40),h=r(p),d=n(20),y=r(d),v=n(4),g=(r(v),function(e){function t(e,n){o(this,t);var r={maxLOD:14,distance:3e4,workers:!1};n=(0,f["default"])({},r,n),s(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,n),this.defaults=r,this._path=e}return i(t,e),a(t,[{key:"_onAdd",value:function(e){var n=this;return new Promise(function(r,o){s(Object.getPrototypeOf(t.prototype),"_onAdd",n).call(n,e).then(function(){setTimeout(function(){n._calculateLOD(),n._initEvents()},0),r(n)})["catch"](o)})}},{key:"_initEvents",value:function(){this._throttledWorldUpdate=(0,y["default"])(this._onWorldUpdate,100),this._world.on("preUpdate",this._throttledWorldUpdate,this),this._world.on("move",this._onWorldMove,this),this._world.on("controlsMove",this._onControlsMove,this)}},{key:"_onWorldUpdate",value:function(){this._pauseOutput||this._disableOutput||this._outputTiles()}},{key:"_onWorldMove",value:function(e,t){this._disableOutput||(this._pauseOutput=!1,this._calculateLOD())}},{key:"_onControlsMove",value:function(){this._disableOutput||(this._pauseOutput=!0)}},{key:"_createTile",value:function(e,t){var n=(0,f["default"])({},this.defaults,this._options,{outputToScene:!1});return delete n.attribution,new h["default"](e,this._path,t,n)}},{key:"hide",value:function(){this._pauseOutput=!0,s(Object.getPrototypeOf(t.prototype),"hide",this).call(this)}},{key:"show",value:function(){this._pauseOutput=!1,s(Object.getPrototypeOf(t.prototype),"show",this).call(this)}},{key:"destroy",value:function(){this._world.off("preUpdate",this._throttledWorldUpdate),this._world.off("move",this._onWorldMove),this._throttledWorldUpdate=null,s(Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}}]),t}(l["default"]));t["default"]=g;var m=function(e,t){return new g(e,t)};t.geoJSONTileLayer=m},function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(e,t,n){for(var r=!0;r;){var o=e,i=t,a=n;r=!1,null===o&&(o=Function.prototype);var s=Object.getOwnPropertyDescriptor(o,i);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(a)}var l=Object.getPrototypeOf(o);if(null===l)return;e=l,t=i,n=a,r=!0,s=l=void 0}},u=n(36),l=r(u),c=n(41),f=n(56),p=n(37),h=(r(p),n(4)),d=r(h),y=n(42),v=r(y),g=(n(10),n(9),n(12)),m=r(g),_=n(44),b=r(_),w=n(50),x=(r(w),n(51)),O=(r(x),function(e){function t(e,n,r,i){o(this,t),s(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,n,r),this._defaultStyle=b["default"].defaultStyle;var a={workers:!1,output:!0,outputToScene:!1,interactive:!1,topojson:!1,filter:null,onEachFeature:null,polygonMaterial:null,onPolygonMesh:null,onPolygonBufferAttributes:null,polylineMaterial:null,onPolylineMesh:null,onPolylineBufferAttributes:null,pointGeometry:null,pointMaterial:null,onPointMesh:null,style:b["default"].defaultStyle,keepFeatures:!1},u=(0,m["default"])({},a,i);"function"==typeof i.style?u.style=i.style:u.style=(0,m["default"])({},a.style,i.style),this._options=u}return i(t,e),a(t,[{key:"requestTileAsync",value:function(){var e=this;setTimeout(function(){e._mesh||(e._mesh=e._createMesh()),e._requestTile()},0)}},{key:"destroy",value:function(){this._abortRequest(),this._request=null,this._geojsonLayer&&(this._geojsonLayer.destroy(),this._geojsonLayer=null),this._mesh=null,this._pickingMesh=null,s(Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"_createMesh",value:function(){if(this._center){var e=new d["default"].Object3D;return e}}},{key:"_createDebugMesh",value:function(){var e=document.createElement("canvas");e.width=256,e.height=256;var t=e.getContext("2d");t.font="Bold 20px Helvetica Neue, Verdana, Arial",t.fillStyle="#ff0000",t.fillText(this._quadcode,20,e.width/2-5),t.fillText(this._tile.toString(),20,e.width/2+25);var n=new d["default"].Texture(e);n.magFilter=d["default"].LinearFilter,n.minFilter=d["default"].LinearMipMapLinearFilter,n.anisotropy=4,n.needsUpdate=!0;var r=new d["default"].MeshBasicMaterial({map:n,transparent:!0,depthWrite:!1}),o=new d["default"].PlaneBufferGeometry(this._side,this._side,1),i=new d["default"].Mesh(o,r);return i.rotation.x=-90*Math.PI/180,i.position.y=.1,i}},{key:"_requestTile",value:function(){var e=this,t={x:this._tile[0],y:this._tile[1],z:this._tile[2]},n=this._getTileURL(t);this._aborted=!1,this._options.workers?this._processTileData(n):this._request=(0,v["default"])({url:n,type:"json",crossOrigin:!0,headers:this._options.headers}).then(function(t){e._request=null,e._processTileData(t)})["catch"](function(t){e._request=null})}},{key:"_processTileData",value:function(e){var t=this,n=this._options.workers?f.geoJSONWorkerLayer:c.geoJSONLayer;this._geojsonLayer=n(e,this._options),this._geojsonLayer.addTo(this._world).then(function(){t.isAborted()||(t._options.workers||t.destroyMesh(t._mesh),t._mesh.add(t._geojsonLayer._object3D),t._pickingMesh=t._geojsonLayer._pickingMesh,t._geojsonLayer._geojson&&(t._geojsonLayer._geojson=null),t._ready=!0)})["catch"](function(e){console.error(e)})}},{key:"_abortRequest",value:function(){!this._request&&!this._options.workers||this._ready||(this._aborted=!0,this._request&&this._request.abort())}}]),t}(l["default"]));t["default"]=O;var k=function(e,t,n,r){return new O(e,t,n,r)};t.geoJSONTile=k},function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(e,t,n){for(var r=!0;r;){var o=e,i=t,a=n;r=!1,null===o&&(o=Function.prototype);var s=Object.getOwnPropertyDescriptor(o,i);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(a)}var l=Object.getPrototypeOf(o);if(null===l)return;e=l,t=i,n=a,r=!0,s=l=void 0}},u=n(16),l=r(u),c=n(12),f=r(c),p=n(42),h=r(p),d=n(44),y=r(d),v=n(50),g=r(v),m=n(51),_=(r(m),
n(53)),b=r(_),w=n(54),x=r(w),O=n(55),k=r(O),P=function(e){function t(e,n){o(this,t);var r={output:!1,interactive:!1,topojson:!1,filter:null,onEachFeature:null,polygonMaterial:null,onPolygonMesh:null,onPolygonBufferAttributes:null,polylineMaterial:null,onPolylineMesh:null,onPolylineBufferAttributes:null,pointGeometry:null,pointMaterial:null,onPointMesh:null,style:y["default"].defaultStyle,keepFeatures:!0},i=(0,f["default"])({},r,n);"function"==typeof n.style?i.style=n.style:i.style=(0,f["default"])({},r.style,n.style),s(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,i),this._geojson=e}return i(t,e),a(t,[{key:"_onAdd",value:function(e){return this.isOutput()&&(this._pickingMesh=new THREE.Object3D,this.addToPicking(this._pickingMesh)),"string"==typeof this._geojson?this._requestData(this._geojson):this._processData(this._geojson)}},{key:"_requestData",value:function(e){var t=this;return new Promise(function(n,r){t._request=(0,h["default"])({url:e,type:"json",crossOrigin:!0}).then(function(e){t._request=null,t._processData(e).then(function(){n(t)})})["catch"](function(e){console.error(e),t._request=null,r(e)})})}},{key:"_processData",value:function(e){var t=this;return new Promise(function(n){t._geojson=y["default"].collectFeatures(e,t._options.topojson);var r=t._geojson.features;t._options.filter&&(r=t._geojson.features.filter(t._options.filter));var o,i={},a=t._options.style,s=[];r.forEach(function(e){"function"==typeof t._options.style&&(a=(0,f["default"])({},y["default"].defaultStyle,t._options.style(e))),o=(0,f["default"])({},i,{output:!t.isOutput(),interactive:t._options.interactive,style:a});var n=t._featureToLayer(e,o);n&&(t._options.keepFeatures&&(n.feature=e),t._options.onEachFeature&&t._options.onEachFeature(e,n),s.push(t.addLayer(n)))}),Promise.all(s).then(function(e){if(!t.isOutput())return void n();var r=[],o=[],i={positions:3,normals:3,colors:3},a=!0,s=[],u={positions:3,colors:3},l=!0,c=[],p={positions:3,normals:3,colors:3},h=!0;t._layers.forEach(function(e){if(e instanceof b["default"]){r.push(e.getBufferAttributes());var n=e.getOutlineBufferAttributes();n&&o.push(n),a&&!e.isFlat()&&(a=!1),t._options.interactive&&(i.pickingIds=1)}else e instanceof x["default"]?(s.push(e.getBufferAttributes()),l&&!e.isFlat()&&(l=!1),t._options.interactive&&(u.pickingIds=1)):e instanceof k["default"]&&(c.push(e.getBufferAttributes()),h&&!e.isFlat()&&(h=!1),t._options.interactive&&(p.pickingIds=1))});var d;if(r.length>0){var v,m=g["default"].mergeAttributes(r);o.length>0&&(v=g["default"].mergeAttributes(o)),d="function"==typeof t._options.style?t._options.style(t._geojson.features[0]):t._options.style,d=(0,f["default"])({},y["default"].defaultStyle,d),t._setPolygonMesh(m,i,d,a).then(function(e){t._polygonMesh=e.mesh,t.add(t._polygonMesh),v&&(d="function"==typeof t._options.style?t._options.style(t._geojson.features[0]):t._options.style,d=(0,f["default"])({},y["default"].defaultStyle,d),void 0!==d.outlineRenderOrder?d.lineRenderOrder=d.outlineRenderOrder:d.lineRenderOrder=d.renderOrder?d.renderOrder+1:4,d.outlineWidth&&(d.lineWidth=d.outlineWidth),t._setPolylineMesh(v,u,d,!0).then(function(e){t.add(e.mesh)})),e.pickingMesh&&t._pickingMesh.add(e.pickingMesh)})}if(s.length>0){var _=g["default"].mergeAttributes(s);d="function"==typeof t._options.style?t._options.style(t._geojson.features[0]):t._options.style,d=(0,f["default"])({},y["default"].defaultStyle,d),t._setPolylineMesh(_,u,d,l).then(function(e){t._polylineMesh=e.mesh,t.add(t._polylineMesh),e.pickingMesh&&t._pickingMesh.add(e.pickingMesh)})}if(c.length>0){var w=g["default"].mergeAttributes(c);d="function"==typeof t._options.style?t._options.style(t._geojson.features[0]):t._options.style,d=(0,f["default"])({},y["default"].defaultStyle,d),t._setPointMesh(w,p,d,h).then(function(e){t._pointMesh=e.mesh,t.add(t._pointMesh),e.pickingMesh&&t._pickingMesh.add(e.pickingMesh)})}t._layers.forEach(function(e){e.clearBufferAttributes(),e.clearCoordinates()}),n()})})}},{key:"_setPolygonMesh",value:function(e,t,n,r){return b["default"].SetMesh(e,t,r,n,this._options,this._world._environment._skybox)}},{key:"_setPolylineMesh",value:function(e,t,n,r){return x["default"].SetMesh(e,t,r,n,this._options)}},{key:"_setPointMesh",value:function(e,t,n,r){return k["default"].SetMesh(e,t,r,n,this._options)}},{key:"_featureToLayer",value:function(e,t){var n=e.geometry,r=n.coordinates?n.coordinates:null;if(r&&n)return"Polygon"===n.type||"MultiPolygon"===n.type?("function"==typeof this._options.polygonMaterial&&(t.polygonMaterial=this._options.polygonMaterial(e)),"function"==typeof this._options.onPolygonMesh&&(t.onPolygonMesh=this._options.onPolygonMesh),"function"==typeof this._options.onPolygonBufferAttributes&&(t.onBufferAttributes=this._options.onPolygonBufferAttributes),new b["default"](r,t)):"LineString"===n.type||"MultiLineString"===n.type?("function"==typeof this._options.lineMaterial&&(t.lineMaterial=this._options.lineMaterial(e)),"function"==typeof this._options.onPolylineMesh&&(t.onPolylineMesh=this._options.onPolylineMesh),"function"==typeof this._options.onPolylineBufferAttributes&&(t.onBufferAttributes=this._options.onPolylineBufferAttributes),new x["default"](r,t)):"Point"===n.type||"MultiPoint"===n.type?("function"==typeof this._options.pointGeometry&&(t.pointGeometry=this._options.pointGeometry(e)),"function"==typeof this._options.pointMaterial&&(t.pointMaterial=this._options.pointMaterial(e)),"function"==typeof this._options.onPointMesh&&(t.onPointMesh=this._options.onPointMesh),new k["default"](r,t)):void 0}},{key:"_abortRequest",value:function(){this._request&&this._request.abort()}},{key:"destroy",value:function(){this._abortRequest(),this._request=null,this._geojson=null,this._pickingMesh&&(this._pickingMesh=null),this._polygonMesh&&(this._polygonMesh=null),this._polylineMesh&&(this._polylineMesh=null),this._pointMesh&&(this._pointMesh=null),s(Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}}]),t}(l["default"]);t["default"]=P;var M=function(e,t){return new P(e,t)};t.geoJSONLayer=M},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(e,t,n){"undefined"!=typeof module&&module.exports?module.exports=n():(__WEBPACK_AMD_DEFINE_FACTORY__=n,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.call(exports,__webpack_require__,exports,module):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)))}("reqwest",this,function(){function succeed(e){var t=protocolRe.exec(e.url);return t=t&&t[1]||context.location.protocol,httpsRe.test(t)?twoHundo.test(e.request.status):!!e.request.response}function handleReadyState(e,t,n){return function(){return e._aborted?n(e.request):e._timedOut?n(e.request,"Request is aborted: timeout"):void(e.request&&4==e.request[readyState]&&(e.request.onreadystatechange=noop,succeed(e)?t(e.request):n(e.request)))}}function setHeaders(e,t){var n,r=t.headers||{};r.Accept=r.Accept||defaultHeaders.accept[t.type]||defaultHeaders.accept["*"];var o="undefined"!=typeof FormData&&t.data instanceof FormData;t.crossOrigin||r[requestedWith]||(r[requestedWith]=defaultHeaders.requestedWith),r[contentType]||o||(r[contentType]=t.contentType||defaultHeaders.contentType);for(n in r)r.hasOwnProperty(n)&&"setRequestHeader"in e&&e.setRequestHeader(n,r[n])}function setCredentials(e,t){"undefined"!=typeof t.withCredentials&&"undefined"!=typeof e.withCredentials&&(e.withCredentials=!!t.withCredentials)}function generalCallback(e){lastValue=e}function urlappend(e,t){return e+(/\?/.test(e)?"&":"?")+t}function handleJsonp(e,t,n,r){var o=uniqid++,i=e.jsonpCallback||"callback",a=e.jsonpCallbackName||reqwest.getcallbackPrefix(o),s=new RegExp("((^|\\?|&)"+i+")=([^&]+)"),u=r.match(s),l=doc.createElement("script"),c=0,f=navigator.userAgent.indexOf("MSIE 10.0")!==-1;return u?"?"===u[3]?r=r.replace(s,"$1="+a):a=u[3]:r=urlappend(r,i+"="+a),context[a]=generalCallback,l.type="text/javascript",l.src=r,l.async=!0,"undefined"==typeof l.onreadystatechange||f||(l.htmlFor=l.id="_reqwest_"+o),l.onload=l.onreadystatechange=function(){return!(l[readyState]&&"complete"!==l[readyState]&&"loaded"!==l[readyState]||c)&&(l.onload=l.onreadystatechange=null,l.onclick&&l.onclick(),t(lastValue),lastValue=void 0,head.removeChild(l),void(c=1))},head.appendChild(l),{abort:function(){l.onload=l.onreadystatechange=null,n({},"Request is aborted: timeout",{}),lastValue=void 0,head.removeChild(l),c=1}}}function getRequest(e,t){var n,r=this.o,o=(r.method||"GET").toUpperCase(),i="string"==typeof r?r:r.url,a=r.processData!==!1&&r.data&&"string"!=typeof r.data?reqwest.toQueryString(r.data):r.data||null,s=!1;return"jsonp"!=r.type&&"GET"!=o||!a||(i=urlappend(i,a),a=null),"jsonp"==r.type?handleJsonp(r,e,t,i):(n=r.xhr&&r.xhr(r)||xhr(r),n.open(o,i,r.async!==!1),setHeaders(n,r),setCredentials(n,r),context[xDomainRequest]&&n instanceof context[xDomainRequest]?(n.onload=e,n.onerror=t,n.onprogress=function(){},s=!0):n.onreadystatechange=handleReadyState(this,e,t),r.before&&r.before(n),s?setTimeout(function(){n.send(a)},200):n.send(a),n)}function Reqwest(e,t){this.o=e,this.fn=t,init.apply(this,arguments)}function setType(e){if(null!==e)return e.match("json")?"json":e.match("javascript")?"js":e.match("text")?"html":e.match("xml")?"xml":void 0}function init(o,fn){function complete(e){for(o.timeout&&clearTimeout(self.timeout),self.timeout=null;self._completeHandlers.length>0;)self._completeHandlers.shift()(e)}function success(resp){var type=o.type||resp&&setType(resp.getResponseHeader("Content-Type"));resp="jsonp"!==type?self.request:resp;var filteredResponse=globalSetupOptions.dataFilter(resp.responseText,type),r=filteredResponse;try{resp.responseText=r}catch(e){}if(r)switch(type){case"json":try{resp=context.JSON?context.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r;break;case"xml":resp=resp.responseXML&&resp.responseXML.parseError&&resp.responseXML.parseError.errorCode&&resp.responseXML.parseError.reason?null:resp.responseXML}for(self._responseArgs.resp=resp,self._fulfilled=!0,fn(resp),self._successHandler(resp);self._fulfillmentHandlers.length>0;)resp=self._fulfillmentHandlers.shift()(resp);complete(resp)}function timedOut(){self._timedOut=!0,self.request.abort()}function error(e,t,n){for(e=self.request,self._responseArgs.resp=e,self._responseArgs.msg=t,self._responseArgs.t=n,self._erred=!0;self._errorHandlers.length>0;)self._errorHandlers.shift()(e,t,n);complete(e)}this.url="string"==typeof o?o:o.url,this.timeout=null,this._fulfilled=!1,this._successHandler=function(){},this._fulfillmentHandlers=[],this._errorHandlers=[],this._completeHandlers=[],this._erred=!1,this._responseArgs={};var self=this;fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){timedOut()},o.timeout)),o.success&&(this._successHandler=function(){o.success.apply(o,arguments)}),o.error&&this._errorHandlers.push(function(){o.error.apply(o,arguments)}),o.complete&&this._completeHandlers.push(function(){o.complete.apply(o,arguments)}),this.request=getRequest.call(this,success,error)}function reqwest(e,t){return new Reqwest(e,t)}function normalize(e){return e?e.replace(/\r?\n/g,"\r\n"):""}function serial(e,t){var n,r,o,i,a=e.name,s=e.tagName.toLowerCase(),u=function(e){e&&!e.disabled&&t(a,normalize(e.attributes.value&&e.attributes.value.specified?e.value:e.text))};if(!e.disabled&&a)switch(s){case"input":/reset|button|image|file/i.test(e.type)||(n=/checkbox/i.test(e.type),r=/radio/i.test(e.type),o=e.value,(!(n||r)||e.checked)&&t(a,normalize(n&&""===o?"on":o)));break;case"textarea":t(a,normalize(e.value));break;case"select":if("select-one"===e.type.toLowerCase())u(e.selectedIndex>=0?e.options[e.selectedIndex]:null);else for(i=0;e.length&&i<e.length;i++)e.options[i].selected&&u(e.options[i])}}function eachFormElement(){var e,t,n=this,r=function(e,t){var r,o,i;for(r=0;r<t.length;r++)for(i=e[byTag](t[r]),o=0;o<i.length;o++)serial(i[o],n)};for(t=0;t<arguments.length;t++)e=arguments[t],/input|select|textarea/i.test(e.tagName)&&serial(e,n),r(e,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var e={};return eachFormElement.apply(function(t,n){t in e?(e[t]&&!isArray(e[t])&&(e[t]=[e[t]]),e[t].push(n)):e[t]=n},arguments),e}function buildParams(e,t,n,r){var o,i,a,s=/\[\]$/;if(isArray(t))for(i=0;t&&i<t.length;i++)a=t[i],n||s.test(e)?r(e,a):buildParams(e+"["+("object"==typeof a?i:"")+"]",a,n,r);else if(t&&"[object Object]"===t.toString())for(o in t)buildParams(e+"["+o+"]",t[o],n,r);else r(e,t)}var context=this;if("window"in context)var doc=document,byTag="getElementsByTagName",head=doc[byTag]("head")[0];else{var XHR2;try{XHR2=__webpack_require__(43)}catch(ex){throw new Error("Peer dependency `xhr2` required! Please npm install xhr2")}}var httpsRe=/^http/,protocolRe=/(^\w+):\/\//,twoHundo=/^(20\d|1223)$/,readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",uniqid=0,callbackPrefix="reqwest_"+ +new Date,lastValue,xmlHttpRequest="XMLHttpRequest",xDomainRequest="XDomainRequest",noop=function(){},isArray="function"==typeof Array.isArray?Array.isArray:function(e){return e instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",requestedWith:xmlHttpRequest,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"}},xhr=function(e){if(e.crossOrigin===!0){var t=context[xmlHttpRequest]?new XMLHttpRequest:null;if(t&&"withCredentials"in t)return t;if(context[xDomainRequest])return new XDomainRequest;throw new Error("Browser does not support cross-origin requests")}return context[xmlHttpRequest]?new XMLHttpRequest:XHR2?new XHR2:new ActiveXObject("Microsoft.XMLHTTP")},globalSetupOptions={dataFilter:function(e){return e}};return Reqwest.prototype={abort:function(){this._aborted=!0,this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(e,t){return e=e||function(){},t=t||function(){},this._fulfilled?this._responseArgs.resp=e(this._responseArgs.resp):this._erred?t(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):(this._fulfillmentHandlers.push(e),this._errorHandlers.push(t)),this},always:function(e){return this._fulfilled||this._erred?e(this._responseArgs.resp):this._completeHandlers.push(e),this},fail:function(e){return this._erred?e(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):this._errorHandlers.push(e),this},"catch":function(e){return this.fail(e)}},reqwest.serializeArray=function(){var e=[];return eachFormElement.apply(function(t,n){e.push({name:t,value:n})},arguments),e},reqwest.serialize=function(){if(0===arguments.length)return"";var e,t,n=Array.prototype.slice.call(arguments,0);return e=n.pop(),e&&e.nodeType&&n.push(e)&&(e=null),e&&(e=e.type),t="map"==e?serializeHash:"array"==e?reqwest.serializeArray:serializeQueryString,t.apply(null,n)},reqwest.toQueryString=function(e,t){var n,r,o=t||!1,i=[],a=encodeURIComponent,s=function(e,t){t="function"==typeof t?t():null==t?"":t,i[i.length]=a(e)+"="+a(t)};if(isArray(e))for(r=0;e&&r<e.length;r++)s(e[r].name,e[r].value);else for(n in e)e.hasOwnProperty(n)&&buildParams(n,e[n],o,s);return i.join("&").replace(/%20/g,"+")},reqwest.getcallbackPrefix=function(){return callbackPrefix},reqwest.compat=function(e,t){return e&&(e.type&&(e.method=e.type)&&delete e.type,e.dataType&&(e.type=e.dataType),e.jsonpCallback&&(e.jsonpCallbackName=e.jsonpCallback)&&delete e.jsonpCallback,e.jsonp&&(e.jsonpCallback=e.jsonp)),new Reqwest(e,t)},reqwest.ajaxSetup=function(e){e=e||{};for(var t in e)globalSetupOptions[t]=e[t]},reqwest})},function(e,t){},function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(4),s=o(a),u=n(45),l=r(u),c=n(46),f=o(c),p=n(48),h=o(p),d=n(49),y=o(d),v=new s["default"].Color(16777215),g=new s["default"].Color(6710886),m=function(){var e={color:"#ffffff",outline:!1,outlineColor:"#000000",transparent:!1,opacity:1,blending:s["default"].NormalBlending,height:0,lineOpacity:1,lineTransparent:!1,lineColor:"#ffffff",lineWidth:1,lineBlending:s["default"].NormalBlending},t=function(e,t){var n=[];if(t){for(var r in e.objects)n.push(l.feature(e,e.objects[r]));return(0,f["default"])(n)}if(e.type)return Array.isArray(e)?(0,f["default"])(e):e;for(var o in e)e[o].type&&n.push(e[o]);return(0,f["default"])(n)},n=function(e,t,n){var r,o=[],i=[];return e.forEach(function(a,s){i.push([t.r,t.g,t.b]),o.push([a[0],n,a[1]]),r=e[s+1]?e[s+1]:a,i.push([t.r,t.g,t.b]),o.push([r[0],n,r[1]])}),{vertices:o,colours:i}},r=function(e,t,r){var o,i=[],a=[];return e.forEach(function(e){o=n(e,t,r),o.vertices.forEach(function(e){i.push(e)}),o.colours.forEach(function(e){a.push(e)})}),{vertices:i,colours:a}},o=function(e,t,n){var r=a(e),o=u(r.vertices,r.holes,r.dimensions),s=[];for(i=0,il=r.vertices.length;i<il;i+=r.dimensions)s.push(r.vertices.slice(i,i+r.dimensions));var l,c=(0,y["default"])(s,o,{bottom:0,top:n}),f=t.clone().multiply(v),p=t.clone().multiply(g),h=c.positions,d=[],m=[];c.top.forEach(function(e,n){l=[],l.push([t.r,t.g,t.b]),l.push([t.r,t.g,t.b]),l.push([t.r,t.g,t.b]),d.push(e),m.push(l)});var _=!0;return c.sides&&(_&&(_=!1),c.sides.forEach(function(e,t){l=[],t%2===0?(l.push([p.r,p.g,p.b]),l.push([p.r,p.g,p.b]),l.push([f.r,f.g,f.b])):(l.push([f.r,f.g,f.b]),l.push([f.r,f.g,f.b]),l.push([p.r,p.g,p.b])),d.push(e),m.push(l)})),{vertices:h,faces:d,colours:m,flat:_}},a=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,o=0;o<e.length;o++){for(var i=0;i<e[o].length;i++)for(var a=0;a<t;a++)n.vertices.push(e[o][i][a]);o>0&&(r+=e[o-1].length,n.holes.push(r))}return n},u=function(e,t,n){var r=(0,h["default"])(e,t,n),o=[];for(i=0,il=r.length;i<il;i+=3)o.push(r.slice(i,i+3));return o};return{defaultStyle:e,collectFeatures:t,lineStringAttributes:n,multiLineStringAttributes:r,polygonAttributes:o}}();t["default"]=m,e.exports=t["default"]},function(e,t,n){!function(e,n){n(t)}(this,function(e){"use strict";function t(){}function n(e){if(!e)return t;var n,r,o=e.scale[0],i=e.scale[1],a=e.translate[0],s=e.translate[1];return function(e,t){t||(n=r=0),e[0]=(n+=e[0])*o+a,e[1]=(r+=e[1])*i+s}}function r(e){if(!e)return t;var n,r,o=e.scale[0],i=e.scale[1],a=e.translate[0],s=e.translate[1];return function(e,t){t||(n=r=0);var u=Math.round((e[0]-a)/o),l=Math.round((e[1]-s)/i);e[0]=u-n,e[1]=l-r,n=u,r=l}}function o(e,t){for(var n,r=e.length,o=r-t;o<--r;)n=e[o],e[o++]=e[r],e[r]=n}function i(e,t){for(var n=0,r=e.length;n<r;){var o=n+r>>>1;e[o]<t?n=o+1:r=o}return n}function a(e,t){return"GeometryCollection"===t.type?{type:"FeatureCollection",features:t.geometries.map(function(t){return s(e,t)})}:s(e,t)}function s(e,t){var n={type:"Feature",id:t.id,properties:t.properties||{},geometry:u(e,t)};return null==t.id&&delete n.id,n}function u(e,t){function r(e,t){t.length&&t.pop();for(var n,r=f[e<0?~e:e],i=0,a=r.length;i<a;++i)t.push(n=r[i].slice()),c(n,i);e<0&&o(t,a)}function i(e){return e=e.slice(),c(e,0),e}function a(e){for(var t=[],n=0,o=e.length;n<o;++n)r(e[n],t);return t.length<2&&t.push(t[0].slice()),t}function s(e){for(var t=a(e);t.length<4;)t.push(t[0].slice());return t}function u(e){return e.map(s)}function l(e){var t=e.type;return"GeometryCollection"===t?{type:t,geometries:e.geometries.map(l)}:t in p?{type:t,coordinates:p[t](e)}:null}var c=n(e.transform),f=e.arcs,p={Point:function(e){return i(e.coordinates)},MultiPoint:function(e){return e.coordinates.map(i)},LineString:function(e){return a(e.arcs)},MultiLineString:function(e){return e.arcs.map(a)},Polygon:function(e){return u(e.arcs)},MultiPolygon:function(e){return e.arcs.map(u)}};return l(t)}function l(e,t){function n(t){var n,r=e.arcs[t<0?~t:t],o=r[0];return e.transform?(n=[0,0],r.forEach(function(e){n[0]+=e[0],n[1]+=e[1]})):n=r[r.length-1],t<0?[n,o]:[o,n]}function r(e,t){for(var n in e){var r=e[n];delete t[r.start],delete r.start,delete r.end,r.forEach(function(e){o[e<0?~e:e]=1}),s.push(r)}}var o={},i={},a={},s=[],u=-1;return t.forEach(function(n,r){var o,i=e.arcs[n<0?~n:n];i.length<3&&!i[1][0]&&!i[1][1]&&(o=t[++u],t[u]=n,t[r]=o)}),t.forEach(function(e){var t,r,o=n(e),s=o[0],u=o[1];if(t=a[s])if(delete a[t.end],t.push(e),t.end=u,r=i[u]){delete i[r.start];var l=r===t?t:t.concat(r);i[l.start=t.start]=a[l.end=r.end]=l}else i[t.start]=a[t.end]=t;else if(t=i[u])if(delete i[t.start],t.unshift(e),t.start=s,r=a[s]){delete a[r.end];var c=r===t?t:r.concat(t);i[c.start=r.start]=a[c.end=t.end]=c}else i[t.start]=a[t.end]=t;else t=[e],i[t.start=s]=a[t.end=u]=t}),r(a,i),r(i,a),t.forEach(function(e){o[e<0?~e:e]||s.push([e])}),s}function c(e){return u(e,f.apply(this,arguments))}function f(e,t,n){function r(e){var t=e<0?~e:e;(c[t]||(c[t]=[])).push({i:e,g:u})}function o(e){e.forEach(r)}function i(e){e.forEach(o)}function a(e){"GeometryCollection"===e.type?e.geometries.forEach(a):e.type in f&&(u=e,f[e.type](e.arcs))}var s=[];if(arguments.length>1){var u,c=[],f={LineString:o,MultiLineString:i,Polygon:i,MultiPolygon:function(e){e.forEach(i)}};a(t),c.forEach(arguments.length<3?function(e){s.push(e[0].i)}:function(e){n(e[0].g,e[e.length-1].g)&&s.push(e[0].i)})}else for(var p=0,h=e.arcs.length;p<h;++p)s.push(p);return{type:"MultiLineString",arcs:l(e,s)}}function p(e){var t=e[0],n=e[1],r=e[2];return Math.abs((t[0]-r[0])*(n[1]-t[1])-(t[0]-n[0])*(r[1]-t[1]))}function h(e){for(var t,n=-1,r=e.length,o=e[r-1],i=0;++n<r;)t=o,o=e[n],i+=t[0]*o[1]-t[1]*o[0];return i/2}function d(e){return u(e,y.apply(this,arguments))}function y(e,t){function n(e){e.forEach(function(t){t.forEach(function(t){(o[t=t<0?~t:t]||(o[t]=[])).push(e)})}),i.push(e)}function r(t){return Math.abs(h(u(e,{type:"Polygon",arcs:[t]}).coordinates[0]))}var o={},i=[],a=[];return t.forEach(function(e){"Polygon"===e.type?n(e.arcs):"MultiPolygon"===e.type&&e.arcs.forEach(n)}),i.forEach(function(e){if(!e._){var t=[],n=[e];for(e._=1,a.push(t);e=n.pop();)t.push(e),e.forEach(function(e){e.forEach(function(e){o[e<0?~e:e].forEach(function(e){e._||(e._=1,n.push(e))})})})}}),i.forEach(function(e){delete e._}),{type:"MultiPolygon",arcs:a.map(function(t){var n,i=[];if(t.forEach(function(e){e.forEach(function(e){e.forEach(function(e){o[e<0?~e:e].length<2&&i.push(e)})})}),i=l(e,i),(n=i.length)>1)for(var a,s,u=1,c=r(i[0]);u<n;++u)(a=r(i[u]))>c&&(s=i[0],i[0]=i[u],i[u]=s,c=a);return i})}}function v(e){function t(e,t){e.forEach(function(e){e<0&&(e=~e);var n=o[e];n?n.push(t):o[e]=[t]})}function n(e,n){e.forEach(function(e){t(e,n)})}function r(e,t){"GeometryCollection"===e.type?e.geometries.forEach(function(e){r(e,t)}):e.type in s&&s[e.type](e.arcs,t)}var o={},a=e.map(function(){return[]}),s={LineString:t,MultiLineString:n,Polygon:n,MultiPolygon:function(e,t){e.forEach(function(e){n(e,t)})}};e.forEach(r);for(var u in o)for(var l=o[u],c=l.length,f=0;f<c;++f)for(var p=f+1;p<c;++p){var h,d=l[f],y=l[p];(h=a[d])[u=i(h,y)]!==y&&h.splice(u,0,y),(h=a[y])[u=i(h,d)]!==d&&h.splice(u,0,d)}return a}function g(e,t){return e[1][2]-t[1][2]}function m(){function e(e,t){for(;t>0;){var n=(t+1>>1)-1,o=r[n];if(g(e,o)>=0)break;r[o._=t]=o,r[e._=t=n]=e}}function t(e,t){for(;;){var n=t+1<<1,i=n-1,a=t,s=r[a];if(i<o&&g(r[i],s)<0&&(s=r[a=i]),n<o&&g(r[n],s)<0&&(s=r[a=n]),a===t)break;r[s._=t]=s,r[e._=t=a]=e}}var n={},r=[],o=0;return n.push=function(t){return e(r[t._=o]=t,o++),o},n.pop=function(){if(!(o<=0)){var e,n=r[0];return--o>0&&(e=r[o],t(r[e._=0]=e,0)),n}},n.remove=function(n){var i,a=n._;if(r[a]===n)return a!==--o&&(i=r[o],(g(i,n)<0?e:t)(r[i._=a]=i,a)),a},n}function _(e,t){function o(e){s.remove(e),e[1][2]=t(e),s.push(e)}var i=n(e.transform),a=r(e.transform),s=m();return t||(t=p),e.arcs.forEach(function(e){var n,r,u,l,c=[],f=0;for(r=0,u=e.length;r<u;++r)l=e[r],i(e[r]=[l[0],l[1],1/0],r);for(r=1,u=e.length-1;r<u;++r)n=e.slice(r-1,r+2),n[1][2]=t(n),c.push(n),s.push(n);for(r=0,u=c.length;r<u;++r)n=c[r],n.previous=c[r-1],n.next=c[r+1];for(;n=s.pop();){var p=n.previous,h=n.next;n[1][2]<f?n[1][2]=f:f=n[1][2],p&&(p.next=h,p[2]=n[2],o(p)),h&&(h.previous=p,h[0]=n[0],o(h))}e.forEach(a)}),e}var b="1.6.27";e.version=b,e.mesh=c,e.meshArcs=f,e.merge=d,e.mergeArcs=y,e.feature=a,e.neighbors=v,e.presimplify=_,Object.defineProperty(e,"__esModule",{value:!0})})},function(e,t,n){var r=n(47);e.exports=function(e){return{type:"FeatureCollection",features:e.reduce(function(e,t){return e.concat(r(t).features)},[])}}},function(e,t){function n(e){if(!e||!e.type)return null;var t=r[e.type];return t?"geometry"===t?{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:e}]}:"feature"===t?{type:"FeatureCollection",features:[e]}:"featurecollection"===t?e:void 0:null}e.exports=n;var r={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"}},function(e,t){"use strict";function n(e,t,n){n=n||2;var o=t&&t.length,a=o?t[0]*n:e.length,s=r(e,0,a,n,!0),u=[];if(!s||s.next===s.prev)return u;var l,f,p,h,d,y,v;if(o&&(s=c(e,t,s,n)),e.length>80*n){l=p=e[0],f=h=e[1];for(var g=n;g<a;g+=n)d=e[g],y=e[g+1],d<l&&(l=d),y<f&&(f=y),d>p&&(p=d),y>h&&(h=y);v=Math.max(p-l,h-f),v=0!==v?1/v:0}return i(s,u,n,l,f,v),u}function r(e,t,n,r,o){var i,a;if(o===E(e,t,n,r)>0)for(i=t;i<n;i+=r)a=T(i,e[i],e[i+1],a);else for(i=n-r;i>=t;i-=r)a=T(i,e[i],e[i+1],a);return a&&w(a,a.next)&&(j(a),a=a.next),a}function o(e,t){if(!e)return e;t||(t=e);var n,r=e;do if(n=!1,r.steiner||!w(r,r.next)&&0!==b(r.prev,r,r.next))r=r.next;else{if(j(r),r=t=r.prev,r===r.next)break;n=!0}while(n||r!==t);return t}function i(e,t,n,r,c,f,p){if(e){!p&&f&&d(e,r,c,f);for(var h,y,v=e;e.prev!==e.next;)if(h=e.prev,y=e.next,f?s(e,r,c,f):a(e))t.push(h.i/n),t.push(e.i/n),t.push(y.i/n),j(e),e=y.next,v=y.next;else if(e=y,e===v){p?1===p?(e=u(e,t,n),i(e,t,n,r,c,f,2)):2===p&&l(e,t,n,r,c,f):i(o(e),t,n,r,c,f,1);break}}}function a(e){var t=e.prev,n=e,r=e.next;if(b(t,n,r)>=0)return!1;for(var o=e.next.next;o!==e.prev;){if(m(t.x,t.y,n.x,n.y,r.x,r.y,o.x,o.y)&&b(o.prev,o,o.next)>=0)return!1;o=o.next}return!0}function s(e,t,n,r){var o=e.prev,i=e,a=e.next;if(b(o,i,a)>=0)return!1;for(var s=o.x<i.x?o.x<a.x?o.x:a.x:i.x<a.x?i.x:a.x,u=o.y<i.y?o.y<a.y?o.y:a.y:i.y<a.y?i.y:a.y,l=o.x>i.x?o.x>a.x?o.x:a.x:i.x>a.x?i.x:a.x,c=o.y>i.y?o.y>a.y?o.y:a.y:i.y>a.y?i.y:a.y,f=v(s,u,t,n,r),p=v(l,c,t,n,r),h=e.prevZ,d=e.nextZ;h&&h.z>=f&&d&&d.z<=p;){if(h!==e.prev&&h!==e.next&&m(o.x,o.y,i.x,i.y,a.x,a.y,h.x,h.y)&&b(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,d!==e.prev&&d!==e.next&&m(o.x,o.y,i.x,i.y,a.x,a.y,d.x,d.y)&&b(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;h&&h.z>=f;){if(h!==e.prev&&h!==e.next&&m(o.x,o.y,i.x,i.y,a.x,a.y,h.x,h.y)&&b(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;d&&d.z<=p;){if(d!==e.prev&&d!==e.next&&m(o.x,o.y,i.x,i.y,a.x,a.y,d.x,d.y)&&b(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function u(e,t,n){var r=e;do{var o=r.prev,i=r.next.next;!w(o,i)&&x(o,r,r.next,i)&&k(o,i)&&k(i,o)&&(t.push(o.i/n),t.push(r.i/n),t.push(i.i/n),j(r),j(r.next),r=e=i),r=r.next}while(r!==e);return r}function l(e,t,n,r,a,s){var u=e;do{for(var l=u.next.next;l!==u.prev;){if(u.i!==l.i&&_(u,l)){var c=M(u,l);return u=o(u,u.next),c=o(c,c.next),i(u,t,n,r,a,s),void i(c,t,n,r,a,s)}l=l.next}u=u.next}while(u!==e)}function c(e,t,n,i){var a,s,u,l,c,h=[];for(a=0,s=t.length;a<s;a++)u=t[a]*i,l=a<s-1?t[a+1]*i:e.length,c=r(e,u,l,i,!1),c===c.next&&(c.steiner=!0),h.push(g(c));for(h.sort(f),a=0;a<h.length;a++)p(h[a],n),n=o(n,n.next);return n}function f(e,t){return e.x-t.x}function p(e,t){if(t=h(e,t)){var n=M(t,e);o(n,n.next)}}function h(e,t){var n,r=t,o=e.x,i=e.y,a=-(1/0);do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var s=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=o&&s>a){if(a=s,s===o){if(i===r.y)return r;if(i===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(o===a)return n.prev;var u,l=n,c=n.x,f=n.y,p=1/0;for(r=n.next;r!==l;)o>=r.x&&r.x>=c&&o!==r.x&&m(i<f?o:a,i,c,f,i<f?a:o,i,r.x,r.y)&&(u=Math.abs(i-r.y)/(o-r.x),(u<p||u===p&&r.x>n.x)&&k(r,e)&&(n=r,p=u)),r=r.next;return n}function d(e,t,n,r){var o=e;do null===o.z&&(o.z=v(o.x,o.y,t,n,r)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next;while(o!==e);o.prevZ.nextZ=null,o.prevZ=null,y(o)}function y(e){var t,n,r,o,i,a,s,u,l=1;do{for(n=e,e=null,i=null,a=0;n;){for(a++,r=n,s=0,t=0;t<l&&(s++,r=r.nextZ,r);t++);for(u=l;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(o=n,n=n.nextZ,s--):(o=r,r=r.nextZ,u--),i?i.nextZ=o:e=o,o.prevZ=i,i=o;n=r}i.nextZ=null,l*=2}while(a>1);return e}function v(e,t,n,r,o){return e=32767*(e-n)*o,t=32767*(t-r)*o,e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e|t<<1}function g(e){var t=e,n=e;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==e);return n}function m(e,t,n,r,o,i,a,s){return(o-a)*(t-s)-(e-a)*(i-s)>=0&&(e-a)*(r-s)-(n-a)*(t-s)>=0&&(n-a)*(i-s)-(o-a)*(r-s)>=0}function _(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!O(e,t)&&k(e,t)&&k(t,e)&&P(e,t)}function b(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function w(e,t){return e.x===t.x&&e.y===t.y}function x(e,t,n,r){return!!(w(e,t)&&w(n,r)||w(e,r)&&w(n,t))||b(e,t,n)>0!=b(e,t,r)>0&&b(n,r,e)>0!=b(n,r,t)>0}function O(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&x(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}function k(e,t){return b(e.prev,e,e.next)<0?b(e,t,e.next)>=0&&b(e,e.prev,t)>=0:b(e,t,e.prev)<0||b(e,e.next,t)<0}function P(e,t){var n=e,r=!1,o=(e.x+t.x)/2,i=(e.y+t.y)/2;do n.y>i!=n.next.y>i&&n.next.y!==n.y&&o<(n.next.x-n.x)*(i-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next;while(n!==e);return r}function M(e,t){var n=new A(e.i,e.x,e.y),r=new A(t.i,t.x,t.y),o=e.next,i=t.prev;return e.next=t,t.prev=e,n.next=o,o.prev=n,r.next=n,n.prev=r,i.next=r,r.prev=i,r}function T(e,t,n,r){var o=new A(e,t,n);return r?(o.next=r.next,o.prev=r,r.next.prev=o,r.next=o):(o.prev=o,o.next=o),o}function j(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function A(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function E(e,t,n,r){for(var o=0,i=t,a=n-r;i<n;i+=r)o+=(e[a]-e[i])*(e[i+1]+e[a+1]),a=i;return o}e.exports=n,e.exports["default"]=n,n.deviation=function(e,t,n,r){var o=t&&t.length,i=o?t[0]*n:e.length,a=Math.abs(E(e,0,i,n));if(o)for(var s=0,u=t.length;s<u;s++){var l=t[s]*n,c=s<u-1?t[s+1]*n:e.length;a-=Math.abs(E(e,l,c,n))}var f=0;for(s=0;s<r.length;s+=3){var p=r[s]*n,h=r[s+1]*n,d=r[s+2]*n;f+=Math.abs((e[p]-e[d])*(e[h+1]-e[p+1])-(e[p]-e[h])*(e[d+1]-e[p+1]))}return 0===a&&0===f?0:Math.abs((f-a)/a)},n.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,o=0;o<e.length;o++){for(var i=0;i<e[o].length;i++)for(var a=0;a<t;a++)n.vertices.push(e[o][i][a]);o>0&&(r+=e[o-1].length,n.holes.push(r))}return n}},function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(12),i=r(o),a=function(e,t,n){function r(){a=e.map(function(e){return[e[0],p.top,e[1]]}),s=t,u=t}function o(){a=[],e.forEach(function(e){a.push([e[0],p.top,e[1]])}),e.forEach(function(e){a.push([e[0],p.bottom,e[1]])}),s=[];for(var n=0;n<h;n++)n===h-1?(s.push([n+h,h,n]),s.push([0,n,h])):(s.push([n+h,n+h+1,n]),s.push([n+1,n,n+h+1]));if(c=[].concat(s),p.closed){var r=t,o=r.map(function(e){return e.map(function(e){
return e+h})});o=o.map(function(e){return[e[0],e[2],e[1]]}),s=s.concat(r).concat(o),u=r,l=o}}var a,s,u,l,c,f={top:1,bottom:0,closed:!0},p=(0,i["default"])({},f,n),h=e.length;return p.top===p.bottom?r():o(),{positions:a,faces:s,top:u,bottom:l,sides:c}};t["default"]=a,e.exports=t["default"]},function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),i=r(o),a=n(!function(){var e=new Error('Cannot find module "text-encoding"');throw e.code="MODULE_NOT_FOUND",e}()),s=function(){var e=function(e){var t,n=0,r=new Int32Array(2*e.length),o=0;e.forEach(function(e,i){t=e.length,n+=t,r.set([o,o+t],2*i),o+=t});var i=new Float32Array(n);return e.forEach(function(e,t){i.set(e,r[2*t])}),[i,r]},t=function(e){for(var t,n=e[0],r=e[1],o=[],i=0;i<r.length/2;i++)t=2*i,o.push(n.subarray(r[t],r[t+1]));return o},n=function(e){var t,n=0,r=new Int32Array(2*e.length),o=0;e.forEach(function(e,i){t=e.length,n+=t,r.set([o,o+t],2*i),o+=t});var i=new Uint8Array(n);return e.forEach(function(e,t){i.set(e,r[2*t])}),[i,r]},r=function(e){for(var t,n=e[0],r=e[1],o=[],i=0;i<r.length/2;i++)t=2*i,o.push(n.subarray(r[t],r[t+1]));return o},o=function(e){var t={};e.forEach(function(e){for(var n in e)t[n]||(t[n]=0),t[n]+=e[n].length});var n={};for(var r in t)n[r]=new Float32Array(t[r]);var o={};return e.forEach(function(e){for(var t in e)o[t]||(o[t]=0),n[t].set(e[t],o[t]),o[t]+=e[t].length}),n},s=function(e,t){var n,r=new i["default"].BufferGeometry,o=new Float32Array(3*e.verticesCount),a=new Float32Array(3*e.verticesCount);e.pickingIds&&(n=new Float32Array(e.verticesCount));for(var s,u,l,c=0,f=0;f<e.vertices.length;f++){s=e.vertices[f],u=e.colours[f],n&&(l=e.pickingIds[f]);for(var p=0;p<s.length;p++){var h=s[p][0]+t.x,d=s[p][1],y=s[p][2]+t.y,v=u[p];o[3*c+0]=h,o[3*c+1]=d,o[3*c+2]=y,a[3*c+0]=v[0],a[3*c+1]=v[1],a[3*c+2]=v[2],n&&(n[c]=l),c++}}return r.addAttribute("position",new i["default"].BufferAttribute(o,3)),r.addAttribute("color",new i["default"].BufferAttribute(a,3)),n&&r.addAttribute("pickingId",new i["default"].BufferAttribute(n,1)),r.computeBoundingBox(),r},u=function(e,t){var n,r=new i["default"].BufferGeometry,o=new Float32Array(9*e.facesCount),a=new Float32Array(9*e.facesCount),s=new Float32Array(9*e.facesCount);e.pickingIds&&(n=new Float32Array(3*e.facesCount));for(var u,l,c,f,p,h=new i["default"].Vector3,d=new i["default"].Vector3,y=new i["default"].Vector3,v=new i["default"].Vector3,g=new i["default"].Vector3,m=0,_=0;_<e.faces.length;_++){l=e.faces[_],c=e.vertices[_],f=e.colours[_],n&&(p=e.pickingIds[_]);for(var b=0;b<l.length;b++){u=l[b][0];var w=c[u][0]+t.x,x=c[u][1],O=c[u][2]+t.y,k=f[b][0];u=l[b][1];var P=c[u][0]+t.x,M=c[u][1],T=c[u][2]+t.y,j=f[b][1];u=l[b][2];var A=c[u][0]+t.x,E=c[u][1],S=c[u][2]+t.y,C=f[b][2];h.set(w,x,O),d.set(P,M,T),y.set(A,E,S),v.subVectors(y,d),g.subVectors(h,d),v.cross(g),v.normalize();var L=v.x,D=v.y,R=v.z;o[9*m+0]=w,o[9*m+1]=x,o[9*m+2]=O,a[9*m+0]=L,a[9*m+1]=D,a[9*m+2]=R,s[9*m+0]=k[0],s[9*m+1]=k[1],s[9*m+2]=k[2],o[9*m+3]=P,o[9*m+4]=M,o[9*m+5]=T,a[9*m+3]=L,a[9*m+4]=D,a[9*m+5]=R,s[9*m+3]=j[0],s[9*m+4]=j[1],s[9*m+5]=j[2],o[9*m+6]=A,o[9*m+7]=E,o[9*m+8]=S,a[9*m+6]=L,a[9*m+7]=D,a[9*m+8]=R,s[9*m+6]=C[0],s[9*m+7]=C[1],s[9*m+8]=C[2],n&&(n[3*m+0]=p,n[3*m+1]=p,n[3*m+2]=p),m++}}return r.addAttribute("position",new i["default"].BufferAttribute(o,3)),r.addAttribute("normal",new i["default"].BufferAttribute(a,3)),r.addAttribute("color",new i["default"].BufferAttribute(s,3)),n&&r.addAttribute("pickingId",new i["default"].BufferAttribute(n,1)),r.computeBoundingBox(),r},l=new a.TextEncoder("utf-8"),c=new a.TextDecoder("utf-8"),f=function(e){return l.encode(e)},p=function(e){return c.decode(e)},h=function(e,t){for(var n=0;n<e.length;n++)e[n]=t};return{mergeFloat32Arrays:e,splitFloat32Array:t,mergeUint8Arrays:n,splitUint8Array:r,mergeAttributes:o,createLineGeometry:s,createGeometry:u,stringToUint8Array:f,uint8ArrayToString:p,fillTypedArray:h}}();t["default"]=s,e.exports=t["default"]},function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),i=r(o),a=n(52),s=r(a),u=function(){i["default"].ShaderMaterial.call(this,{uniforms:{size:{type:"f",value:.01},scale:{type:"f",value:400}},vertexShader:s["default"].vertexShader,fragmentShader:s["default"].fragmentShader}),this.linePadding=2};u.prototype=Object.create(i["default"].ShaderMaterial.prototype),u.prototype.constructor=u,u.prototype.setPointSize=function(e){this.uniforms.size.value=e},u.prototype.setPointScale=function(e){this.uniforms.scale.value=e},t["default"]=u,e.exports=t["default"]},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n={vertexShader:["attribute float pickingId;","","varying vec4 worldId;","","void main() {","  vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","  vec3 a = fract(vec3(1.0/255.0, 1.0/(255.0*255.0), 1.0/(255.0*255.0*255.0)) * pickingId);","  a -= a.xxy * vec3(0.0, 1.0/255.0, 1.0/255.0);","  worldId = vec4(a,1);","  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#ifdef GL_ES\n","precision highp float;\n","#endif\n","","varying vec4 worldId;","","void main() {","  gl_FragColor = worldId;","}"].join("\n")};t["default"]=n,e.exports=t["default"]},function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function(e,t,n){for(var r=!0;r;){var o=e,i=t,a=n;r=!1,null===o&&(o=Function.prototype);var s=Object.getOwnPropertyDescriptor(o,i);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(a)}var l=Object.getPrototypeOf(o);if(null===l)return;e=l,t=i,n=a,r=!0,s=l=void 0}},l=n(11),c=r(l),f=n(12),p=r(f),h=n(4),d=r(h),y=n(8),v=r(y),g=n(9),m=n(10),_=n(48),b=r(_),w=n(49),x=r(w),O=n(51),k=r(O),P=n(50),M=r(P),T=function(e){function t(e,n){o(this,t);var r={output:!0,interactive:!1,polygonMaterial:null,onPolygonMesh:null,onBufferAttributes:null,style:{color:"#ffffff",transparent:!1,opacity:1,blending:d["default"].NormalBlending,height:0}},i=(0,p["default"])({},r,n);u(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,i),this._coordinates=t.isSingle(e)?[e]:e}return a(t,e),s(t,[{key:"_onAdd",value:function(e){var n=this;return new Promise(function(e,r){n._setCoordinates(),n._options.interactive&&(n.isOutput()&&(n._pickingMesh=new d["default"].Object3D,n.addToPicking(n._pickingMesh)),n._setPickingId(),n._addPickingEvents()),t.SetBufferAttributes(n._projectedCoordinates,n._options).then(function(r){if(n._bufferAttributes=M["default"].mergeAttributes(r.attributes),r.outlineAttributes.length>0&&(n._outlineBufferAttributes=M["default"].mergeAttributes(r.outlineAttributes)),n._flat=r.flat,n.isOutput()){var o={positions:3,normals:3,colors:3,tops:1};n._options.interactive&&(o.pickingIds=1);var i=n._options.style;t.SetMesh(n._bufferAttributes,o,n._flat,i,n._options,n._world._environment._skybox).then(function(e){n.add(e.mesh),e.pickingMesh&&n._pickingMesh.add(e.pickingMesh)})}r.attributes=null,r.outlineAttributes=null,r=null,e(n)})["catch"](r)})}},{key:"getCenter",value:function(){return this._center}},{key:"getBounds",value:function(){}},{key:"_setPickingId",value:function(){this._pickingId=this._options.pickingId=this.getPickingId()}},{key:"_addPickingEvents",value:function(){var e=this;this._world.on("pick-click-"+this._pickingId,function(t,n,r){e.emit("click",e,t,n,r)}),this._world.on("pick-hover-"+this._pickingId,function(t,n,r){e.emit("hover",e,t,n,r)})}},{key:"getBufferAttributes",value:function(){return this._bufferAttributes}},{key:"getOutlineBufferAttributes",value:function(){return this._outlineBufferAttributes}},{key:"clearBufferAttributes",value:function(){this._bufferAttributes=null,this._outlineBufferAttributes=null}},{key:"clearCoordinates",value:function(){this._coordinates=null,this._projectedCoordinates=null}},{key:"_setCoordinates",value:function(){this._bounds=[],this._coordinates=this._convertCoordinates(this._coordinates),this._projectedBounds=[],this._projectedCoordinates=this._projectCoordinates(),this._center=this._coordinates[0][0][0]}},{key:"_convertCoordinates",value:function(e){return e.map(function(e){return e.map(function(e){return e.map(function(e){return(0,g.latLon)(e[1],e[0])})})})}},{key:"_projectCoordinates",value:function(){var e,t=this;return this._coordinates.map(function(n){return n.map(function(n){return n.map(function(n){return e=t._world.latLonToPoint(n),t._offset||(t._offset=(0,m.point)(0,0),t._offset.x=-1*e.x,t._offset.y=-1*e.y,t._options.pointScale=t._world.pointScale(n)),e})})})}},{key:"isFlat",value:function(){return this._flat}},{key:"destroy",value:function(){this._pickingMesh&&(this._pickingMesh=null),this.clearCoordinates(),this.clearBufferAttributes(),u(Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}}],[{key:"SetBufferAttributes",value:function(e,n){return new Promise(function(r){var o=0;n.style.height&&0!==n.style.height&&(o=v["default"].metresToWorld(n.style.height,n.pointScale));var a=new d["default"].Color;a.set(n.style.color);var s=new d["default"].Color(16777215),u=new d["default"].Color(6710886),l=!0,c=[],f=e.map(function(e){var r=t.ToEarcut(e),f=t.Triangulate(r.vertices,r.holes,r.dimensions),p=[];for(i=0,il=r.vertices.length;i<il;i+=r.dimensions)p.push(r.vertices.slice(i,i+r.dimensions));var h,y=(0,x["default"])(p,f,{bottom:0,top:o}),v=a.clone().multiply(s),g=a.clone().multiply(u),m=y.positions,_=[],b=[],w=[];y.top.forEach(function(e,t){h=[],h.push([a.r,a.g,a.b]),h.push([a.r,a.g,a.b]),h.push([a.r,a.g,a.b]),w.push([!0,!0,!0]),_.push(e),b.push(h)}),y.sides&&(l=!1,y.sides.forEach(function(e,t){h=[],t%2===0?(h.push([g.r,g.g,g.b]),h.push([g.r,g.g,g.b]),h.push([v.r,v.g,v.b]),w.push([!1,!1,!0])):(h.push([v.r,v.g,v.b]),h.push([v.r,v.g,v.b]),h.push([g.r,g.g,g.b]),w.push([!0,!0,!1])),_.push(e),b.push(h)}));var O={vertices:m,faces:_,colours:b,tops:w,facesCount:_.length};if(n.style.outline){var k=new d["default"].Color;k.set(n.style.outlineColor||0),c.push(t.Set2DOutline(e,k))}return n.interactive&&n.pickingId&&(O.pickingId=n.pickingId),t.ToAttributes(O)});r({attributes:f,outlineAttributes:c,flat:l})})}},{key:"Set2DOutline",value:function(e,t){var n=[];e.forEach(function(e){for(var t=e.map(function(e){return[e.x,0,e.y]}),r=t.length,o=!0;--r;)o||0===r?o=!1:t.splice(r+1,0,t[r]);n=n.concat(t)}),_colour=[t.r,t.g,t.b];for(var r=new Float32Array(3*n.length),o=new Float32Array(3*n.length),i=0,a=0;a<n.length;a++){var s=n[a][0],u=n[a][1],l=n[a][2],c=_colour;r[3*i+0]=s,r[3*i+1]=u,r[3*i+2]=l,o[3*i+0]=c[0],o[3*i+1]=c[1],o[3*i+2]=c[2],i++}var f={positions:r,colors:o};return f}},{key:"SetMesh",value:function(e,t,n,r,o,i){var a=new d["default"].BufferGeometry;for(var s in e)a.addAttribute(s.slice(0,-1),new d["default"].BufferAttribute(e[s],t[s]));a.computeBoundingBox();var u;o.polygonMaterial&&o.polygonMaterial instanceof d["default"].Material?u=o.polygonMaterial:i?(u=new d["default"].MeshStandardMaterial({vertexColors:d["default"].VertexColors,side:d["default"].BackSide,transparent:r.transparent,opacity:r.opacity,blending:r.blending}),u.roughness=1,u.metalness=.1,u.envMapIntensity=3,u.envMap=i.getRenderTarget()):u=new d["default"].MeshPhongMaterial({vertexColors:d["default"].VertexColors,side:d["default"].BackSide,transparent:r.transparent,opacity:r.opacity,blending:r.blending});var l;if("function"==typeof o.onPolygonMesh?l=o.onPolygonMesh(a,u):(l=new d["default"].Mesh(a,u),l.castShadow=!0,l.receiveShadow=!0),n||void 0!==r.renderOrder){r.ignoreDepth||(u.depthWrite=!1);var c=void 0!==r.renderOrder?r.renderOrder:3;l.renderOrder=c}if(o.interactive){u=new k["default"],u.side=d["default"].BackSide;var f=new d["default"].Mesh(a,u)}return Promise.resolve({mesh:l,pickingMesh:f})}},{key:"ToEarcut",value:function(e){for(var t=2,n={vertices:[],holes:[],dimensions:t},r=0,o=0;o<e.length;o++){for(var i=0;i<e[o].length;i++)n.vertices.push(e[o][i].x),n.vertices.push(e[o][i].y);o>0&&(r+=e[o-1].length,n.holes.push(r))}return n}},{key:"Triangulate",value:function(e,t,n){var r=(0,b["default"])(e,t,n),o=[];for(i=0,il=r.length;i<il;i+=3)o.push(r.slice(i,i+3));return o}},{key:"ToAttributes",value:function(e){var t,n=new Float32Array(9*e.facesCount),r=new Float32Array(9*e.facesCount),o=new Float32Array(9*e.facesCount),i=new Float32Array(3*e.facesCount);e.pickingId&&(t=new Float32Array(3*e.facesCount));var a,s,u=new d["default"].Vector3,l=new d["default"].Vector3,c=new d["default"].Vector3,f=new d["default"].Vector3,p=new d["default"].Vector3,h=e.faces,y=e.vertices,v=e.colours,g=e.tops;t&&(s=e.pickingId);for(var m=0,_=0;_<h.length;_++){a=h[_][0];var b=y[a][0],w=y[a][1],x=y[a][2],O=v[_][0],k=g[_][0];a=h[_][1];var P=y[a][0],M=y[a][1],T=y[a][2],j=v[_][1],A=g[_][1];a=h[_][2];var E=y[a][0],S=y[a][1],C=y[a][2],L=v[_][2],D=g[_][2];u.set(b,w,x),l.set(P,M,T),c.set(E,S,C),f.subVectors(c,l),p.subVectors(u,l),f.cross(p),f.normalize();var R=f.x,F=f.y,I=f.z;n[9*m+0]=b,n[9*m+1]=w,n[9*m+2]=x,r[9*m+0]=R,r[9*m+1]=F,r[9*m+2]=I,o[9*m+0]=O[0],o[9*m+1]=O[1],o[9*m+2]=O[2],n[9*m+3]=P,n[9*m+4]=M,n[9*m+5]=T,r[9*m+3]=R,r[9*m+4]=F,r[9*m+5]=I,o[9*m+3]=j[0],o[9*m+4]=j[1],o[9*m+5]=j[2],n[9*m+6]=E,n[9*m+7]=S,n[9*m+8]=C,r[9*m+6]=R,r[9*m+7]=F,r[9*m+8]=I,o[9*m+6]=L[0],o[9*m+7]=L[1],o[9*m+8]=L[2],i[3*m+0]=k,i[3*m+1]=A,i[3*m+2]=D,t&&(t[3*m+0]=s,t[3*m+1]=s,t[3*m+2]=s),m++}var N={positions:n,normals:r,colors:o,tops:i};return t&&(N.pickingIds=t),N}},{key:"isSingle",value:function(e){return!Array.isArray(e[0][0][0])}}]),t}(c["default"]);t["default"]=T;var j=function(e,t){return new T(e,t)};t.polygonLayer=j},function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(e,t,n){for(var r=!0;r;){var o=e,i=t,a=n;r=!1,null===o&&(o=Function.prototype);var s=Object.getOwnPropertyDescriptor(o,i);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(a)}var l=Object.getPrototypeOf(o);if(null===l)return;e=l,t=i,n=a,r=!0,s=l=void 0}},u=n(11),l=r(u),c=n(12),f=r(c),p=n(4),h=r(p),d=n(8),y=r(d),v=n(9),g=n(10),m=n(51),_=r(m),b=n(50),w=r(b),x=function(e){function t(e,n){o(this,t);var r={output:!0,interactive:!1,polylineMaterial:null,onPolylineMesh:null,onBufferAttributes:null,style:{lineOpacity:1,lineTransparent:!1,lineColor:"#ffffff",lineWidth:1,lineBlending:h["default"].NormalBlending}},i=(0,f["default"])({},r,n);s(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,i),this._coordinates=t.isSingle(e)?[e]:e,this._flat=!0}return i(t,e),a(t,[{key:"_onAdd",value:function(e){var n=this;return new Promise(function(e,r){n._setCoordinates(),n._options.interactive&&(n.isOutput()&&(n._pickingMesh=new h["default"].Object3D,n.addToPicking(n._pickingMesh)),n._setPickingId(),n._addPickingEvents()),t.SetBufferAttributes(n._projectedCoordinates,n._options).then(function(r){n._bufferAttributes=w["default"].mergeAttributes(r.attributes),n._flat=r.flat;var o={positions:3,colors:3};if(n._options.interactive&&(o.pickingIds=1),n.isOutput()){var i=n._options.style;t.SetMesh(n._bufferAttributes,o,n._flat,i,n._options).then(function(e){n.add(e.mesh),e.pickingMesh&&n._pickingMesh.add(e.pickingMesh)})}r.attributes=null,r=null,e(n)})})}},{key:"getCenter",value:function(){return this._center}},{key:"getBounds",value:function(){}},{key:"_setPickingId",value:function(){this._pickingId=this._options.pickingId=this.getPickingId()}},{key:"_addPickingEvents",value:function(){var e=this;this._world.on("pick-click-"+this._pickingId,function(t,n,r){e.emit("click",e,t,n,r)}),this._world.on("pick-hover-"+this._pickingId,function(t,n,r){e.emit("hover",e,t,n,r)})}},{key:"getBufferAttributes",value:function(){return this._bufferAttributes}},{key:"clearBufferAttributes",value:function(){this._bufferAttributes=null}},{key:"clearCoordinates",value:function(){this._coordinates=null,this._projectedCoordinates=null}},{key:"_setCoordinates",value:function(){this._bounds=[],this._coordinates=this._convertCoordinates(this._coordinates),this._projectedBounds=[],this._projectedCoordinates=this._projectCoordinates(),this._center=this._coordinates[0][0]}},{key:"_convertCoordinates",value:function(e){return e.map(function(e){return e.map(function(e){return(0,v.latLon)(e[1],e[0])})})}},{key:"_projectCoordinates",value:function(){var e,t=this;return this._coordinates.map(function(n){return n.map(function(n){return e=t._world.latLonToPoint(n),t._offset||(t._offset=(0,g.point)(0,0),t._offset.x=-1*e.x,t._offset.y=-1*e.y,t._options.pointScale=t._world.pointScale(n)),e})})}},{key:"isFlat",value:function(){return this._flat}},{key:"destroy",value:function(){this._pickingMesh&&(this._pickingMesh=null),this.clearCoordinates(),this.clearBufferAttributes(),s(Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}}],[{key:"SetBufferAttributes",value:function(e,n){return new Promise(function(r){var o=0;n.style.lineHeight&&(o=y["default"].metresToWorld(n.style.lineHeight,n.pointScale));var i=new h["default"].Color;i.set(n.style.lineColor);var a=!0,s=e.map(function(e){var r,a=[],s=[];e.forEach(function(t,n){s.push([i.r,i.g,i.b]),a.push([t.x,o,t.y]),r=e[n+1]?e[n+1]:t,s.push([i.r,i.g,i.b]),a.push([r.x,o,r.y])});var u={vertices:a,colours:s,verticesCount:a.length};return n.interactive&&n.pickingId&&(u.pickingId=n.pickingId),t.ToAttributes(u)});r({attributes:s,flat:a})})}},{key:"SetMesh",value:function(e,t,n,r,o){var i=new h["default"].BufferGeometry;for(var a in e)i.addAttribute(a.slice(0,-1),new h["default"].BufferAttribute(e[a],t[a]));i.computeBoundingBox();var s;s=o.polylineMaterial&&o.polylineMaterial instanceof h["default"].Material?o.polylineMaterial:new h["default"].LineBasicMaterial({vertexColors:h["default"].VertexColors,linewidth:r.lineWidth,transparent:r.lineTransparent,opacity:r.lineOpacity,blending:r.lineBlending});var u;if("function"==typeof o.onPolylineMesh?u=o.onPolylineMesh(i,s):(u=new h["default"].LineSegments(i,s),void 0!==r.lineRenderOrder&&(s.depthWrite=!1,u.renderOrder=r.lineRenderOrder),u.castShadow=!0),o.interactive){s=new _["default"],s.linewidth=r.lineWidth+s.linePadding;var l=new h["default"].LineSegments(i,s)}return Promise.resolve({mesh:u,pickingMesh:l})}},{key:"ToAttributes",value:function(e){var t,n=new Float32Array(3*e.verticesCount),r=new Float32Array(3*e.verticesCount);e.pickingId&&(t=new Float32Array(e.verticesCount));var o,i=e.vertices,a=e.colours;t&&(o=e.pickingId);for(var s=0,u=0;u<i.length;u++){var l=i[u][0],c=i[u][1],f=i[u][2],p=a[u];n[3*s+0]=l,n[3*s+1]=c,n[3*s+2]=f,r[3*s+0]=p[0],r[3*s+1]=p[1],r[3*s+2]=p[2],t&&(t[s]=o),s++}var h={positions:n,colors:r};return t&&(h.pickingIds=t),h}},{key:"isSingle",value:function(e){return!Array.isArray(e[0][0])}}]),t}(l["default"]);t["default"]=x;var O=function(e,t){return new x(e,t)};t.polylineLayer=O},function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(e,t,n){for(var r=!0;r;){var o=e,i=t,a=n;r=!1,null===o&&(o=Function.prototype);var s=Object.getOwnPropertyDescriptor(o,i);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(a)}var l=Object.getPrototypeOf(o);if(null===l)return;e=l,t=i,n=a,r=!0,s=l=void 0}},u=n(11),l=r(u),c=n(12),f=r(c),p=n(4),h=r(p),d=n(8),y=r(d),v=n(9),g=n(10),m=n(51),_=r(m),b=n(50),w=r(b),x=n(53),O=(r(x),function(e){function t(e,n){o(this,t);var r={output:!0,interactive:!1,pointGeometry:null,pointMaterial:null,onPointMesh:null,style:{pointColor:"#ff0000"}},i=(0,f["default"])({},r,n);s(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,i),this._coordinates=t.isSingle(e)?[e]:e,this._flat=!1}return i(t,e),a(t,[{key:"_onAdd",value:function(e){var n=this;return new Promise(function(e,r){n._setCoordinates(),n._options.interactive&&(n.isOutput()&&(n._pickingMesh=new h["default"].Object3D,n.addToPicking(n._pickingMesh)),n._setPickingId(),n._addPickingEvents()),t.SetBufferAttributes(n._projectedCoordinates,n._options).then(function(r){n._bufferAttributes=w["default"].mergeAttributes(r.attributes),n._flat=r.flat;var o={positions:3,normals:3,colors:3};if(n._options.interactive&&(o.pickingIds=1),n.isOutput()){var i=n._options.style;t.SetMesh(n._bufferAttributes,o,n._flat,i,n._options,n._world._environment._skybox).then(function(e){n.add(e.mesh),e.pickingMesh&&n._pickingMesh.add(e.pickingMesh)})}r.attributes=null,r=null,e(n)})["catch"](r)})}},{key:"getCenter",value:function(){return this._center}},{key:"getBounds",value:function(){}},{key:"_setPickingId",value:function(){this._pickingId=this._options.pickingId=this.getPickingId()}},{key:"_addPickingEvents",value:function(){var e=this;this._world.on("pick-click-"+this._pickingId,function(t,n,r){e.emit("click",e,t,n,r)}),this._world.on("pick-hover-"+this._pickingId,function(t,n,r){e.emit("hover",e,t,n,r)})}},{key:"getBufferAttributes",value:function(){return this._bufferAttributes}},{key:"clearBufferAttributes",value:function(){this._bufferAttributes=null}},{key:"clearCoordinates",value:function(){this._coordinates=null,this._projectedCoordinates=null}},{key:"_setCoordinates",value:function(){this._bounds=[],this._coordinates=this._convertCoordinates(this._coordinates),this._projectedBounds=[],this._projectedCoordinates=this._projectCoordinates(),this._center=this._coordinates}},{key:"_convertCoordinates",value:function(e){return e.map(function(e){return(0,v.latLon)(e[1],e[0])})}},{key:"_projectCoordinates",value:function(){var e,t=this;return this._coordinates.map(function(n){return e=t._world.latLonToPoint(n),t._offset||(t._offset=(0,g.point)(0,0),t._offset.x=-1*e.x,t._offset.y=-1*e.y,t._options.pointScale=t._world.pointScale(n)),e})}},{key:"isFlat",value:function(){return this._flat}},{key:"destroy",value:function(){this._pickingMesh&&(this._pickingMesh=null),this.clearCoordinates(),this.clearBufferAttributes(),s(Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}}],[{key:"SetBufferAttributes",value:function(e,t){return new Promise(function(n){var r=0;t.style.pointHeight&&(r=y["default"].metresToWorld(t.style.pointHeight,t.pointScale));var o=new h["default"].Color;if(o.set(t.style.pointColor),!t.pointGeometry||!t.pointGeometry instanceof h["default"].Geometry||!t.pointGeometry instanceof h["default"].BufferGeometry){var i=y["default"].metresToWorld(25,t.pointScale),a=y["default"].metresToWorld(200,t.pointScale),s=new h["default"].BoxGeometry(i,a,i);s.translate(0,.5*a,0),geometry=(new h["default"].BufferGeometry).fromGeometry(s)}else t.geometry instanceof h["default"].BufferGeometry?geometry=t.pointGeometry:geometry=(new h["default"].BufferGeometry).fromGeometry(t.pointGeometry);var u=e.map(function(e){var n=[],i=[],a=[],s=geometry.clone();s.translate(e.x,r,e.y);for(var n=s.attributes.position.clone().array,i=s.attributes.normal.clone().array,a=s.attributes.color.clone().array,u=0;u<a.length;u+=3)a[u]=o.r,a[u+1]=o.g,a[u+2]=o.b;var l={positions:n,normals:i,colors:a};return t.interactive&&t.pickingId&&(l.pickingId=t.pickingId),l});n({attributes:u,flat:!1})})}},{key:"SetMesh",value:function(e,t,n,r,o,i){var a=new h["default"].BufferGeometry;for(var s in e)a.addAttribute(s.slice(0,-1),new h["default"].BufferAttribute(e[s],t[s]));a.computeBoundingBox();var u;o.pointMaterial&&o.pointMaterial instanceof h["default"].Material?u=o.pointMaterial:i?(u=new h["default"].MeshStandardMaterial({vertexColors:h["default"].VertexColors,transparent:r.transparent,opacity:r.opacity,blending:r.blending}),u.roughness=1,u.metalness=.1,u.envMapIntensity=3,u.envMap=i.getRenderTarget()):u=new h["default"].MeshPhongMaterial({vertexColors:h["default"].VertexColors,transparent:r.transparent,opacity:r.opacity,blending:r.blending});var l;if("function"==typeof o.onPolygonMesh?l=o.onPolygonMesh(a,u):(l=new h["default"].Mesh(a,u),l.castShadow=!0,l.receiveShadow=!0),n&&(u.depthWrite=!1,l.renderOrder=4),o.interactive){u=new _["default"],u.side=h["default"].BackSide;var c=new h["default"].Mesh(a,u)}return Promise.resolve({mesh:l,pickingMesh:c})}},{key:"isSingle",value:function(e){return!Array.isArray(e[0])}}]),t}(l["default"]));t["default"]=O;var k=function(e,t){return new O(e,t)};t.pointLayer=k},function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(u){o=!0,i=u}finally{try{!r&&s["return"]&&s["return"]()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function(e,t,n){for(var r=!0;r;){var o=e,i=t,a=n;r=!1,null===o&&(o=Function.prototype);var s=Object.getOwnPropertyDescriptor(o,i);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(a)}var l=Object.getPrototypeOf(o);if(null===l)return;e=l,t=i,n=a,r=!0,s=l=void 0}},l=n(11),c=r(l),f=n(12),p=r(f),h=n(42),d=r(h),y=n(44),v=r(y),g=n(57),m=r(g),_=n(50),b=r(_),w=n(60),x=r(w),O=n(53),k=r(O),P=n(54),M=r(P),T=n(55),j=r(T),A=n(9),E=(n(10),n(8)),S=r(E),C=n(51),L=(r(C),function(e){function t(e,n){o(this,t);var r={topojson:!1,style:v["default"].defaultStyle,onEachFeature:null,onEachFeatureWorker:null,onAddAttributes:null,interactive:!1,pointGeometry:null,onClick:null,headers:{}},i=(0,p["default"])({},r,n);"object"==typeof n.style&&(i.style=(0,p["default"])({},r.style,n.style)),u(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,i),this._aborted=!1,this._geojson=e}return i(t,e),s(t,[{key:"_onAdd",value:function(e){return this._options.interactive&&(this._pickingMesh=new THREE.Object3D),this._process(this._geojson)["catch"](function(e){console.error(e)})}},{key:"_process",value:function(e){var n=this;return new Promise(function(r,o){var i=n._options.style;"function"==typeof n._options.style&&(i=x["default"].functionToString(n._options.style));var a=n._options.pointGeometry;"function"==typeof n._options.pointGeometry&&(a=x["default"].functionToString(n._options.pointGeometry));var s=e,u=[];"string"!=typeof s?(n._geojson=s=b["default"].stringToUint8Array(JSON.stringify(s)),u.push(s.buffer),n._execWorker(s,n._options.topojson,n._world._originPoint,i,n._options.interactive,a,u).then(function(){r()})["catch"](o)):"function"==typeof n._options.filter||"function"==typeof n._options.onEachFeature?t.RequestGeoJSON(s).then(function(e){var t=v["default"].collectFeatures(e,n._options.topojson),l=t.features;if(n._options.filter&&(t.features=l.filter(n._options.filter)),n._options.onEachFeature)for(var c,f=0;f<l.length;f++)c=l[f],n._options.onEachFeature(c);n._geojson=s=b["default"].stringToUint8Array(JSON.stringify(t)),u.push(s.buffer),n._execWorker(s,!1,n._options.headers,n._world._originPoint,i,n._options.interactive,a,u).then(function(){r()})["catch"](o)}):n._execWorker(s,n._options.topojson,n._options.headers,n._world._originPoint,i,n._options.interactive,a,u).then(function(){r()})["catch"](o)})}},{key:"_execWorker",value:function(e,t,n,r,o,i,a,s){var u=this;return new Promise(function(l,c){m["default"].exec("GeoJSONWorkerLayer.Process",[e,t,n,r,o,i,a],s).then(function(e){var t=[];e.polygons&&t.push(u._processPolygonResults(e.polygons)),e.polylines&&t.push(u._processPolylineResults(e.polylines)),e.points&&t.push(u._processPointResults(e.points)),t.length>0?Promise.all(t).then(function(){l()})["catch"](c):l()})["catch"](c)})}},{key:"_processPolygonResults",value:function(e){var t=this;return new Promise(function(n,r){var o,i,s=b["default"].splitFloat32Array(e.attributes.positions),u=b["default"].splitFloat32Array(e.attributes.normals),l=b["default"].splitFloat32Array(e.attributes.colors),c=b["default"].splitFloat32Array(e.attributes.tops);e.outlineAttributes&&(o=b["default"].splitFloat32Array(e.outlineAttributes.positions),i=b["default"].splitFloat32Array(e.outlineAttributes.colors));var f;e.properties&&(f=b["default"].splitUint8Array(e.properties));for(var h,d,y,g,m=e.flats,_=[],w=[],x={positions:3,normals:3,colors:3,tops:1},O={positions:3,colors:3},k=0;k<s.length;k++){if(g=f&&f[k]?JSON.parse(b["default"].uint8ArrayToString(f[k])):{},h={attributes:[{positions:s[k],normals:u[k],colors:l[k],tops:c[k]}],properties:g,flat:m[k]},t._options.interactive&&(d=t.getPickingId(),y=new Float32Array(s[k].length/3),b["default"].fillTypedArray(y,d),h.attributes[0].pickingIds=y,x.pickingIds=1,t._addPicking(d,g)),"function"==typeof t._options.onAddAttributes){var P,M=t._options.onAddAttributes(h.attributes[0],g);for(var T in M)P=M[T],h.attributes[0][T]=P.value,x[T]=P.length}_.push(h)}for(var k=0;k<o.length;k++)h={attributes:[{positions:o[k],colors:i[k]}],flat:!0},w.push(h);for(var j=[],A=[],E=!0,k=0;k<_.length;k++){h=_[k],E&&h.flat===!1&&(E=!1);var S=b["default"].mergeAttributes(h.attributes);j.push(S)}for(var k=0;k<w.length;k++){h=w[k];var S=b["default"].mergeAttributes(h.attributes);A.push(S)}var C,L=[];if(j.length>0){var D=b["default"].mergeAttributes(j);C="function"==typeof t._options.style?t._options.style(_[0]):t._options.style,C=(0,p["default"])({},v["default"].defaultStyle,C),L.push(t._setPolygonMesh(D,x,C,E))}if(A.length>0){var R=b["default"].mergeAttributes(A);C="function"==typeof t._options.style?t._options.style(_[0]):t._options.style,C=(0,p["default"])({},v["default"].defaultStyle,C),
void 0!==C.outlineRenderOrder?C.lineRenderOrder=C.outlineRenderOrder:C.lineRenderOrder=C.renderOrder?C.renderOrder+1:4,C.outlineWidth&&(C.lineWidth=C.outlineWidth),L.push(t._setPolylineMesh(R,O,C,!0))}Promise.all(L).then(function(e){var r=a(e,2),o=r[0],i=r[1];o&&(t._polygonMesh=o.mesh,t.add(t._polygonMesh),o.pickingMesh&&t._pickingMesh.add(o.pickingMesh)),i&&t.add(i.mesh),n()})["catch"](r)})}},{key:"_processPolylineResults",value:function(e){var t=this;return new Promise(function(n,r){var o,i=b["default"].splitFloat32Array(e.attributes.positions),a=b["default"].splitFloat32Array(e.attributes.colors);e.properties&&(o=b["default"].splitUint8Array(e.properties));for(var s,u,l,c,f=e.flats,h=[],d={positions:3,colors:3},y=0;y<i.length;y++){if(c=o&&o[y]?JSON.parse(b["default"].uint8ArrayToString(o[y])):{},s={attributes:[{positions:i[y],colors:a[y]}],properties:c,flat:f[y]},t._options.interactive&&(u=t.getPickingId(),l=new Float32Array(i[y].length/3),b["default"].fillTypedArray(l,u),s.attributes[0].pickingIds=l,d.pickingIds=1,t._addPicking(u,c)),"function"==typeof t._options.onAddAttributes){var g,m=t._options.onAddAttributes(s.attributes[0],c);for(var _ in m)g=m[_],s.attributes[0][_]=g.value,d[_]=g.length}h.push(s)}for(var w=[],x=!0,y=0;y<h.length;y++){s=h[y],x&&!s.flat&&(x=!1);var O=b["default"].mergeAttributes(s.attributes);w.push(O)}if(w.length>0){var k=b["default"].mergeAttributes(w),P="function"==typeof t._options.style?t._options.style(h[0]):t._options.style;P=(0,p["default"])({},v["default"].defaultStyle,P),t._setPolylineMesh(k,d,P,x).then(function(e){t._polylineMesh=e.mesh,t.add(t._polylineMesh),e.pickingMesh&&t._pickingMesh.add(e.pickingMesh),n()})["catch"](r)}else n()})}},{key:"_processPointResults",value:function(e){var t=this;return new Promise(function(n,r){var o,i=b["default"].splitFloat32Array(e.attributes.positions),a=b["default"].splitFloat32Array(e.attributes.normals),s=b["default"].splitFloat32Array(e.attributes.colors);e.properties&&(o=b["default"].splitUint8Array(e.properties));for(var u,l,c,f,h=e.flats,d=[],y={positions:3,normals:3,colors:3},g=0;g<i.length;g++){if(f=o&&o[g]?JSON.parse(b["default"].uint8ArrayToString(o[g])):{},u={attributes:[{positions:i[g],normals:a[g],colors:s[g]}],properties:f,flat:h[g]},t._options.interactive&&(l=t.getPickingId(),c=new Float32Array(i[g].length/3),b["default"].fillTypedArray(c,l),u.attributes[0].pickingIds=c,y.pickingIds=1,t._addPicking(l,f)),"function"==typeof t._options.onAddAttributes){var m,_=t._options.onAddAttributes(u.attributes[0],f);for(var w in _)m=_[w],u.attributes[0][w]=m.value,y[w]=m.length}d.push(u)}for(var x=[],O=!0,g=0;g<d.length;g++){u=d[g],O&&!u.flat&&(O=!1);var k=b["default"].mergeAttributes(u.attributes);x.push(k)}if(x.length>0){var P=b["default"].mergeAttributes(x),M="function"==typeof t._options.style?t._options.style(d[0]):t._options.style;M=(0,p["default"])({},v["default"].defaultStyle,M),t._setPointMesh(P,y,M,O).then(function(e){t._pointMesh=e.mesh,t.add(t._pointMesh),e.pickingMesh&&t._pickingMesh.add(e.pickingMesh),n()})["catch"](r)}else n()})}},{key:"_setPolygonMesh",value:function(e,t,n,r){return this._world?k["default"].SetMesh(e,t,r,n,this._options,this._world._environment._skybox):Promise.reject()}},{key:"_setPolylineMesh",value:function(e,t,n,r){return this._world?M["default"].SetMesh(e,t,r,n,this._options):Promise.reject()}},{key:"_setPointMesh",value:function(e,t,n,r){return this._world?j["default"].SetMesh(e,t,r,n,this._options,this._world._environment._skybox):Promise.reject()}},{key:"_addPicking",value:function(e,t){var n=this;this._world.on("pick-click-"+e,function(e,r,o,i){n._world.emit("click",n,t,r,o)}),this._world.on("pick-hover-"+e,function(e,r,o,i){n._world.emit("hover",n,t,r,o)})}},{key:"destroy",value:function(){u(Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}}],[{key:"Process",value:function(e,n,r,o,i,a,s){return new Promise(function(u,l){t.ProcessGeoJSON(e,r).then(function(e){var r,l=v["default"].collectFeatures(e,n),c=l.features,f=[],h=[],d=[];"string"==typeof i&&(i=x["default"].stringToFunction(i));var y,g=i;"string"==typeof s&&(y=x["default"].stringToFunction(s));for(var m,_=0;_<c.length;_++){m=c[_];var b=m.geometry,w=b.coordinates?b.coordinates:null;if(!w||!b)return;if("function"==typeof i&&(g=(0,p["default"])({},v["default"].defaultStyle,i(m))),"Polygon"===b.type||"MultiPolygon"===b.type){w=k["default"].isSingle(w)?[w]:w;var O,P=w.map(function(e){return e.map(function(e){return e.map(function(e){return(0,A.latLon)(e[1],e[0])})})}),T=P.map(function(e){return e.map(function(e){return e.map(function(e){return O=S["default"].latLonToPoint(e)._subtract(o),r||(r=S["default"].pointScale(e)),O})})}),E={projected:T,options:{pointScale:r,style:g}};a&&(E.properties=m.properties),f.push(E)}if("LineString"===b.type||"MultiLineString"===b.type){w=M["default"].isSingle(w)?[w]:w;var O,P=w.map(function(e){return e.map(function(e){return(0,A.latLon)(e[1],e[0])})}),T=P.map(function(e){return e.map(function(e){return O=S["default"].latLonToPoint(e)._subtract(o),r||(r=S["default"].pointScale(e)),O})}),C={projected:T,options:{pointScale:r,style:g}};a&&(C.properties=m.properties),h.push(C)}if("Point"===b.type||"MultiPoint"===b.type){w=j["default"].isSingle(w)?[w]:w;var O,P=w.map(function(e){return(0,A.latLon)(e[1],e[0])}),T=P.map(function(e){return O=S["default"].latLonToPoint(e)._subtract(o),r||(r=S["default"].pointScale(e)),O}),O={projected:T,options:{pointGeometry:y(m),pointScale:r,style:g}};a&&(O.properties=m.properties),d.push(O)}}for(var E,L=[],D=[],R=[],_=0;_<f.length;_++)E=f[_],L.push(k["default"].SetBufferAttributes(E.projected,E.options));for(var C,_=0;_<h.length;_++)C=h[_],D.push(M["default"].SetBufferAttributes(C.projected,C.options));for(var O,_=0;_<d.length;_++)O=d[_],R.push(j["default"].SetBufferAttributes(O.projected,O.options));var F={},I=[];t.ProcessPolygons(L,f,a).then(function(e){F.polygons=e.data,I=I.concat(e.transferrables),t.ProcessPolylines(D,h,a).then(function(e){F.polylines=e.data,I=I.concat(e.transferrables),t.ProcessPoints(R,d,a).then(function(e){F.points=e.data,I=I.concat(e.transferrables),u({data:F,transferrables:I})})})})})["catch"](l)})}},{key:"ProcessPolygons",value:function(e,t,n){return new Promise(function(r,o){Promise.all(e).then(function(e){for(var o,i,a=[],s=[],u=[],l=[],c=[],f=[],p=[],h=[],d=[],y=0;y<e.length;y++){i=e[y],o=t[y],d.push(i.flat);for(var v,g=0;g<i.attributes.length;g++)v=i.attributes[g],s.push(v.positions),u.push(v.normals),l.push(v.colors),c.push(v.tops),n&&h.push(b["default"].stringToUint8Array(JSON.stringify(o.properties)));for(var m,g=0;g<i.outlineAttributes.length;g++)m=i.outlineAttributes[g],f.push(m.positions),p.push(m.colors)}var _={positions:b["default"].mergeFloat32Arrays(s),normals:b["default"].mergeFloat32Arrays(u),colors:b["default"].mergeFloat32Arrays(l),tops:b["default"].mergeFloat32Arrays(c)},w={positions:b["default"].mergeFloat32Arrays(f),colors:b["default"].mergeFloat32Arrays(p)};a.push(_.positions[0].buffer),a.push(_.positions[1].buffer),a.push(_.normals[0].buffer),a.push(_.normals[1].buffer),a.push(_.colors[0].buffer),a.push(_.colors[1].buffer),a.push(_.tops[0].buffer),a.push(_.tops[1].buffer),a.push(w.positions[0].buffer),a.push(w.positions[1].buffer),a.push(w.colors[0].buffer),a.push(w.colors[1].buffer);var x;n&&(x=b["default"].mergeUint8Arrays(h),a.push(x[0].buffer),a.push(x[1].buffer));var O={attributes:_,outlineAttributes:w,flats:d};n&&(O.properties=x),r({data:O,transferrables:a})})["catch"](o)})}},{key:"ProcessPolylines",value:function(e,t,n){return new Promise(function(r,o){Promise.all(e).then(function(e){for(var o,i,a=[],s=[],u=[],l=[],c=[],f=0;f<e.length;f++){i=e[f],o=t[f],c.push(i.flat);for(var p,h=0;h<i.attributes.length;h++)p=i.attributes[h],s.push(p.positions),u.push(p.colors),n&&l.push(b["default"].stringToUint8Array(JSON.stringify(o.properties)))}var d={positions:b["default"].mergeFloat32Arrays(s),colors:b["default"].mergeFloat32Arrays(u)};a.push(d.positions[0].buffer),a.push(d.positions[1].buffer),a.push(d.colors[0].buffer),a.push(d.colors[1].buffer);var y;n&&(y=b["default"].mergeUint8Arrays(l),a.push(y[0].buffer),a.push(y[1].buffer));var v={attributes:d,flats:c};n&&(v.properties=y),r({data:v,transferrables:a})})["catch"](o)})}},{key:"ProcessPoints",value:function(e,t,n){return new Promise(function(r,o){Promise.all(e).then(function(e){for(var o,i,a=[],s=[],u=[],l=[],c=[],f=[],p=0;p<e.length;p++){i=e[p],o=t[p],f.push(i.flat);for(var h,d=0;d<i.attributes.length;d++)h=i.attributes[d],s.push(h.positions),u.push(h.normals),l.push(h.colors),n&&c.push(b["default"].stringToUint8Array(JSON.stringify(polygon.properties)))}var y={positions:b["default"].mergeFloat32Arrays(s),normals:b["default"].mergeFloat32Arrays(u),colors:b["default"].mergeFloat32Arrays(l)};a.push(y.positions[0].buffer),a.push(y.positions[1].buffer),a.push(y.normals[0].buffer),a.push(y.normals[1].buffer),a.push(y.colors[0].buffer),a.push(y.colors[1].buffer);var v;n&&(v=b["default"].mergeUint8Arrays(c),a.push(v[0].buffer),a.push(v[1].buffer));var g={attributes:y,flats:f};n&&(g.properties=v),r({data:g,transferrables:a})})["catch"](o)})}},{key:"ProcessGeoJSON",value:function(e,n){return"string"==typeof e?t.RequestGeoJSON(e,n):Promise.resolve(JSON.parse(b["default"].uint8ArrayToString(e)))}},{key:"RequestGeoJSON",value:function(e,t){return(0,d["default"])({url:e,type:"json",crossOrigin:!0,headers:t})}}]),t}(c["default"]));t["default"]=L;var D=function(e,t){return new L(e,t)};t.geoJSONWorkerLayer=D},function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(58),i=r(o),a=function(){var e,t=2,n=function(n,r){return e=new i["default"]({numThreads:n?n:t,workerScript:r?r:"vizicities-worker.js"}),e.createWorkers()},r=function(t,n,r){return e.exec(t,n,r)};return{createWorkers:n,exec:r}}();t["default"]=a,e.exports=t["default"]},function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(59),s=r(a),u=!1;Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function c(e){"use strict";if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var c,t=Object(this),n=t.length>>>0,r=arguments[1],o=0;o<n;o++)if(c=t[o],e.call(r,c,o,t))return c}});var l=function(){function e(t){o(this,e),this.numThreads=t.numThreads||2,this.workerScript=t.workerScript,this.workers=[],this.tasks=[]}return i(e,[{key:"createWorkers",value:function(){var e=this;return new Promise(function(t,n){for(var r=[],o=0;o<e.numThreads;o++)r.push(e.createWorker());Promise.all(r).then(function(){u&&console.log("All workers ready",(performance||Date).now()),t()})["catch"](n)})}},{key:"createWorker",value:function(){var e=this;return new Promise(function(t,n){var r=new s["default"]({workerScript:e.workerScript});return r.start().then(function(){u&&console.log("Worker ready",(performance||Date).now()),e.workers.push(r),t()})["catch"](n)})}},{key:"getFreeWorker",value:function(){return this.workers.find(function(e){return!e.busy})}},{key:"exec",value:function(e,t,n){var r=Promise.deferred(),o={method:e,args:t,transferrables:n,deferred:r};return this.tasks.push(o),this.processTasks(),o.deferred.promise}},{key:"processTasks",value:function(){var e=this;if(u&&console.log("Processing tasks"),0!==this.tasks.length){var t=this.getFreeWorker();if(!t)return void(u&&console.log("No workers free"));var n=this.tasks.shift();t.exec(n.method,n.args,n.transferrables).then(function(t){e.processTasks(),n.deferred.resolve(t)})["catch"](function(t){e.processTasks(),n.deferred.reject(t)})}}}]),e}();t["default"]=l,Promise.deferred=function(){var e={};return e.promise=new Promise(function(t,n){e.resolve=t,e.reject=n}),e},e.exports=t["default"]},function(e,t){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=!1,i=function(){function e(t){n(this,e),this.workerScript=t.workerScript,this.ready=!1,this.busy=!1,this.deferred=null}return r(e,[{key:"start",value:function(){var e=this;return new Promise(function(t,n){e.worker=new Worker(e.workerScript);var r=function o(r){return r.data&&"startup"===r.data.type?(e.ready=!0,e.worker.removeEventListener("message",o),e.worker.addEventListener("message",function(t){e.onMessage(t)}),void t()):void n()};e.worker.addEventListener("message",r)})}},{key:"exec",value:function(e,t,n){o&&console.log("Execute",e,t,n);var r=Promise.deferred();return this.busy=!0,this.deferred=r,this.worker.postMessage({method:e,args:t},n),r.promise}},{key:"onMessage",value:function(e){return o&&console.log("Message received from worker",(performance||Date).now()),this.busy=!1,e.data&&"error"!==e.data.type&&"result"===e.data.type?void this.deferred.resolve(e.data.payload):void this.deferred.reject(e.data.payload)}}]),e}();t["default"]=i,Promise.deferred=function(){var e={};return e.promise=new Promise(function(t,n){e.resolve=t,e.reject=n}),e},e.exports=t["default"]},function(module,exports){Object.defineProperty(exports,"__esModule",{value:!0});var Stringify=function(){var functionToString=function(e){return e.toString()},stringToFunction=function stringToFunction(str){if("string"==typeof str&&null!=str.match(/^\s*function\s*\w*\s*\([\s\S]*\)\s*\{[\s\S]*\}/m)){var f;try{return eval("f = "+str),f}catch(err){return str}}};return{functionToString:functionToString,stringToFunction:stringToFunction}}();exports["default"]=Stringify,module.exports=exports["default"]},function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(e,t,n){for(var r=!0;r;){var o=e,i=t,a=n;r=!1,null===o&&(o=Function.prototype);var s=Object.getOwnPropertyDescriptor(o,i);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(a)}var l=Object.getPrototypeOf(o);if(null===l)return;e=l,t=i,n=a,r=!0,s=l=void 0}},s=n(39),u=r(s),l=n(12),c=r(l),f=function(e){function t(e,n){o(this,t);var r={topojson:!0};n=(0,c["default"])({},r,n),a(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,n)}return i(t,e),t}(u["default"]);t["default"]=f;var p=function(e,t){return new f(e,t)};t.topoJSONTileLayer=p},function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(e,t,n){for(var r=!0;r;){var o=e,i=t,a=n;r=!1,null===o&&(o=Function.prototype);var s=Object.getOwnPropertyDescriptor(o,i);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(a)}var l=Object.getPrototypeOf(o);if(null===l)return;e=l,t=i,n=a,r=!0,s=l=void 0}},s=n(41),u=r(s),l=n(12),c=r(l),f=function(e){function t(e,n){o(this,t);var r={topojson:!0};n=(0,c["default"])({},r,n),a(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,n)}return i(t,e),t}(u["default"]);t["default"]=f;var p=function(e,t){return new f(e,t)};t.topoJSONLayer=p},function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(e,t,n){for(var r=!0;r;){var o=e,i=t,a=n;r=!1,null===o&&(o=Function.prototype);var s=Object.getOwnPropertyDescriptor(o,i);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(a)}var l=Object.getPrototypeOf(o);if(null===l)return;e=l,t=i,n=a,r=!0,s=l=void 0}},s=n(56),u=r(s),l=n(12),c=r(l),f=function(e){function t(e,n){o(this,t);var r={topojson:!0};n=(0,c["default"])({},r,n),a(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,n)}return i(t,e),t}(u["default"]);t["default"]=f;var p=function(e,t){return new f(e,t)};t.topoJSONWorkerLayer=p},function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(65),i=r(o),a=n(49),s=r(a),u=n(44),l=r(u),c=n(50),f=r(c),p=n(57),h=r(p),d=n(60),y=r(d),v={};v.wrapNum=i["default"],v.extrudePolygon=s["default"],v.GeoJSON=l["default"],v.Buffer=f["default"],v.Worker=h["default"],v.Stringify=y["default"],t["default"]=v,e.exports=t["default"]},function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t,n){var r=t[1],o=t[0],i=r-o;return e===r&&n?e:((e-o)%i+i)%i+o};t["default"]=n,e.exports=t["default"]}])});
//# sourceMappingURL=vizicities.min.js.map
